<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE root [
  <!ELEMENT root (process)*>
  <!ELEMENT process (script|group|option)*>
  <!ATTLIST process id CDATA #REQUIRED>
  <!ELEMENT option EMPTY>
  <!ATTLIST option value CDATA #REQUIRED>
  <!ATTLIST option id CDATA #REQUIRED>
  <!ELEMENT script (option|content)*>
  <!ATTLIST script id CDATA #REQUIRED>
  <!ELEMENT content (#PCDATA)>
  <!ATTLIST content xml:space CDATA "preserve">
  <!ELEMENT group (model|option)*>
  <!ATTLIST group id CDATA #REQUIRED>
  <!ELEMENT model (sqlStr|option|field)*>
  <!ATTLIST model id CDATA #REQUIRED>
  <!ELEMENT sqlStr (#PCDATA)>
  <!ATTLIST sqlStr xml:space CDATA "preserve">
  <!ELEMENT field EMPTY>
  <!ATTLIST field nameA CDATA "">
  <!ATTLIST field format CDATA "">
  <!ATTLIST field value CDATA "">
  <!ATTLIST field end CDATA #REQUIRED>
  <!ATTLIST field position CDATA #REQUIRED>
  <!ATTLIST field type CDATA "0">
  <!ATTLIST field name CDATA "">
  <!ATTLIST field nameT CDATA "">
  <!ENTITY ldrPath "file:/home/are/data/Documents/FERNBACH/FLEXCUBE/etl/ldr/">
]>

<!--
/*
 *
 *  Copyright (C) 2010 Prince Onyenike <onyenikeprince@yahoo.com>
 *
 * ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *
 *  This program is free software; you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation; either version 2 of the License, or (at
 *  your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful, but
 *  WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 *  General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License along
 *  with this program; if not, write to the Free Software Foundation, Inc.,
 *  59 Temple Place, Suite 330, Boston, MA 02111-1307 USA.
 *
 * ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 */
-->
<root>
  <process id="init">
    <option id="destinationPath" value="/usr/backup/manticore-ETLTools/data"/>
    <option id="ldrPath" value="file:/usr/backup/manticore-ETLTools/etl/ldr/"/>
    <option id="compress" value="0"/>
    <option id="concat" value="1"/>
    <option id="connection" value="FxF FSETL"/>
    <script id="10_truncate">
      <option id="active" value="1"/>
      <option id="phase" value="init"/>
      <content xml:space="preserve">import com.manticore.etl.*;
import com.manticore.etl.database.*;
import java.sql.*;
import groovy.sql.Sql;


logger.info("truncate tables in FSETL");

def String qryStr="""
	select 'truncate table ' || table_name "cmd" from user_tables 
	where not ( lower(table_name) like 'htm%'
			or lower(table_name)='gl_account'
		)
""";
ETLConnectionMap.close("FxF FSETL");


def Sql sql1 = new Sql(ETLConnectionMap.getConnection("FxF FSETL"));
sql1.eachRow( qryStr ) {
		logger.finer("execute ${it.cmd}"); 
		ETLConnectionMap.executeUpdate("FxF FSETL", it.cmd);
}
ETLConnectionMap.release("FxF FSETL", sql1.getConnection());</content>
      <option id="language" value="groovy"/>
    </script>
    <option id="dependancies" value=""/>
    <script id="01_prepare_attributes">
      <content xml:space="preserve">import com.manticore.util.ThreadList;
import java.io.File;
import java.io.FilenameFilter;
import java.io.IOException;
import java.io.InputStream;
import java.util.logging.Level;
import java.util.logging.Logger;
import java.sql.*;
import groovy.sql.Sql;
import com.manticore.etl.*;
import com.manticore.etl.database.*;

//@todo: execute in parallel!

Logger logger=Logger.getLogger("");
logger.info("extract General Attributes from FSETL");

//def String[] fieldnames=["motive_nm", "organisation_unit_nm", "dealer_nm", "bank_segment_nm", "cost_center_nm", "ext_key_ctry_addr", "addr_type_nm", "ext_key_bbranch", "legal_form_nm", "federal_state_nm"]
def String now="to_date('20111231 00:00:00','YYYYMMDD hh24:mi:ss')" 
def me=0
def company=0
def value=0
def objects=[[
				"motive_nm"
				, "Delete MOTIVE_H;"
				, { -&gt; "INSERT INTO MOTIVE_H ( MOTIVE,ACTIVE,PCTR_D,MOTIVE_H_IP,MOTIVE_H_DC,IPROFITCENTER,MOTIVE_BASE,UP_DATE,UP_NO,UP_USER) VALUES ( ${me},'A','${me}','${value}','${value}',NULL,NULL,$now,0,-1);" }
			], [
				"organisation_unit_nm"
				, "Delete ORGANISATION_UNIT_H;"
				, { -&gt; "INSERT INTO ORGANISATION_UNIT_H ( ORGANISATION_UNIT,ACTIVE,COMPANY,ADDRESS,ORGANISATION_UNIT_H_IP,ORGANISATION_UNIT_H_DC,PCTR_D,ORG_UNIT_TYPE,ORG_UNIT_INT_USER_FLAG,ORG_UNIT_INT_DEPT_FLAG,ORG_UNIT_INT_BRANCH_FLAG,ORG_UNIT_INT_COST_CENTER_FLAG,ORG_UNIT_EXT_ADDRESS_FLAG,ORG_UNIT_EXT_AGENT_FLAG,ORG_UNIT_EXT_VIRTUAL_FLAG,ADDRESS_CONTACT_FLAG,CREATE_DATE,CREATE_USER,UP_DATE,UP_NO,UP_USER) VALUES ( ${me},'A',${company},NULL,'${value}','${value}',NULL,NULL,'0','0','0','0','0','0','0','0',NULL,NULL,$now,0,-1);"}
			], [
				"dealer_nm"
				, "Delete DEALER;"
				, { -&gt; "INSERT INTO DEALER ( DEALER,ACTIVE,COMPANY,DEALER_SHN,DEALER_DC,FUSER,UP_DATE,UP_NO,UP_USER) VALUES ( ${me},'A',${company},'${value}','${value}',NULL,$now,0,-1);"}
			], [
				"bank_segment_nm"
				, "Delete BANK_SEGMENT_H;"
				, { -&gt; "INSERT INTO BANK_SEGMENT_H ( BANK_SEGMENT,ACTIVE,COMPANY,BANK_SEGMENT_H_SHN,BANK_SEGMENT_H_DC,UP_DATE,UP_NO,UP_USER) VALUES ( ${me},'A',${company},'${value}','${value}',$now,0,-1);"}
			], [
				"cost_center_nm"
				, "Delete COST_CENTER_H;"
				, { -&gt; "INSERT INTO COST_CENTER_H ( COST_CENTER,ACTIVE,COMPANY,COST_CENTER_H_IP,COST_CENTER_H_DC,COST_CENTER_TYPE,COST_CENTER_INT_USER_FLAG,COST_CENTER_INT_DEPT_FLAG,COST_CENTER_INT_BRANCH_FLAG,COST_CENTER_EXT_ADDRESS_FLAG,COST_CENTER_EXT_AGENT_FLAG,COST_CENTER_EXT_UNREAL_FLAG,ADDRESS_CONTACT_FLAG,UP_DATE,UP_NO,UP_USER) VALUES ( ${me},'A',${company},'${value}','${value}',1,'0','0','0','0','0',NULL,NULL,$now,0,-1);"}
			], [
				"addr_type_nm"
				, "Delete ADDR_TYPE_H;"
				, { -&gt; "INSERT INTO ADDR_TYPE_H ( ADDR_TYPE,ACTIVE,COMPANY,ADDR_TYPE_H_IP,ADDR_TYPE_H_DC,ADDR_SECOND_FLAG,ADDR_BANK_FLAG,ADDR_CLIENT_FLAG,ADDR_BROKER_FLAG,ADDR_PAYMENT_FLAG,ADDR_DELIVERY_FLAG,ADDR_AGENT_FLAG,ADDR_PERSONELL_FLAG,ADDR_ACC_WITH_FLAG,ADDR_ACC_AND_FLAG,ADDR_ACC_OR_FLAG,ADDR_NOSTRO_FLAG,ADDR_CONTRAHENT_FLAG,ADDR_AUTHORIZE_FLAG,ADDR_DESTINATION_FLAG,P82_FLAG,ADDR_SECURITY_FLAG,ADDR_ADMIN_PROPERTY_FLAG,ADDR_CMPY_CLIENT_FLAG,ADDR_CLDOC_FLAG,ADDR_SECBANK_FLAG,ADDR_ENCRYPTION_FLAG,ADDR_ISSUER_FLAG,ADDR_CONNECTION_FLAG,ADDR_EMPLOYER_FLAG,UP_DATE,UP_NO,UP_USER) VALUES (  ${me},'A',${company},'${value}','${value}','0','0','1','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0',$now,0,-1);"}
			], [
				"ext_key_bbranch"
				, "Delete BUSINESS_BRANCH_H;"
				, { -&gt; "INSERT INTO BUSINESS_BRANCH_H ( BUSINESS_BRANCH,ACTIVE,BUSINESS_BRANCH_H_IP,BUSINESS_BRANCH_H_DC,UP_DATE,UP_NO,UP_USER) VALUES ( ${me},'A','${value}','${value}',$now,0,-1);"}
			]]
			

objects.each {
	def f=it[0]
	def p=it[1]
	def i=it[2]

	logger.info("extract values for field $f");
	def String qryStr="""select 'select distinct company, $f v from ' || table_name || ' where not $f is null' as cmd from user_tab_columns where lower(column_name) = '$f'"""
	def String qryStr2="";
	def Sql sql1 = new Sql(ETLConnectionMap.getConnection("FxF Union Bank FSETL"));
	sql1.eachRow( qryStr ) {
		qryStr2 += qryStr2.length()==0 ? it.cmd : "\nunion " + it.cmd;
	}
    
	def out1 = new File('/usr/backup/manticore-ETLTools/data/' + f + '.sql')
    me=0
    out1.append "$p\n"
	sql1.eachRow( qryStr2 ) {
		me++
	company=it.company;
	value=it.v;
		out1.append "$i\n"
	}
	out1.append "commit;\n"
}
println "ready!"

ETLConnectionMap.release("FxF Union Bank FSETL", sql1.getConnection());</content>
      <option id="active" value="0"/>
      <option id="language" value="groovy"/>
      <option id="phase" value="init"/>
    </script>
  </process>
  <process id="transfer">
    <option id="destinationPath" value="/usr/backup/manticore-ETLTools/data"/>
    <option id="ldrPath" value="file:/usr/backup/manticore-ETLTools/etl/ldr/"/>
    <option id="compress" value="0"/>
    <option id="concat" value="1"/>
    <option id="connection" value="FxF FSETL"/>
    <script id="90_push">
      <option id="active" value="0"/>
      <option id="phase" value="transfer"/>
      <content xml:space="preserve">com.manticore.etl.FlatFileLoader.push(ldrPath, "/usr/backup/manticore-ETLTools/data", 10, true, logger);
</content>      <option id="language" value="groovy"/>    </script>    <script id="91_push_csv">      <option id="active" value="0"/>      <option id="phase" value="transfer"/>      <content xml:space="preserve">import com.manticore.etl.*;
import com.manticore.etl.database.*;
import java.util.logging.Level;
import java.util.logging.Logger;
import java.sql.*;
import groovy.sql.Sql;

Logger.getLogger("").info("start import of CSV files...");

String driverClassName = "oracle.jdbc.driver.OracleDriver";
String connectionString = "jdbc:oracle:thin:@172.16.10.16:1521:dbfxf";
String userName = "fsetl";
String password = "fsetl";
String destinationPath = "/usr/backup/manticore-ETLTools/etl/csv/";

CSVImport export = new CSVImport("FxF Union Bank FSETL", destinationPath);
export.addEntry("INTRATES_InterestRates_DataCapture", "FSETL.interest_rates", "dd/MM/yyyy", "dd/MM/yyyy HH:mm:ss.SSS", 3, 1, false);
export.addEntry("PFIMP_ImpairmentPortfolio_DataCapture", "FSETL.IMPAIRMENT_PORTFOLIO", "dd/MM/yyyy", "dd/MM/yyyy HH:mm:ss.SSS", 3, 1, false);
export.addEntry("upfront_fees", "FSETL.upfront_fees", "yyyy-MM-dd", "yyyy-MM-dd HH:mm:ss.SSS", 1, 0, false);
export.addEntry("portfolio_assignment", "FSETL.portfolio_assignment", "yyyy-MM-dd", "yyyy-MM-dd HH:mm:ss.SSS", 3, 0, false);
export.run();

def Sql sql = new Sql(ETLConnectionMap.getConnection("FxF Union Bank FSETL"));
def String sqlStr="""
	update FSETL.INTEREST_RATES
	set VALID = to_date('${POSTINGDATE}', 'yyyymmdd')
"""
Logger.getLogger("").info("adjust yield curves to posting date ${POSTINGDATE}, ${sql.executeUpdate(sqlStr)} updated");

sqlStr="""
	INSERT INTO L4567502_UPF_CHA_AMO
	(
		 TRS_NR_NM ,
		 CHARGE_TYPE_NM,
		 SALES_TYPE_NM,
		 CHARGE_DURATION_FRM,
		 CHARGE_DATE_CHANGE,
		 CHARGE_AMOUNT
	)
	select
	t2.trs_nr_nm ,
	'AMORTCHARGER' ,
	'IAS-TK-IN' ,
	case
		when t1.DAT_VALUE &gt;=t2.capital_duration_frm and t1.DAT_VALUE &lt;=t2.capital_duration_to then t1.DAT_VALUE
		else t2.capital_duration_frm
	end	,
	t2.capital_duration_to ,
	t1.amt_txn
	from fsetl.UPFRONT_FEES t1
	inner join L4567502_REGULAR_FLOATING_LOAN t2 on t1.COD_ACCT_NO=t2.TRS_NR_NM
"""
Logger.getLogger("").info("insert upfront charges for L4567502_REGULAR_FLOATING_LOAN, ${sql.executeUpdate(sqlStr)} updated");


sqlStr="""
	INSERT INTO L4567503_UPF_CHA_AMO
	(
		 TRS_NR_NM ,
		 CHARGE_TYPE_NM,
		 SALES_TYPE_NM,
		 CHARGE_DURATION_FRM,
		 CHARGE_DATE_CHANGE,
		 CHARGE_AMOUNT
	)
	select
	t2.trs_nr_nm ,
	'AMORTCHARGER' ,
	'IAS-TK-IN' ,
	case
		when t1.DAT_VALUE &gt;=t2.capital_duration_frm and t1.DAT_VALUE &lt;=t2.capital_duration_to then t1.DAT_VALUE
		else t2.capital_duration_frm
	end	,
	t2.capital_duration_to ,
	t1.amt_txn
	from fsetl.UPFRONT_FEES t1
	inner join L4567503_REGULAR_STAFF_LOAN t2 on t1.COD_ACCT_NO=t2.TRS_NR_NM
"""
Logger.getLogger("").info("insert upfront charges for L4567503_REGULAR_STAFF_LOAN, ${sql.executeUpdate(sqlStr)} updated");

sqlStr="""
insert into A4569501_ASS_TO_IMP_POR
select
 t2.CURRENT_ACCOUNT_NUMBER
 , case
 when SECTOR='INFORMATION AND COMMUNICATION' then 1
when SECTOR='TRANSPORTATION AND STORAGE ' then 2
when SECTOR='OIL AND GAS' then 3
when SECTOR='AGRICULTURE, FORESTRY AND FISHING' then 4
when SECTOR='REAL ESTATE ACTIVITIES ' then 5
when SECTOR='FINANCE AND INSURANCE' then 6
when SECTOR='MANUFACTURING' then 7
when SECTOR='CONSTRUCTION' then 8
when SECTOR='GENERAL' then 9
when SECTOR='GOVERNMENT' then 10
when SECTOR='GENERAL COMMERCE' then 11
when SECTOR='HUMAN HEALTH AND SOCIAL WORK ACTIVITIES' then 12
when SECTOR='PROFESSIONAL, SCIENTIFIC AND TECHNICAL ACTIVITIES' then 13
when SECTOR='EDUCATION' then 14
when SECTOR='PUBLIC UTILITIES' then 15
when SECTOR='WATER SUPPLY; SEWERAGE, WASTE MANAGEMENT  AND REMEDIATION ACTIVITIES' then 16
when SECTOR='CAPITAL MARKET' then 17
when SECTOR='ACTIVITIES OF EXTRATERRITORIAL ORGANIZATIONS AND BODIES' then 18
when SECTOR='ARTS, ENTERTAINMENT AND RECREATION' then 19
end "portfolio_nm"
from 
fsetl.PORTFOLIO_ASSIGNMENT t1
inner join A4569501_CURRENT_ACCOUNT t2 on 'ch_acct_'
|| t1.ACCOUNT_NUMBER_TEXT=t2.CURRENT_ACCOUNT_NUMBER and not t1.FACILITY_TYPE='LN'	
"""
Logger.getLogger("").info("insert portfolio assignment for A4569501_CURRENT_ACCOUNT, ${sql.executeUpdate(sqlStr)} updated");

sqlStr="""
insert into L4567502_ASS_TO_POR_IMP
select
 t2.trs_nr_nm
 , case
 when SECTOR='INFORMATION AND COMMUNICATION' then 1
when SECTOR='TRANSPORTATION AND STORAGE ' then 2
when SECTOR='OIL AND GAS' then 3
when SECTOR='AGRICULTURE, FORESTRY AND FISHING' then 4
when SECTOR='REAL ESTATE ACTIVITIES ' then 5
when SECTOR='FINANCE AND INSURANCE' then 6
when SECTOR='MANUFACTURING' then 7
when SECTOR='CONSTRUCTION' then 8
when SECTOR='GENERAL' then 9
when SECTOR='GOVERNMENT' then 10
when SECTOR='GENERAL COMMERCE' then 11
when SECTOR='HUMAN HEALTH AND SOCIAL WORK ACTIVITIES' then 12
when SECTOR='PROFESSIONAL, SCIENTIFIC AND TECHNICAL ACTIVITIES' then 13
when SECTOR='EDUCATION' then 14
when SECTOR='PUBLIC UTILITIES' then 15
when SECTOR='WATER SUPPLY; SEWERAGE, WASTE MANAGEMENT  AND REMEDIATION ACTIVITIES' then 16
when SECTOR='CAPITAL MARKET' then 17
when SECTOR='ACTIVITIES OF EXTRATERRITORIAL ORGANIZATIONS AND BODIES' then 18
when SECTOR='ARTS, ENTERTAINMENT AND RECREATION' then 19
end "portfolio_nm"
from 
fsetl.PORTFOLIO_ASSIGNMENT t1
inner join L4567502_REGULAR_FLOATING_LOAN t2 on t1.ACCOUNT_NUMBER_TEXT=t2.TRS_NR_NM and t1.FACILITY_TYPE='LN'	
"""
Logger.getLogger("").info("insert portfolio assignment for L4567502_REGULAR_FLOATING_LOAN, ${sql.executeUpdate(sqlStr)} updated");

sqlStr="""
insert into L4567503_ASS_TO_POR_IMP
select
 t2.trs_nr_nm
 , case
 when SECTOR='INFORMATION AND COMMUNICATION' then 1
when SECTOR='TRANSPORTATION AND STORAGE ' then 2
when SECTOR='OIL AND GAS' then 3
when SECTOR='AGRICULTURE, FORESTRY AND FISHING' then 4
when SECTOR='REAL ESTATE ACTIVITIES ' then 5
when SECTOR='FINANCE AND INSURANCE' then 6
when SECTOR='MANUFACTURING' then 7
when SECTOR='CONSTRUCTION' then 8
when SECTOR='GENERAL' then 9
when SECTOR='GOVERNMENT' then 10
when SECTOR='GENERAL COMMERCE' then 11
when SECTOR='HUMAN HEALTH AND SOCIAL WORK ACTIVITIES' then 12
when SECTOR='PROFESSIONAL, SCIENTIFIC AND TECHNICAL ACTIVITIES' then 13
when SECTOR='EDUCATION' then 14
when SECTOR='PUBLIC UTILITIES' then 15
when SECTOR='WATER SUPPLY; SEWERAGE, WASTE MANAGEMENT  AND REMEDIATION ACTIVITIES' then 16
when SECTOR='CAPITAL MARKET' then 17
when SECTOR='ACTIVITIES OF EXTRATERRITORIAL ORGANIZATIONS AND BODIES' then 18
when SECTOR='ARTS, ENTERTAINMENT AND RECREATION' then 19
end "portfolio_nm"
from 
fsetl.PORTFOLIO_ASSIGNMENT t1
inner join L4567503_REGULAR_STAFF_LOAN t2 on t1.ACCOUNT_NUMBER_TEXT=t2.TRS_NR_NM and t1.FACILITY_TYPE='LN'	
"""
Logger.getLogger("").info("insert portfolio assignment for L4567503_REGULAR_STAFF_LOAN, ${sql.executeUpdate(sqlStr)} updated");
		
ETLConnectionMap.release("FxF Union Bank FSETL", sql.getConnection())		
      </content>
      <option id="language" value="groovy"/>
    </script>
    <option id="dependancies" value="ln_retail ln_corporate flexcube_securities"/>
  </process>
  <process id="process">
    <option id="destinationPath" value="/usr/backup/manticore-ETLTools/data"/>
    <option id="ldrPath" value="file:/usr/backup/manticore-ETLTools/etl/ldr/"/>
    <option id="compress" value="0"/>
    <option id="concat" value="1"/>
    <option id="connection" value="FxF FSETL"/>
    <script id="01_testFreeDiskSpace">
      <option id="active" value="0"/>
      <option id="phase" value="init"/>
      <content xml:space="preserve">/*
 *
 *  Copyright (C) 2010 Prince Onyenike  &lt;onyenikeprince@yahoo.com&gt; 
 *
 * ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *
 *  This program is free software; you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation; either version 2 of the License, or (at
 *  your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful, but
 *  WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 *  General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License along
 *  with this program; if not, write to the Free Software Foundation, Inc.,
 *  59 Temple Place, Suite 330, Boston, MA 02111-1307 USA.
 *
 * ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *
 * Credits to: https://www.ngdc.noaa.gov/wiki/index.php?title=Regular_Expressions_in_Groovy
 * where the main part of this script was copied from
 *
 */


 dfkOutput = 'df -k --sync'.execute().text
 long kbAvail = 0
 regex =  '''(?ix)     # enable case-insensitive matches, extended patterns
		(\\d+)     # 1: The disk space we want
		\\s+       # some whitespace
		\\d+%      # a number followed by %
		\\s+       # some more whitespace
		(/oradata*)  # 2: partition name'''
 pattern = ~regex
 matcher = pattern.matcher(dfkOutput)
 for (i=0; i &lt; matcher.getCount(); i++) {
	kbAvail += matcher[i][1].toLong()
 }
 println "/oradata: ${kbAvail} kb available"
 if (kbAvail &lt; 12000000) {
	println "insufficient disk space, will exit"
	System.exit(1);
 }
 
 kbAvail = 0
 regex =  '''(?ix)     # enable case-insensitive matches, extended patterns
		(\\d+)     # 1: The disk space we want
		\\s+       # some whitespace
		\\d+%      # a number followed by %
		\\s+       # some more whitespace
		(/)        # 2: partition name'''
 pattern = ~regex
 matcher = pattern.matcher(dfkOutput)
 for (i=0; i &lt; matcher.getCount(); i++) {
	kbAvail += matcher[i][1].toLong()
 }
 println "/: ${kbAvail} kb available"
 if (kbAvail &lt; 12000000) {
	println "insufficient disk space, will exit"
	System.exit(1);
 }
			</content>
      <option id="language" value="groovy"/>
    </script>
    <script id="05_resetDB">
      <option id="active" value="1"/>
      <option id="phase" value="init"/>
      <content xml:space="preserve">/*
 *
 *  Copyright (C) 2010 Prince Onyenike  &lt;onyenikeprince@yahoo.com&gt; 
 *
 * ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *
 *  This program is free software; you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation; either version 2 of the License, or (at
 *  your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful, but
 *  WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 *  General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License along
 *  with this program; if not, write to the Free Software Foundation, Inc.,
 *  59 Temple Place, Suite 330, Boston, MA 02111-1307 USA.
 *
 * ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 */

import org.joda.time.*
import org.joda.time.format.*
import java.io.*
import org.apache.commons.io.*;

if ( POSTINGDATE.compareTo(INITDATE) == 0 ) {
	println "reset db on PD1=${POSTINGDATE}"
	def String scriptContent= """
		 set pause off
		 set feed off
	
		 conn fsdms/manager@dbfxf
	
		 prompt delete IMP tables ...
		 exec db_pck_f0018298.reset_imp_tabs;
		 prompt ...done
		
		 ------ delete HST tables (only dw_company_ctrl &gt; 0)------
		 prompt
		 prompt delete HST tables ...
		 exec db_pck_f0018298.reset_hst_tabs(PAR_DROP_HST_TABS =&gt; 0, PAR_CREATE_HST_TABS =&gt; 0, PAR_TRUNCATE_HST_TABS =&gt; 0, PAR_DEL_DW_COMPANY_CTRL =&gt; 0, PAR_NODEL_MUPO =&gt; 1, PAR_DEL_MUPO =&gt; 0 );
		 prompt ...done
		
		 ------ delete target tables, AR-tables ------
		 prompt
		 prompt delete target tables, AR-tables, ...
		 exec db_pck_f0018298.RESET_OTHERS(par_booking_date =&gt; to_date('${POSTINGDATE}','yyyymmdd'));
		 prompt ...done
		 
		 exit
		 /
	"""
	
	def File file=File.createTempFile("fxf",".sql")
	FileUtils.writeStringToFile(file, scriptContent)
	
	command = ["sh", "-c", "sqlplus /nolog @".concat(file.getAbsolutePath())]
	def Process p=Runtime.getRuntime().exec((String[]) command.toArray())
	p.waitFor()

} else {
	println "skip reset of the database on ${POSTINGDATE}"
}          
				</content>
      <option id="language" value="groovy"/>
    </script>
    <script id="09_restartScheduler">
      <option id="active" value="0"/>
      <option id="phase" value="init"/>
      <content xml:space="preserve">/*
 *
 *  Copyright (C) 2010 Prince Onyenike  &lt;onyenikeprince@yahoo.com&gt; 
 *
 * ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *
 *  This program is free software; you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation; either version 2 of the License, or (at
 *  your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful, but
 *  WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 *  General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License along
 *  with this program; if not, write to the Free Software Foundation, Inc.,
 *  59 Temple Place, Suite 330, Boston, MA 02111-1307 USA.
 *
 * ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 */

import org.joda.time.*
import org.joda.time.format.*
import java.io.*
import org.apache.commons.io.*;

def String scriptContent= """
	 conn sysjcs/manager@dbfxf
	 shutdown immediate
	 startup
	 exit
	 /
"""

file=File.createTempFile("fxf",".sql")
FileUtils.writeStringToFile(file, scriptContent)

command = ["sh", "-c", "rs /nolog @".concat(file.getAbsolutePath())]
Runtime.getRuntime().exec((String[]) command.toArray())
				</content>
      <option id="language" value="groovy"/>
    </script>
    <script id="96_startRedwoodJCS">
      <option id="active" value="1"/>
      <option id="phase" value="after"/>
      <content xml:space="preserve">/*
 *
 *  Copyright (C) 2010 Prince Onyenike  &lt;onyenikeprince@yahoo.com&gt; 
 *
 * ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *
 *  This program is free software; you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation; either version 2 of the License, or (at
 *  your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful, but
 *  WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 *  General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License along
 *  with this program; if not, write to the Free Software Foundation, Inc.,
 *  59 Temple Place, Suite 330, Boston, MA 02111-1307 USA.
 *
 * ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 */

import org.joda.time.*
import org.joda.time.format.*
import java.io.*
import org.apache.commons.io.*;

import groovy.sql.Sql
import java.sql.Date;
import java.sql.Timestamp;
import java.util.Date;
import java.text.SimpleDateFormat;
import java.util.concurrent.Semaphore;
import com.manticore.etl.*; 
import org.joda.time.*;
import org.joda.time.format.*;
import java.util.logging.Level;
import java.util.logging.Logger;

Logger.getLogger("").info("start FxF processing...");

def DateTimeFormatter dateTimeFormatter=DateTimeFormat.forPattern("dd.MM.yyyy");
def DateTimeFormatter dateTimeFormatter2=DateTimeFormat.forPattern("yyyyMMdd");	
def String POSTINGDATE2=dateTimeFormatter.print( dateTimeFormatter2.parseDateTime(POSTINGDATE));

def String scriptContent= """
	set pause off
	set feed off

	WHENEVER sqlerror EXIT 1
	WHENEVER oserror EXIT 1

	 undefine CTRL_NO
	 column DW_CTRL new_value CTRL_NO noprint;
	 select db_pck_f0013005.fetch_next_dw_ctrl DW_CTRL from dual;

	 undefine ERR_FPRINTER
	 column E_FPRINTER new_value ERR_FPRINTER noprint;
	 select db_pck_f0012284.fsj_fprinter(NULL,'ERROR',NULL) E_FPRINTER from dual;

	 undefine HIST_FPRINTER
	 column H_FPRINTER new_value HIST_FPRINTER noprint;
	 select db_pck_f0012284.fsj_fprinter(NULL,'HISTORY',NULL) H_FPRINTER from dual;

	 -- default for prc_dw_ctrl is db_pck_f0013005.fetch_next_dw_ctrl
	 -- default for prc_error_fprinter   is db_pck_f0012284.fsj_fprinter(NULL,'ERROR',NULL)
	 -- default for prc_history_fprinter is db_pck_f0012284.fsj_fprinter(NULL,'HISTORY',NULL)
	 -- default for prc_print_history is 'N'


	 set pause off
	 set feed off
	 SET VERIFY OFF
	 SET SERVEROUTPUT ON SIZE 1000000
	 PROMPT Start of JOB_F0015000
	 DECLARE
		prc_dw_ctrl            NUMBER      := &amp;CTRL_NO;
		prc_error_fprinter     NUMBER(7,0) := &amp;ERR_FPRINTER;
		prc_history_fprinter   NUMBER(7,0) := &amp;HIST_FPRINTER;
		prc_print_history      VARCHAR2(1) := 'N';
		prc_job_id             NUMBER;

	 BEGIN
		jcs.clear_parameters('JOB_F0015000');
		jcs.parameter('JOB_F0015000', 'PAR_DW_CTRL',          prc_dw_ctrl);
		jcs.parameter('JOB_F0015000', 'PAR_ERROR_FPRINTER',   prc_error_fprinter);
		jcs.parameter('JOB_F0015000', 'PAR_HISTORY_FPRINTER', prc_history_fprinter);
		jcs.parameter('JOB_F0015000', 'PAR_PRINT_HISTORY',    prc_print_history);
		prc_job_id := jcs.submit('JOB_F0015000');
		commit;
		dbms_output.put_line('Script JOB_F0015000 submitted, job id='||prc_job_id);
	 END;
	 /
	 exit 0;
"""
command = ["sh", "-c", "rm -Rf ${destinationPath}${POSTINGDATE}"]
Runtime.getRuntime().exec((String[]) command.toArray()).waitFor()

["176","177","178","179","180","181","182","183"].each {
	command = ["sh", "-c", "rm -Rf ${destinationPath}*.${it}*"]
	Runtime.getRuntime().exec((String[]) command.toArray()).waitFor()
}

command = ["sh", "-c", "cp ${destinationPath}BLK_${POSTINGDATE}/* ${destinationPath}"]
Runtime.getRuntime().exec((String[]) command.toArray()).waitFor()

file=File.createTempFile("fxf",".sql")
FileUtils.writeStringToFile(file, scriptContent)

println("start processing from ".concat(file.getAbsolutePath()))

command = ["sh", "-c", "sqlplus 'OPS\$FSOPER/manager@dbfxf' @".concat(file.getAbsolutePath())]
Runtime.getRuntime().exec((String[]) command.toArray()).waitFor()
</content>      <option id="language" value="groovy"/>    </script>    <script id="95_startAnalytix">      <option id="active" value="1"/>      <option id="phase" value="transfer"/>      <content xml:space="preserve">/*
 *
 *  Copyright (C) 2010 Prince Onyenike  &lt;onyenikeprince@yahoo.com&gt; 
 *
 * ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *
 *  This program is free software; you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation; either version 2 of the License, or (at
 *  your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful, but
 *  WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 *  General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License along
 *  with this program; if not, write to the Free Software Foundation, Inc.,
 *  59 Temple Place, Suite 330, Boston, MA 02111-1307 USA.
 *
 * ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 */

import org.joda.time.*
import org.joda.time.format.*
import java.io.*
import org.apache.commons.io.*;
import java.util.logging.Level;
import java.util.logging.Logger;

def String[] companies=['176', '177','178','179','180','181','182','183','184'];

for (String c: companies) {
	Logger.getLogger("").info("start Analytix for company id ${c}, this will run quite a while, please hang on...");
	def String scriptContent= """
		set pause off
		set feed off
		
		WHENEVER sqlerror EXIT 1
		WHENEVER oserror EXIT 1
		
		-- PROMPT start of script 10_start_Analytix_ETL.sql ...
		
		VARIABLE success NUMBER;
		DECLARE
			prc_posting_date    date := to_date('${POSTINGDATE}', 'yyyymmdd');
			prc_job_id          jcs_jobs.job_id%TYPE;
			prc_job_status      jcs_jobs.status%TYPE;
			prc_rw_script_name  varchar2(40)  := 'UE_RUN_ETL_PD';
		BEGIN
			jcs.clear_parameters(prc_rw_script_name);
			jcs.parameter(prc_rw_script_name, 'PAR_POSTING_DATE', prc_posting_date);
			jcs.parameter(prc_rw_script_name, 'PAR_COMPANY', '${c}');
			prc_job_id := jcs.submit(prc_rw_script_name);
			jcs.docommit;
			dbms_output.put_line('Script '||prc_rw_script_name||' submitted: job id='||prc_job_id);
		
			db_pck_f0018225.job_wait(prc_job_id);
			prc_job_status := jcs.status(prc_job_id);
			dbms_output.put_line('Script '||prc_rw_script_name||' finished: status= '||prc_job_status);
			IF  prc_job_status != 'READY' THEN
					:success := 1;
			ELSE 
					:success := 0;
			END IF;
		
		END; 
		/
		exit :success ;
	"""
	
	file=File.createTempFile("fxf",".sql")
	FileUtils.writeStringToFile(file, scriptContent)
	
	command = ["sh", "-c", "sqlplus 'OPS\$FSOPER/manager@dbfxf' @".concat(file.getAbsolutePath())]
	def int result=Runtime.getRuntime().exec((String[]) command.toArray()).waitFor()
	
	if (result!=0) {
		Logger.getLogger("").severe("processing of company ${c} failed. teminate the processing.")
		System.exit(1);
	} else
		Logger.getLogger("").severe("processing of company ${c} succeeded.")
}</content>
      <option id="language" value="groovy"/>
    </script>
    <script id="99_startFxF_daily_complete">
      <option id="active" value="0"/>
      <option id="phase" value="transfer"/>
      <content xml:space="preserve">/*
 *
 *  Copyright (C) 2010 Prince Onyenike  &lt;onyenikeprince@yahoo.com&gt; 
 *
 * ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *
 *  This program is free software; you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation; either version 2 of the License, or (at
 *  your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful, but
 *  WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 *  General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License along
 *  with this program; if not, write to the Free Software Foundation, Inc.,
 *  59 Temple Place, Suite 330, Boston, MA 02111-1307 USA.
 *
 * ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 */

import org.joda.time.*
import org.joda.time.format.*
import java.io.*
import org.apache.commons.io.*;

import groovy.sql.Sql
import java.sql.Date;
import java.sql.Timestamp;
import java.util.Date;
import java.text.SimpleDateFormat;
import java.util.concurrent.Semaphore;
import com.manticore.etl.*; 
import org.joda.time.*;
import org.joda.time.format.*;
import java.util.logging.Level;
import java.util.logging.Logger;

Logger.getLogger("").info("start FxF processing...");

def DateTimeFormatter dateTimeFormatter=DateTimeFormat.forPattern("dd.MM.yyyy");
def DateTimeFormatter dateTimeFormatter2=DateTimeFormat.forPattern("yyyyMMdd");	
def String POSTINGDATE2=dateTimeFormatter.print( dateTimeFormatter2.parseDateTime(POSTINGDATE));

def String scriptContent= """
	set pause off
	set feed off
	
	WHENEVER sqlerror EXIT 1
	WHENEVER oserror EXIT 1
	
	-- PROMPT start of script 22_start_FxF_IFRS_daily_complete_processing.sql ...
	
	VARIABLE success NUMBER;
	
	DECLARE
		prc_posting_date    varchar2(10) := '${POSTINGDATE2}';
		prc_job_id          jcs_jobs.job_id%TYPE;
		prc_job_status      jcs_jobs.status%TYPE;
		prc_rw_script_name  varchar2(40)  := 'JOB_F0018660';
		
	BEGIN
	 
		-- start Redwood Job
		jcs.clear_parameters(prc_rw_script_name);
		jcs.parameter(prc_rw_script_name, 'PAR_START_BOOKING_DATE', prc_posting_date);
		jcs.parameter(prc_rw_script_name, 'PAR_END_BOOKING_DATE', prc_posting_date);
		jcs.parameter(prc_rw_script_name, 'PAR_USE_ASCII_FILES_FLAG' , 'Y');
		jcs.parameter(prc_rw_script_name, 'PAR_DDO_AT_LAST_PD_FLAG' , 'N');
		prc_job_id := jcs.submit(prc_rw_script_name);
		jcs.docommit;
		dbms_output.put_line('Script '||prc_rw_script_name||' submitted: job id='||prc_job_id);
	
		--db_pck_f0018225.job_wait(prc_job_id);
		--prc_job_status := jcs.status(prc_job_id);
		--dbms_output.put_line('Script '||prc_rw_script_name||' finished: status= '||prc_job_status);
	
		
		--IF  prc_job_status != 'READY' THEN
		--		:success := 1;
		--ELSE 
		--		:success := 0;
		--END IF;
	
	END; 
	/
	exit :success ;
"""
command = ["sh", "-c", "rm -Rf ${destinationPath}${POSTINGDATE}"]
Runtime.getRuntime().exec((String[]) command.toArray()).waitFor()

["176","177","178","179","180","181","182","183"].each {
	command = ["sh", "-c", "rm -Rf ${destinationPath}*.${it}*"]
	Runtime.getRuntime().exec((String[]) command.toArray()).waitFor()
}

file=File.createTempFile("fxf",".sql")
FileUtils.writeStringToFile(file, scriptContent)

println("start processing from ".concat(file.getAbsolutePath()))

command = ["sh", "-c", "sqlplus 'OPS\$FSOPER/manager@dbfxf' @".concat(file.getAbsolutePath())]
Runtime.getRuntime().exec((String[]) command.toArray()).waitFor()
				</content>
      <option id="language" value="groovy"/>
    </script>
    <option id="dependancies" value="transfer"/>
  </process>
  <process id="ln_corporate">
    <option id="destinationPath" value="/usr/backup/manticore-ETLTools/data/ln_corporate/"/>
    <option id="ldrPath" value="file:/usr/backup/manticore-ETLTools/etl/ldr/"/>
    <option id="compress" value="0"/>
    <option id="concat" value="1"/>
    <option id="connection" value="FlexCube Corporate Live"/>
    <option id="targetConnection" value="FxF FSETL"/>
    <group id="moneymarket">
      <option id="active" value="1"/>
      <model id="MM01XXXX_ACC_CAT">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.MM01XXXX_ACC_CAT.ldr"/>
        <option id="recordSize" value="52"/>
        <sqlStr xml:space="preserve">Select 
a.contract_ref_no						"trs_nr_nm"
,'OL'                                   "accounting_category_nm"
from ldtb_contract_master a 
WHERE a.contract_status = 'A'
AND product IN ( Select product_code from cstm_product where module = 'MM' and record_stat = 'O')
AND a.version_no = (select max(version_no) from ldtb_contract_master c 
				where a.version_no = c.version_no
				AND c.contract_status = 'A'
				)
--AND EXISTS (Select 1 from ldtb_contract_balance d 
--			where d.contract_ref_no = a.contract_ref_no 
--			AND principal_outstanding_bal &gt; 0)
AND a.value_date &lt;= To_date('$POSTINGDATE','yyyymmdd')
AND a.maturity_date &gt;= To_date('$POSTINGDATE','yyyymmdd')

UNION ALL

SELECT /* +parallel(a,6) parallel(b,6) */ 'TD_acct_'
			|| a.contract_ref_no              	"trs_nr_nm"
			,'OL'                      			"accounting_category_nm"
FROM   FCCNGN.ldtb_contract_master a
INNER JOIN MITB_CLASS_MAPPING b ON a.contract_ref_no = b.UNIT_REF_NO
INNER JOIN ldtb_contract_balance e ON  a.contract_ref_no = e.contract_ref_no
WHERE  a.product = (Select b.product_code from cstm_product b 
					where a.product = b.product_code 
					AND b.product_group='DEPO')
AND EXISTS (Select 1 from cstb_contract c 
			where c.contract_ref_no = a.contract_ref_no 
			AND contract_Status = 'A')
AND a.version_no = (Select max(version_no) from ldtb_contract_master d 
					where d.contract_ref_no = a.contract_ref_no 
					group by d.contract_ref_no)
AND maturity_date &gt;= To_date('$POSTINGDATE', 'yyyymmdd')
AND e.principal_outstanding_bal IS NOT NULL</sqlStr>
        <field nameT="TRS_NR_NM" name="trs_nr_nm" type="0" position="0" end="39"/>
        <field nameT="ACCOUNTING_CATEGORY_NM" name="accounting_category_nm" type="0" position="40" end="51"/>
      </model>
      <model id="MM01XXXX_FEE_DIR_IN_PL">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.MM01XXXX_FEE_DIR_IN_PL.ldr"/>
        <option id="recordSize" value="93"/>
        <sqlStr xml:space="preserve"></sqlStr>
        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>
        <field nameT="CHARGE_TYPE_NM" type="0" position="40" end="51"/>
        <field nameT="SALES_TYPE_NM" type="0" position="52" end="61"/>
        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="62" end="69"/>
        <field nameT="CHARGE_AMOUNT" type="0" position="70" end="92"/>
      </model>
      <model id="MM01XXXX_FIX_INT_RAT">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.MM01XXXX_FIX_INT_RAT.ldr"/>
        <option id="recordSize" value="71"/>
        <sqlStr xml:space="preserve">Select distinct
a.contract_ref_no									"trs_nr_nm"
, a.maturity_date									"interest_duration_to"
--, c.frequency										"interest_duration_nm"

/* Bank to decide int method default case. STATUS: UNDECIDED*/ 
, CASE 
	WHEN b.iccf_calc_method = 3 THEN 1
	WHEN b.iccf_calc_method = 5 THEN 4
	WHEN b.iccf_calc_method = 6 THEN 3
	WHEN b.iccf_calc_method = 9 THEN 10
	ELSE 10
END 											"interest_method"
, rate											"interest_rate"
from ldtb_contract_master A
INNER JOIN ldtb_contract_iccf_calc B ON a.contract_ref_no = b.contract_ref_no
INNER JOIN ldtb_contract_schedules C ON a.contract_ref_no = c.contract_ref_no
INNER JOIN cstb_amount_due D ON a.contract_ref_no = d.contract_ref_no
--AND a.component = 'PRINCIPAL' 
--AND c.frequency != 'B'
where  b.start_date &lt;= To_date('$POSTINGDATE','yyyymmdd')
AND a.maturity_date &gt;= To_date('$POSTINGDATE','yyyymmdd')
AND  a.product IN (Select product_code from cstm_product where module = 'MM' and record_stat = 'O')
AND a.contract_status = 'A'
AND a.version_no = (select max(version_no) from ldtb_contract_master y 
				where a.version_no = y.version_no
				AND y.contract_status = 'A'
				)
AND EXISTS (Select 1 from ldtb_contract_balance z 
			where z.contract_ref_no = a.contract_ref_no 
			AND principal_outstanding_bal &gt; 0)
--AND a.contract_ref_no = '002AHRL123260041'
and d.original_due_date = b.schedule_date
AND component = 'INTEREST'
--AND a.contract_ref_no = '998MPAF121290004' --'998MPCL131230001'


UNION ALL

Select distinct
'TD_acct_' || a.contract_ref_no              	"trs_nr_nm"
--, b.start_date									"capital_duration_frm"
--,amount_due
--,amount_settled									"capital_charge_decrease"
, a.maturity_date									"interest_duration_to"
--, c.frequency										"interest_duration_nm"

/* Bank to decide int method default case. STATUS: UNDECIDED*/ 
, CASE 
	WHEN b.iccf_calc_method = 3 THEN 1
	WHEN b.iccf_calc_method = 5 THEN 4
	WHEN b.iccf_calc_method = 6 THEN 3
	WHEN b.iccf_calc_method = 9 THEN 10
	ELSE 10
END 												"interest_method"
, rate												"interest_rate"
from ldtb_contract_master A
INNER JOIN ldtb_contract_iccf_calc B ON a.contract_ref_no = b.contract_ref_no
INNER JOIN ldtb_contract_schedules C ON a.contract_ref_no = c.contract_ref_no
INNER JOIN cstb_amount_due D ON a.contract_ref_no = d.contract_ref_no
--AND a.component = 'PRINCIPAL' 
--AND c.frequency != 'B'
--where  b.start_date &lt;= To_date('20131231','yyyymmdd')
WHERE a.product = (Select b.product_code from cstm_product b 
					where a.product = b.product_code 
					AND b.product_group='DEPO')
AND a.contract_status = 'A'
AND a.version_no = (select max(version_no) from ldtb_contract_master y 
				where a.version_no = y.version_no
				AND y.contract_status = 'A'
				)
AND EXISTS (Select 1 from ldtb_contract_balance z 
			where z.contract_ref_no = a.contract_ref_no 
			AND principal_outstanding_bal &gt; 0
			AND principal_outstanding_bal IS NOT NULL
		  )
--AND a.contract_ref_no = '140PDDC130280001'
AND d.original_due_date = b.schedule_date
AND rate IS NOT NULL
AND component = 'GH_INT_DEP'
AND maturity_date &gt;= To_date('$POSTINGDATE', 'yyyymmdd')
order by 1, 2</sqlStr>
        <field nameT="TRS_NR_NM" name="trs_nr_nm" type="0" position="0" end="39"/>
        <field nameT="INTEREST_DURATION_TO" name="interest_duration_to" format="yyyyMMdd" type="1" position="40" end="47"/>
        <field nameT="INTEREST_DURATION_NM" type="0" position="48" end="59"/>
        <field nameT="INTEREST_METHOD" name="interest_method" type="0" position="60" end="61"/>
        <field nameT="INTEREST_RATE" name="interest_rate" type="0" position="62" end="70"/>
      </model>
      <model id="MM01XXXX_MONEY_MARKET">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.MM01XXXX_MONEY_MARKET.ldr"/>
        <option id="recordSize" value="265"/>
        <sqlStr xml:space="preserve">Select 
a.contract_ref_no		"trs_nr_nm"
,CASE 
	WHEN substr(product,1,2) = 'MP' THEN 'A'
	WHEN substr(product,1,2) = 'MT' THEN 'L'
 END 					"al"
,a.contract_status		"activev"
, a.counterparty		"ext_key_address"
, a.booking_date
, a.value_date			"trs_date"
, a.product				"motive_nm"
, a.currency			"ext_key_currency"
, a.amount 			"capital_nominal"
, a.value_date			"capital_duration_frm"
, a.maturity_date		"capital_duration_to"
, 'N'				"capital_calendar_type"
, NULL				"yield"
, a.branch			"organisation_unit_nm"
, NULL				"dealer_nm"
, NULL				"bank_segment_nm"
, NULL				"place_of_contract_nm"
, NULL				"ext_product_key"
, NULL 				"cost_center_nm"
from ldtb_contract_master a 
WHERE a.contract_status = 'A'
AND product IN ( Select product_code from cstm_product where module = 'MM' and record_stat = 'O')
AND a.version_no = (select max(version_no) from ldtb_contract_master c 
				where a.version_no = c.version_no
				AND c.contract_status = 'A'
				)
AND EXISTS (Select 1 from ldtb_contract_balance d 
			where d.contract_ref_no = a.contract_ref_no 
			AND principal_outstanding_bal &gt; 0)
AND a.value_date &lt;= To_date('$POSTINGDATE','yyyymmdd')
AND a.maturity_date &gt;= To_date('$POSTINGDATE','yyyymmdd')

UNION ALL

SELECT /* +parallel(a,6) parallel(b,6) */ 'TD_acct_'
			|| a.contract_ref_no              	"trs_nr_nm"
					  , 'L'                     "al"
					  ,	a.contract_status		"activev"
					  , a.counterparty          "ext_key_address"
					  , a.booking_date
					  , a.value_date			"trs_date"
					  , a.product               "motive_nm"
					  , a.currency   			"ext_key_currency"
					  , a.amount 				"capital_nominal"
					  , a.value_date			"capital_duration_frm"
					  , a.maturity_date         "capital_duration_to"
					  , 'N'					    "capital_calendar_type"
					  , NULL					"yield"
					  , a.branch                "organization_unit_nm"
					  ,  b.COMP_MIS_2           "dealer_nm"
					  , NULL                     "bank_segment_nm"
					  , NULL				     "place_of_contract_nm"
					  , NULL				     "ext_product_key"
					  , NULL                     "cost_center_nm"
					 
FROM   FCCNGN.ldtb_contract_master a
INNER JOIN MITB_CLASS_MAPPING b ON a.contract_ref_no = b.UNIT_REF_NO
INNER JOIN ldtb_contract_balance e ON  a.contract_ref_no = e.contract_ref_no
WHERE  a.product = (Select b.product_code from cstm_product b 
					where a.product = b.product_code 
					AND b.product_group='DEPO')
AND EXISTS (Select 1 from cstb_contract c 
			where c.contract_ref_no = a.contract_ref_no 
			AND contract_Status = 'A')
AND a.version_no = (Select max(version_no) from ldtb_contract_master d 
					where d.contract_ref_no = a.contract_ref_no 
					group by d.contract_ref_no)
AND maturity_date &gt;= To_date('$POSTINGDATE', 'yyyymmdd')
AND e.principal_outstanding_bal IS NOT NULL</sqlStr>
        <field nameT="TRS_NR_NM" name="trs_nr_nm" type="0" position="0" end="39"/>
        <field nameT="AL" name="al" type="0" position="40" end="40"/>
        <field nameT="EXT_KEY_ADDRESS" name="ext_key_address" type="0" position="41" end="70"/>
        <field nameT="TRS_DATE" name="trs_date" format="yyyyMMdd" type="1" position="71" end="78"/>
        <field nameT="MOTIVE_NM" name="motive_nm" type="0" position="79" end="88"/>
        <field nameT="EXT_KEY_CURRENCY" name="ext_key_currency" type="0" position="89" end="118"/>
        <field nameT="CAPITAL_NOMINAL" name="capital_nominal" type="0" position="119" end="141"/>
        <field nameT="CAPITAL_DURATION_FRM" name="capital_duration_frm" format="yyyyMMdd" type="1" position="142" end="149"/>
        <field nameT="CAPITAL_DURATION_TO" name="capital_duration_to" format="yyyyMMdd" type="1" position="150" end="157"/>
        <field nameT="CAPITAL_CALENDAR_TYPE_NM" name="capital_calendar_type" type="0" position="158" end="169"/>
        <field nameT="ORGANISATION_UNIT_NM" name="organisation_unit_nm" type="0" position="170" end="181"/>
        <field nameT="DEALER_NM" name="dealer_nm" type="0" position="182" end="216"/>
        <field nameT="BANK_SEGMENT_NM" name="bank_segment_nm" type="0" position="217" end="236"/>
        <field nameT="PLACE_OF_CONTRACT_NM" name="place_of_contract_nm" type="0" position="237" end="256"/>
        <field nameT="COST_CENTER_NM" name="cost_center_nm" type="0" position="257" end="264"/>
      </model>
    </group>
    <group id="non-fin">
      <option id="active" value="1"/>
      <model id="NF01XXXX_ACC_BAL_NOM_AMO">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.NF01XXXX_ACC_BAL_NOM_AMO.ldr"/>
        <option id="recordSize" value="64"/>
        <sqlStr xml:space="preserve">SELECT To_char(B.GL_CODE)                      "current_account_number"
       , CASE
	   WHEN SUM(b.cr_bal_lcy - b.dr_bal_lcy) &lt; 0 THEN 'D'
	   ELSE 'C'
	 END                                   "credit_debit"
       , Abs(SUM(b.cr_bal_lcy - b.dr_bal_lcy)) "capital"
FROM   fccngn.GLtb_GL_bal B
WHERE  b.fin_year = 'FY'
		    ||To_char(To_date('$POSTINGDATE', 'YYYYMMDD'), 'YYYY')
      -- AND b.period_code = 'M' ||To_char(To_date('$POSTINGDATE', 'YYYYMMDD'), 'MM')
GROUP  BY B.GL_CODE
ORDER  BY 1 </sqlStr>
        <field nameT="CURRENT_ACCOUNT_NUMBER" name="current_account_number" type="0" position="0" end="39"/>
        <field nameT="CREDIT_DEBIT" name="credit_debit" type="0" position="40" end="40"/>
        <field nameT="CAPITAL" name="capital" type="0" position="41" end="63"/>
      </model>
      <model id="NF01XXXX_NON_FIN_INS">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.NF01XXXX_NON_FIN_INS.ldr"/>
        <option id="recordSize" value="211"/>
        <sqlStr xml:space="preserve">Select GL_CODE  						"current_account_number"
	,'ECOBANK-NG'						"ext_key_address"
	,CASE
		WHEN category = 1 THEN 'NFI-A'
		WHEN category = 2 THEN 'NFI-L'
		WHEN category = 3 THEN 'NFI-INC'
		WHEN category = 4 THEN 'NFI-EXP'
		WHEN category = 5 THEN 'NFI-A-OBAL'
		WHEN category = 6 THEN 'NFI-L-OBAL'
	END								"trstype_nm"
	,NULL							"motive_Nm"
	,CCY_CODE 						"ext_key_currency"
	,NULL							"acc_start_date"
	,NULL 							"organisation_Unit_Nm"
	,NULL							"dealer_Nm"
	,NULL 							"Bank_segment_Nm"
	,NULL							"cost_center_Nm"
	,NULL							"Capital_duration_to"
from  fccngn.GLtb_GL_bal B 
where b.fin_year = 'FY' || To_char(To_date('$POSTINGDATE', 'YYYYMMDD'), 'YYYY')
AND category NOT IN (8, 9)
--AND b.period_code = 'M' || To_char(To_date('$POSTINGDATE', 'YYYYMMDD'), 'MM')</sqlStr>
        <field nameT="CURRENT_ACCOUNT_NUMBER" name="current_account_number" type="0" position="0" end="39"/>
        <field nameT="EXT_KEY_ADDRESS" name="ext_key_address" type="0" position="40" end="69"/>
        <field nameT="TRSTYPE_NM" name="trstype_nm" type="0" position="70" end="79"/>
        <field nameT="MOTIVE_NM" name="motive_Nm" type="0" position="80" end="89"/>
        <field nameT="EXT_KEY_CURRENCY" name="ext_key_currency" type="0" position="90" end="119"/>
        <field nameT="ACC_START_DATE" name="acc_start_date" format="yyyyMMdd" type="1" position="120" end="127"/>
        <field nameT="ORGANISATION_UNIT_NM" name="organisation_Unit_Nm" type="0" position="128" end="139"/>
        <field nameT="DEALER_NM" name="dealer_Nm" type="0" position="140" end="174"/>
        <field nameT="BANK_SEGMENT_NM" name="Bank_segment_Nm" type="0" position="175" end="194"/>
        <field nameT="COST_CENTER_NM" name="cost_center_Nm" type="0" position="195" end="202"/>
        <field nameT="CAPITAL_DURATION_TO" name="Capital_duration_to" format="yyyyMMdd" type="1" position="203" end="210"/>
      </model>
    </group>
    <group id="account">
      <option id="active" value="1"/>
      <model id="AC01XXXX_ACC_BAL_NOM_AMO">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.AC01XXXX_ACC_BAL_NOM_AMO.ldr"/>
        <option id="recordSize" value="64"/>
        <sqlStr xml:space="preserve">SELECT 'cust_acct_'
       || a.cust_ac_no              		"current_account_number"
       , CASE
           WHEN acy_avl_bal &lt; 0 THEN 'D'
           ELSE 'C'
         END           						"credit_debit"
       ,Abs(round(acy_avl_bal,2)) 			"capital"     
FROM   FCCNGN.STTM_CUST_ACCOUNT a
INNER JOIN MITB_CLASS_MAPPING b ON a.cust_ac_no = b.UNIT_REF_NO
WHERE  AC_OPEN_DATE &lt;= To_date('$POSTINGDATE', 'yyyymmdd')
AND record_stat = 'O' AND a.acy_avl_bal IS NOT NULL
AND a.CCY IS NOT NULL</sqlStr>
        <field nameT="CURRENT_ACCOUNT_NUMBER" name="current_account_number" type="0" position="0" end="39"/>
        <field nameT="CREDIT_DEBIT" name="credit_debit" type="0" position="40" end="40"/>
        <field nameT="CAPITAL" name="capital" type="0" position="41" end="63"/>
      </model>
      <model id="AC01XXXX_ACC_INC_INT">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.AC01XXXX_ACC_INC_INT.ldr"/>
        <option id="recordSize" value="79"/>
        <sqlStr xml:space="preserve">SELECT distinct 'cust_acct_'
       || a.cust_ac_no              	"current_account_number"
	   , 176                      		"company"
       , d.last_schd_liq_dt			 	"charge_duration_frm"
       , d.next_schd_liq_dt	 			"charge_valuta"
       , c.amt							"charge_amount" 
FROM   FCCNGN.STTM_CUST_ACCOUNT a, ictb_entries c, ictb_acc_pr d
,MITB_CLASS_MAPPING b  
WHERE  a.cust_ac_no = b.UNIT_REF_NO
AND a.cust_ac_no = c.acc AND a.cust_ac_no = d.acc
AND a.AC_OPEN_DATE  &lt;= To_date('$POSTINGDATE', 'yyyymmdd')
AND d.last_schd_liq_dt &lt;= To_date('$POSTINGDATE', 'yyyymmdd')
AND d.next_schd_liq_dt &gt;= To_date('20131231', 'yyyymmdd')
AND amt &gt; 0 AND  c.prod in ('SAIN','OINT','CAIN')
AND record_stat = 'O' AND a.acy_avl_bal IS NOT NULL</sqlStr>
        <field nameT="CURRENT_ACCOUNT_NUMBER" name="current_account_number" type="0" position="0" end="39"/>
        <field nameT="CHARGE_DURATION_FRM" name="charge_duration_frm" format="yyyyMMdd" type="1" position="40" end="47"/>
        <field nameT="CHARGE_VALUTA" name="charge_valuta" format="yyyyMMdd" type="1" position="48" end="55"/>
        <field nameT="CHARGE_AMOUNT" name="charge_amount" type="0" position="56" end="78"/>
      </model>
      <model id="AC01XXXX_ACC_OUT_INT">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.AC01XXXX_ACC_OUT_INT.ldr"/>
        <option id="recordSize" value="79"/>
        <sqlStr xml:space="preserve">SELECT distinct 'cust_acct_'
       || a.cust_ac_no              	"current_account_number"
	   , 176                      		"company"
       , d.last_schd_liq_dt			 	"charge_duration_frm"
       , d.next_schd_liq_dt	 			"charge_valuta"
       , c.amt							"charge_amount" 
FROM   FCCNGN.STTM_CUST_ACCOUNT a, ictb_entries c, ictb_acc_pr d
,MITB_CLASS_MAPPING b  
WHERE  a.cust_ac_no = b.UNIT_REF_NO
AND a.cust_ac_no = c.acc AND a.cust_ac_no = d.acc
AND a.AC_OPEN_DATE  &lt;= To_date('$POSTINGDATE', 'yyyymmdd')
AND d.last_schd_liq_dt &lt;= To_date('$POSTINGDATE', 'yyyymmdd')
AND d.next_schd_liq_dt &gt;= To_date('20131231', 'yyyymmdd')
AND amt &lt; 0 AND  c.prod in ('SAIN','OINT','CAIN')
AND record_stat = 'O' AND a.acy_avl_bal IS NOT NULL</sqlStr>
        <field nameT="CURRENT_ACCOUNT_NUMBER" name="current_account_number" type="0" position="0" end="39"/>
        <field nameT="CHARGE_DURATION_FRM" name="charge_duration_frm" format="yyyyMMdd" type="1" position="40" end="47"/>
        <field nameT="CHARGE_VALUTA" name="charge_valuta" format="yyyyMMdd" type="1" position="48" end="55"/>
        <field nameT="CHARGE_AMOUNT" name="charge_amount" type="0" position="56" end="78"/>
      </model>
      <model id="AC01XXXX_ASS_TO_IMP_POR">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.AC01XXXX_ASS_TO_IMP_POR.ldr"/>
        <option id="recordSize" value="70"/>
        <sqlStr xml:space="preserve"></sqlStr>
        <field nameT="CURRENT_ACCOUNT_NUMBER" type="0" position="0" end="39"/>
        <field nameT="PORTFOLIO_NM" type="0" position="40" end="69"/>
      </model>
      <model id="AC01XXXX_CURRENT_ACCOUNT">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.AC01XXXX_CURRENT_ACCOUNT.ldr"/>
        <option id="recordSize" value="201"/>
        <sqlStr xml:space="preserve">SELECT 'cust_acct_'
       || a.cust_ac_no              "current_account_number"
	   , 176                      	"company"
       , a.cust_no              	"ext_key_address"
       , a.account_class            "motive_nm"
       , a.CCY						"ext_key_currency"
       , a.AC_OPEN_DATE            	"acct_start_date"
       , a.BRANCH_CODE              "organization_unit_nm"
       , b.COMP_MIS_2             	"dealer_nm"
       , NULL                      	"bank_segment_nm"
       , NULL                      	"cost_center_nm"
       , NULL                      	"capital_duration_to"       
FROM   FCCNGN.STTM_CUST_ACCOUNT a
INNER JOIN MITB_CLASS_MAPPING b ON a.cust_ac_no = b.UNIT_REF_NO
WHERE  AC_OPEN_DATE &lt;= To_date('$POSTINGDATE', 'yyyymmdd')
AND record_stat = 'O' AND a.acy_avl_bal IS NOT NULL
AND a.CCY IS NOT NULL</sqlStr>
        <field nameT="CURRENT_ACCOUNT_NUMBER" name="current_account_number" type="0" position="0" end="39"/>
        <field nameT="EXT_KEY_ADDRESS" name="ext_key_address" type="0" position="40" end="69"/>
        <field nameT="MOTIVE_NM" name="motive_nm" type="0" position="70" end="79"/>
        <field nameT="EXT_KEY_CURRENCY" name="ext_key_currency" type="0" position="80" end="109"/>
        <field nameT="ACC_START_DATE" name="acct_start_date" format="yyyyMMdd" type="1" position="110" end="117"/>
        <field nameT="ORGANISATION_UNIT_NM" name="organization_unit_nm" type="0" position="118" end="129"/>
        <field nameT="DEALER_NM" name="dealer_nm" type="0" position="130" end="164"/>
        <field nameT="BANK_SEGMENT_NM" name="bank_segment_nm" type="0" position="165" end="184"/>
        <field nameT="COST_CENTER_NM" name="cost_center_nm" type="0" position="185" end="192"/>
        <field nameT="CAPITAL_DURATION_TO" name="capital_duration_to" format="yyyyMMdd" type="1" position="193" end="200"/>
      </model>
      <model id="AC01XXXX_IMP_ADJ">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.AC01XXXX_IMP_ADJ.ldr"/>
        <option id="recordSize" value="71"/>
        <sqlStr xml:space="preserve"></sqlStr>
        <field nameT="CURRENT_ACCOUNT_NUMBER" type="0" position="0" end="39"/>
        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="40" end="47"/>
        <field nameT="CHARGE_AMOUNT" type="0" position="48" end="70"/>
      </model>
      <model id="AC01XXXX_WRITE_OFF">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.AC01XXXX_WRITE_OFF.ldr"/>
        <option id="recordSize" value="71"/>
        <sqlStr xml:space="preserve"></sqlStr>
        <field nameT="CURRENT_ACCOUNT_NUMBER" type="0" position="0" end="39"/>
        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="40" end="47"/>
        <field nameT="CHARGE_AMOUNT" type="0" position="48" end="70"/>
      </model>
    </group>
    <group id="common">
      <option id="active" value="0"/>
      <model id="CONTROL_CONTROL_FILE">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.CONTROL_CONTROL_FILE.ldr"/>
        <option id="recordSize" value="18"/>
        <sqlStr xml:space="preserve">SELECT  To_date('$POSTINGDATE', 'YYYYMMDD')  "booking_date"
       , '$MODE'                             "import_period_nm"
FROM   dual
</sqlStr>        <field nameT="BOOKING_DATE" name="booking_date" format="yyyyMMdd" type="1" position="0" end="7"/>        <field nameT="IMPORT_PERIOD_NM" name="import_period_nm" type="0" position="8" end="17"/>      </model>      <model id="CUSTOMER_GEN_CUS_INF">        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.CUSTOMER_GEN_CUS_INF.ldr"/>        <option id="recordSize" value="943"/>        <sqlStr xml:space="preserve">SELECT CUSTOMER_NO      								"addr_shn"
       , CASE 
       		WHEN Trim(CUSTOMER_TYPE)= 'B' THEN 'BANK'
       		WHEN Trim(CUSTOMER_TYPE)= 'C' THEN 'CORP'
       		WHEN Trim(CUSTOMER_TYPE)= 'I' THEN 'PRIV'
       		ELSE	'PRIV'
       	END 										"addr_type_nm"
       , CUSTOMER_NAME1      							"name_1"
       , ADDRESS_LINE1      				 			"name_2"
       , SUBSTR(ADDRESS_LINE3,  1, 30)       			"town"
       , SUBSTR(ADDRESS_LINE2, 1, 30)      				"name_3"
       , SUBSTR(ADDRESS_LINE4, 1, 30)       				"federal_state"
       , SUBSTR(COUNTRY, 1, 30)             				"ext_key_ctry_addr"
       --, CUSTOMER_CATEGORY
       --, PAST_DUE_FLAG
       --, GROUP_CODE
       --, EXPOSURE_CATEGORY
       --, CUST_CLASSIFICATION
       , NULL                "ext_key_bbranch"
       , NULL                "federal_state_nm"
FROM   fccngn.STTM_CUSTOMER
WHERE CUSTOMER_TYPE IS NOT NULL

UNION

SELECT To_char(fbo_id_num)  									"ADDR_SHN"
		,CASE
				WHEN cpty_type = 'INDV' THEN 'PRIV'
				WHEN cpty_type = 'OTHIN' THEN 'BANK'
				ELSE cpty_type
		END 												"addr_type_nm"
        , CASE
               WHEN short_name_1 IS NOT NULL THEN short_name_1
                 ELSE To_char(fbo_id_num)
          END                 									"NAME_1"
        , NULL 													"NAME_2"
        , NULL                								"TOWN"
        , NULL												"NAME_3"
        , NULL												"federal_state"
	   , CASE
		 	WHEN ( cour IS NULL
				 OR Trim(cour) = 'XXX'
				 OR Trim(cour) = '.' ) THEN 'NG'
		 	ELSE cour
		END                 									"EXT_KEY_CTRY_ADDR"
       , NULL               									 "ext_key_bbranch"
       , NULL                									"federal_state_nm"
FROM   obnlive.sd_cpty
WHERE  cpty_status = 'OK'
AND fbo_id_num &lt;&gt; 0
AND cpty_type IS NOT NULL

UNION

SELECT  'ECOBANK-NG'  		"addr_shn"
       , 'BANK'             	"addr_type_nm"
       , 'ECOBANK-NG'   		"name_1"
       , NULL           		"name_2"
       , 'Lagos'        		"town"
       , NULL           "name_3"
       , NULL           "fedaral state"
       , 'NG'           "ext_key_ctry_addr"
       , NULL           "ext_key_bbranch"
       , NULL           "federal_state_nm"
FROM   DUAL</sqlStr>
        <field nameT="EXT_KEY_ADDRESS" type="0" position="0" end="11"/>
        <field nameT="NAME_1" type="0" position="12" end="211"/>
        <field nameT="NAME_2" type="0" position="212" end="411"/>
        <field nameT="NAME_3" type="0" position="412" end="611"/>
        <field nameT="NAME_4" type="0" position="612" end="811"/>
        <field nameT="TOWN" type="0" position="812" end="846"/>
        <field nameT="EXT_KEY_CTRY_ADDR" type="0" position="847" end="876"/>
        <field nameT="ADDR_TYPE_NM" name="addr_type_nm" type="0" position="877" end="884"/>
        <field nameT="EXT_KEY_BBRANCH" name="ext_key_bbranch" type="0" position="885" end="914"/>
        <field nameT="LEGAL_FORM_NM" type="0" position="915" end="922"/>
        <field nameT="FEDERAL_STATE_NM" name="federal_state_nm" type="0" position="923" end="942"/>
      </model>
      <model id="CUSTOMER_RATING_CRITERIA">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.CUSTOMER_RATING_CRITERIA.ldr"/>
        <option id="recordSize" value="30"/>
        <sqlStr xml:space="preserve">SELECT CUSTOMER_NO      		"addr_shn"
       ,CASE 
       		WHEN risk_category = '1'  THEN 'AAA'
       		WHEN risk_category = '2+' THEN 'AA+'
       		WHEN risk_category = '2'  THEN 'AA'
       		WHEN risk_category = '2-' THEN 'AA-'
       		WHEN risk_category = '3+' THEN 'A+'
       		WHEN risk_category = '3'  THEN 'A'
       		WHEN risk_category = '3-' THEN 'A-'
       		WHEN risk_category = '4+' THEN 'BBB+'
       		WHEN risk_category = '4'  THEN 'BBB'
       		WHEN risk_category = '4-' THEN 'BBB-'
       		WHEN risk_category = '5+' THEN 'BB+'
       		WHEN risk_category = '5'  THEN 'BB'
       		WHEN risk_category = '5-' THEN 'BB-'
       		WHEN risk_category = '6+' THEN 'B+'
       		WHEN risk_category = '6'  THEN 'B'
       		WHEN risk_category = '6-' THEN 'B-'
       		WHEN risk_category = '7+' THEN 'CCC+'
       		WHEN risk_category = '7'  THEN 'CCC'
       		WHEN risk_category = '8'  THEN 'CC'
       		WHEN risk_category = '9'  THEN 'C'
       		WHEN risk_category = '10' THEN 'D'
			ELSE 'AA+'
       END 				       		"addr_Adc_Crit_Contain_Nm"
       ,NULL							"valid"
FROM   fccngn.STTM_CUSTOMER
WHERE risk_category IS NOT NULL
AND CUSTOMER_TYPE IS NOT NULL

UNION

SELECT To_char(fbo_id_num)  		"ADDR_SHN"
	,NULL 					"addr_Adc_Crit_Contain_Nm"
     ,NULL					"valid"
FROM   obnlive.sd_cpty
WHERE  cpty_status = 'OK'
AND fbo_id_num &lt;&gt; 0
AND cpty_type IS NOT NULL


UNION

SELECT  'ECOBANK-NG' 	"addr_shn"
       ,'AA+' 			 "addr_Adc_Crit_Contain_Nm"
       ,NULL			  "valid"
FROM   DUAL</sqlStr>
        <field nameT="EXT_KEY_ADDRESS" name="addr_shn" type="0" position="0" end="11"/>
        <field nameT="VALID" name="valid" format="yyyyMMdd" type="1" position="12" end="19"/>
        <field nameT="ADDR_ABC_CRIT_CONTAIN_NM" name="addr_Adc_Crit_Contain_Nm" type="0" position="20" end="29"/>
      </model>
      <model id="FXRATES_FOR_EXC_RAT">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.FXRATES_FOR_EXC_RAT.ldr"/>
        <option id="recordSize" value="83"/>
        <sqlStr xml:space="preserve">SELECT 176             "company"
       , ccy1          "ext_key_currency_frm"
       , ccy2          "ext_key_currency_to"
       , rate_date	   "valid"
       , mid_rate      "fx_rate_mid"
       , buy_rate
       , sale_rate
FROM   fccngn.cytb_rates_history t1
WHERE  branch_code = '211'
       AND rate_type = 'STANDARD' 
       AND trunc(rate_dt_stamp) &lt;=to_date('$POSTINGDATE', 'YYYYMMDD')
	  AND mid_rate IS NOT NULL
</sqlStr>        <field nameT="VALID" name="valid" format="yyyyMMdd" type="1" position="0" end="7"/>        <field nameT="EXT_KEY_CURRENCY_FRM" name="ext_key_currency_frm" type="0" position="8" end="37"/>        <field nameT="EXT_KEY_CURRENCY_TO" name="ext_key_currency_to" type="0" position="38" end="67"/>        <field nameT="FX_RATE_MID" name="fx_rate_mid" type="0" position="68" end="82"/>      </model>      <model id="INTRATES_INTEREST_RATES">        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.INTRATES_INTEREST_RATES.ldr"/>        <option id="recordSize" value="67"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="VALID" format="yyyyMMdd" type="1" position="0" end="7"/>        <field nameT="EXT_KEY_CURRENCY" type="0" position="8" end="37"/>        <field nameT="RATE_SOURCE_NM" type="0" position="38" end="45"/>        <field nameT="DURATION_NM" type="0" position="46" end="57"/>        <field nameT="INTEREST_RATE_MID" type="0" position="58" end="66"/>      </model>    </group>    <group id="loan">      <option id="active" value="1"/>      <model id="LN01XXXX_ACC_CAT">        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN01XXXX_ACC_CAT.ldr"/>        <option id="recordSize" value="52"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="ACCOUNTING_CATEGORY_NM" type="0" position="40" end="51"/>      </model>      <model id="LN01XXXX_ANNUITIES">        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN01XXXX_ANNUITIES.ldr"/>        <option id="recordSize" value="99"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="CAPITAL_CHG_DECREASE" type="0" position="40" end="62"/>        <field nameT="CAPITAL_CHG_DURATION_FRM" format="yyyyMMdd" type="1" position="63" end="70"/>        <field nameT="CAPITAL_CHG_DURATION_TO" format="yyyyMMdd" type="1" position="71" end="78"/>        <field nameT="CAPITAL_CHG_DURATION_END" format="yyyyMMdd" type="1" position="79" end="86"/>        <field nameT="CAPITAL_CHG_DURATION_NM" type="0" position="87" end="98"/>      </model>      <model id="LN01XXXX_ASS_TO_POR_FOR_CO">        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN01XXXX_ASS_TO_POR_FOR_CO.ldr"/>        <option id="recordSize" value="70"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="PORTFOLIO_NM" type="0" position="40" end="69"/>      </model>      <model id="LN01XXXX_ASS_TO_POR_PRE">        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN01XXXX_ASS_TO_POR_PRE.ldr"/>        <option id="recordSize" value="70"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="PORTFOLIO_NM" type="0" position="40" end="69"/>      </model>      <model id="LN01XXXX_DEAL_EVENTS1">        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN01XXXX_DEAL_EVENTS1.ldr"/>        <option id="recordSize" value="68"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="DEAL_EVENT_TYPE_NM" type="0" position="40" end="59"/>        <field nameT="DEAL_EVENT_DATE" format="yyyyMMdd" type="1" position="60" end="67"/>      </model>      <model id="LN01XXXX_DIR_WRI_OFF_FRA_D">        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN01XXXX_DIR_WRI_OFF_FRA_D.ldr"/>        <option id="recordSize" value="48"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="40" end="47"/>      </model>      <model id="LN01XXXX_EXP_REC_FOR_SPE_I">        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN01XXXX_EXP_REC_FOR_SPE_I.ldr"/>        <option id="recordSize" value="71"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="VALUTA" format="yyyyMMdd" type="1" position="40" end="47"/>        <field nameT="CAPITAL_CHG_DECREASE" type="0" position="48" end="70"/>      </model>      <model id="LN01XXXX_FEE_DIR_IN_PL">        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN01XXXX_FEE_DIR_IN_PL.ldr"/>        <option id="recordSize" value="93"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="CHARGE_TYPE_NM" type="0" position="40" end="51"/>        <field nameT="SALES_TYPE_NM" type="0" position="52" end="61"/>        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="62" end="69"/>        <field nameT="CHARGE_AMOUNT" type="0" position="70" end="92"/>      </model>      <model id="LN01XXXX_FIX_INT_TRA">        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN01XXXX_FIX_INT_TRA.ldr"/>        <option id="recordSize" value="83"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="INTEREST_DURATION_TO" format="yyyyMMdd" type="1" position="40" end="47"/>        <field nameT="INTEREST_DURATION_NM" type="0" position="48" end="59"/>        <field nameT="INTEREST_METHOD" type="0" position="60" end="61"/>        <field nameT="INTEREST_RATE" type="0" position="62" end="70"/>        <field nameT="PAY_AGREEMENT_NM" type="0" position="71" end="82"/>      </model>      <model id="LN01XXXX_IMPAIRMENT_END">        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN01XXXX_IMPAIRMENT_END.ldr"/>        <option id="recordSize" value="48"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="40" end="47"/>      </model>      <model id="LN01XXXX_IRR_OUT_CON">        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN01XXXX_IRR_OUT_CON.ldr"/>        <option id="recordSize" value="71"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="VALUTA" format="yyyyMMdd" type="1" position="40" end="47"/>        <field nameT="CAPITAL_CHG_INCREASE" type="0" position="48" end="70"/>      </model>      <model id="LN01XXXX_IRR_REP_UNE">        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN01XXXX_IRR_REP_UNE.ldr"/>        <option id="recordSize" value="71"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="VALUTA" format="yyyyMMdd" type="1" position="40" end="47"/>        <field nameT="CAPITAL_CHG_DECREASE" type="0" position="48" end="70"/>      </model>      <model id="LN01XXXX_ONE_TIM_AMO_FEE_E">        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN01XXXX_ONE_TIM_AMO_FEE_E.ldr"/>        <option id="recordSize" value="101"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="CHARGE_TYPE_NM" type="0" position="40" end="51"/>        <field nameT="SALES_TYPE_NM" type="0" position="52" end="61"/>        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="62" end="69"/>        <field nameT="CHARGE_DATE_CHANGE" format="yyyyMMdd" type="1" position="70" end="77"/>        <field nameT="CHARGE_AMOUNT" type="0" position="78" end="100"/>      </model>      <model id="LN01XXXX_OVE_NOT_AFF_ACC">        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN01XXXX_OVE_NOT_AFF_ACC.ldr"/>        <option id="recordSize" value="97"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="CHARGE_TYPE_NM" type="0" position="40" end="51"/>        <field nameT="SALES_TYPE_NM" type="0" position="52" end="61"/>        <field nameT="CHARGE_AMOUNT" type="0" position="62" end="84"/>        <field nameT="PAY_AGREEMENT_NM" type="0" position="85" end="96"/>      </model>      <model id="LN01XXXX_PAYMENT_EVENTS">        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN01XXXX_PAYMENT_EVENTS.ldr"/>        <option id="recordSize" value="209"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="MONEY_TYPE_MAIN_NM" type="0" position="40" end="51"/>        <field nameT="PAYMENT_IN_OUT" type="0" position="52" end="52"/>        <field nameT="EXT_KEY_CURRENCY" type="0" position="53" end="82"/>        <field nameT="EXT_KEY_CURRENCY_NM" type="0" position="83" end="102"/>        <field nameT="VALUTA" format="yyyyMMdd" type="1" position="103" end="110"/>        <field nameT="SALES_TYPE_NM" type="0" position="111" end="120"/>        <field nameT="PAY_AGREEMENT_NM" type="0" position="121" end="132"/>        <field nameT="VALUE" type="0" position="133" end="170"/>        <field nameT="AMOUNT_BAL" type="0" position="171" end="208"/>      </model>      <model id="LN01XXXX_PENALTY_INTEREST">        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN01XXXX_PENALTY_INTEREST.ldr"/>        <option id="recordSize" value="71"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="40" end="47"/>        <field nameT="CHARGE_AMOUNT" type="0" position="48" end="70"/>      </model>      <model id="LN01XXXX_REA_PAY_IN_IMP">        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN01XXXX_REA_PAY_IN_IMP.ldr"/>        <option id="recordSize" value="71"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="40" end="47"/>        <field nameT="CHARGE_AMOUNT" type="0" position="48" end="70"/>      </model>      <model id="LN01XXXX_REG_REP_CON">        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN01XXXX_REG_REP_CON.ldr"/>        <option id="recordSize" value="99"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="CAPITAL_CHG_DECREASE" type="0" position="40" end="62"/>        <field nameT="CAPITAL_CHG_DURATION_FRM" format="yyyyMMdd" type="1" position="63" end="70"/>        <field nameT="CAPITAL_CHG_DURATION_TO" format="yyyyMMdd" type="1" position="71" end="78"/>        <field nameT="CAPITAL_CHG_DURATION_END" format="yyyyMMdd" type="1" position="79" end="86"/>        <field nameT="CAPITAL_CHG_DURATION_NM" type="0" position="87" end="98"/>      </model>      <model id="LN01XXXX_STANDARD_LOAN">        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN01XXXX_STANDARD_LOAN.ldr"/>        <option id="recordSize" value="272"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="EXT_KEY_ADDRESS" type="0" position="40" end="69"/>        <field nameT="TRS_DATE" format="yyyyMMdd" type="1" position="70" end="77"/>        <field nameT="MOTIVE_NM" type="0" position="78" end="87"/>        <field nameT="EXT_KEY_CURRENCY" type="0" position="88" end="117"/>        <field nameT="CAPITAL_NOMINAL" type="0" position="118" end="140"/>        <field nameT="CAPITAL_DURATION_FRM" format="yyyyMMdd" type="1" position="141" end="148"/>        <field nameT="CAPITAL_DURATION_TO" format="yyyyMMdd" type="1" position="149" end="156"/>        <field nameT="CAPITAL_CALENDAR_TYPE_NM" type="0" position="157" end="168"/>        <field nameT="ORGANISATION_UNIT_NM" type="0" position="169" end="180"/>        <field nameT="DEALER_NM" type="0" position="181" end="215"/>        <field nameT="BANK_SEGMENT_NM" type="0" position="216" end="235"/>        <field nameT="PLACE_OF_CONTRACT_NM" type="0" position="236" end="255"/>        <field nameT="EXT_PRODUCT_NM" type="0" position="256" end="263"/>        <field nameT="COST_CENTER_NM" type="0" position="264" end="271"/>      </model>      <model id="LN01XXXX_STA_OF_SPE_IMP">        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN01XXXX_STA_OF_SPE_IMP.ldr"/>        <option id="recordSize" value="48"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="VALUTA" format="yyyyMMdd" type="1" position="40" end="47"/>      </model>      <model id="LN01XXXX_WRI_OFF_AFT_IMP">        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN01XXXX_WRI_OFF_AFT_IMP.ldr"/>        <option id="recordSize" value="48"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="40" end="47"/>      </model>      <model id="LN01XXXX_YIE_ENH_FEE">        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN01XXXX_YIE_ENH_FEE.ldr"/>        <option id="recordSize" value="95"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="SALES_TYPE_NM" type="0" position="40" end="49"/>        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="50" end="57"/>        <field nameT="CHARGE_DURATION_TO" format="yyyyMMdd" type="1" position="58" end="65"/>        <field nameT="CHARGE_DURATION_NM" type="0" position="66" end="77"/>        <field nameT="CHARGE_DATE_CHANGE" format="yyyyMMdd" type="1" position="78" end="85"/>        <field nameT="CHARGE_RATE" type="0" position="86" end="94"/>      </model>      <model id="LN02XXXX_ACC_CAT">        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN02XXXX_ACC_CAT.ldr"/>        <option id="recordSize" value="52"/>        <sqlStr xml:space="preserve">Select 
a.contract_ref_no		"trs_nr_nm"
,'LAR'					"accounting_category_nm"
from ldtb_contract_master a 
LEFT OUTER JOIN MITB_CLASS_MAPPING b ON a.contract_ref_no = b.unit_ref_no
WHERE a.product IN ('AHRL', 'AHRG')
AND a.contract_status = 'A'
AND a.version_no = (select max(version_no) from ldtb_contract_master c 
				where a.version_no = c.version_no
				AND c.contract_status = 'A'
				)
AND EXISTS (Select 1 from ldtb_contract_balance d 
			where d.contract_ref_no = a.contract_ref_no 
			AND principal_outstanding_bal &gt; 0)
AND a.value_date &lt;= To_date('$POSTINGDATE','yyyymmdd')
AND a.maturity_date &gt;= To_date('$POSTINGDATE','yyyymmdd')</sqlStr>
        <field nameT="TRS_NR_NM" name="trs_nr_nm" type="0" position="0" end="39"/>
        <field nameT="ACCOUNTING_CATEGORY_NM" name="accounting_category_nm" type="0" position="40" end="51"/>
      </model>
      <model id="LN02XXXX_ANNUITIES">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN02XXXX_ANNUITIES.ldr"/>
        <option id="recordSize" value="99"/>
        <sqlStr xml:space="preserve">SELECT distinct
a.contract_ref_no				"trs_nr_nm"
--, b.component					
, a.frm_date					"capital_duration_frm"
, b.amount_due
, b.amount_settled				"capital_charge_decrease"
, a.to_date 					"capital_duration_to"
, d.maturity_date				"capital_chg_duration_end"
, c.frequency					"capital_duration_nm"
FROM
(
	Select 
	t1.contract_ref_no
	, t1.value_date frm_date
	, ( select min(t2.original_due_date)  from cstb_amount_due t2 
		where t2.contract_ref_no = t1.contract_ref_no
		AND original_due_date  &gt; t1.value_date
	   ) to_date
	from ( 
	Select 
		contract_ref_no
		, value_date 
	from ldtb_contract_master 
	--where contract_ref_no = '002AHRL123260041'--'211AHRL131070008'
	UNION 
	Select 
		contract_ref_no
		, original_due_date 
	from cstb_amount_due 
	where component = 'PRINCIPAL' 
	--AND contract_ref_no = '002AHRL123260041'--'211AHRL131070008'
	) t1 
) A
INNER JOIN cstb_amount_due B  ON A.contract_ref_no = B.contract_ref_no
INNER JOIN ldtb_contract_schedules C ON A.contract_ref_no = C.contract_ref_no
INNER JOIN ldtb_contract_master D ON A.contract_ref_no = D.contract_ref_no
WHERE B.component = 'PRINCIPAL' 
AND c.frequency != 'B'
AND A.to_date = B.due_date
--AND A.frm_date &lt;= To_date('$POSTINGDATE','yyyymmdd')
AND D.maturity_date &gt;= To_date('$POSTINGDATE','yyyymmdd')
AND  D.product IN ('AHRL', 'AHRG')
AND D.contract_status = 'A'
AND B.amount_settled != 0
AND D.version_no = (select max(version_no) from ldtb_contract_master y 
				where D.version_no = y.version_no
				AND y.contract_status = 'A'
				)
AND EXISTS (Select 1 from ldtb_contract_balance z 
			where z.contract_ref_no = D.contract_ref_no 
			AND principal_outstanding_bal &gt; 0)
ORDER BY a.frm_date

/* SIMPLER VERSION
Select 
a.contract_ref_no		"trs_nr_nm"
, b.start_date			"capital_duration_frm"
,amount_due
,amount_settled		"capital_charge_decrease"
, b.schedule_date		"capital_duration_to"
, a.maturity_date		"capital_chg_duration_end"
, c.frequency			"capital_duration_nm"
from ldtb_contract_master a
INNER JOIN ldtb_contract_iccf_calc B ON a.contract_ref_no = b.contract_ref_no
INNER JOIN ldtb_contract_schedules C ON a.contract_ref_no = c.contract_ref_no
INNER JOIN cstb_amount_due D ON a.contract_ref_no = d.contract_ref_no
--AND a.component = 'PRINCIPAL' 
AND c.frequency != 'B'
where  a.contract_ref_no = '002AHRL123260041'
and d.original_due_date = b.schedule_date
AND component = 'PRINCIPAL' 
order by 2
*/</sqlStr>
        <field nameT="TRS_NR_NM" name="trs_nr_nm" type="0" position="0" end="39"/>
        <field nameT="CAPITAL_CHG_DECREASE" name="capital_charge_decrease" type="0" position="40" end="62"/>
        <field nameT="CAPITAL_CHG_DURATION_FRM" name="capital_chg_duration_end" format="yyyyMMdd" type="1" position="63" end="70"/>
        <field nameT="CAPITAL_CHG_DURATION_TO" name="capital_chg_duration_end" format="yyyyMMdd" type="1" position="71" end="78"/>
        <field nameT="CAPITAL_CHG_DURATION_END" name="capital_chg_duration_end" format="yyyyMMdd" type="1" position="79" end="86"/>
        <field nameT="CAPITAL_CHG_DURATION_NM" name="capital_chg_duration_end" type="0" position="87" end="98"/>
      </model>
      <model id="LN02XXXX_ASS_TO_POR_FOR_CO">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN02XXXX_ASS_TO_POR_FOR_CO.ldr"/>
        <option id="recordSize" value="70"/>
        <sqlStr xml:space="preserve"></sqlStr>
        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>
        <field nameT="PORTFOLIO_NM" type="0" position="40" end="69"/>
      </model>
      <model id="LN02XXXX_ASS_TO_POR_PRE">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN02XXXX_ASS_TO_POR_PRE.ldr"/>
        <option id="recordSize" value="70"/>
        <sqlStr xml:space="preserve"></sqlStr>
        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>
        <field nameT="PORTFOLIO_NM" type="0" position="40" end="69"/>
      </model>
      <model id="LN02XXXX_BMRLOAN">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN02XXXX_BMRLOAN.ldr"/>
        <option id="recordSize" value="282"/>
        <sqlStr xml:space="preserve">Select 
a.contract_ref_no		"trs_nr_nm"
,a.contract_status		"activev"
, a.counterparty		"ext_key_address"
, a.booking_date
, a.value_date			"trs_date"
, a.product				"motive_nm"
, a.currency			"ext_key_currency"
, a.amount 				"capital_nominal"
, a.value_date			"capital_duration_frm"
, a.maturity_date		"capital_duration_to"
, 'N'					"capital_calendar_type"
, NULL					"yield"
, a.branch				"organisation_unit_nm"
, b.comp_mis_2			"dealer_nm"
, NULL					"bank_segment_nm"
, NULL					"place_of_contract_nm"
, NULL					"ext_product_nm"
, NULL 					"cost_center_nm"
from ldtb_contract_master a 
LEFT OUTER JOIN MITB_CLASS_MAPPING b ON a.contract_ref_no = b.unit_ref_no
WHERE a.product IN ('AHRL', 'AHRG')
AND a.contract_status = 'A'
AND a.version_no = (select max(version_no) from ldtb_contract_master c 
				where a.version_no = c.version_no
				AND c.contract_status = 'A'
				)
AND EXISTS (Select 1 from ldtb_contract_balance d 
			where d.contract_ref_no = a.contract_ref_no 
			AND principal_outstanding_bal &gt; 0)
AND a.counterparty IS NOT NULL
AND a.value_date &lt;= To_date('$POSTINGDATE','yyyymmdd')
AND a.maturity_date &gt;= To_date('$POSTINGDATE','yyyymmdd')</sqlStr>
        <field nameT="TRS_NR_NM" name="trs_nr_nm" type="0" position="0" end="39"/>
        <field nameT="ACTIVEV" name="activev" type="0" position="40" end="40"/>
        <field nameT="EXT_KEY_ADDRESS" name="ext_key_address" type="0" position="41" end="70"/>
        <field nameT="TRS_DATE" name="trs_date" format="yyyyMMdd" type="1" position="71" end="78"/>
        <field nameT="MOTIVE_NM" name="motive_nm" type="0" position="79" end="88"/>
        <field nameT="EXT_KEY_CURRENCY" name="ext_key_currency" type="0" position="89" end="118"/>
        <field nameT="CAPITAL_NOMINAL" name="capital_nominal" type="0" position="119" end="141"/>
        <field nameT="CAPITAL_DURATION_FRM" name="capital_duration_frm" format="yyyyMMdd" type="1" position="142" end="149"/>
        <field nameT="CAPITAL_DURATION_TO" name="capital_duration_to" format="yyyyMMdd" type="1" position="150" end="157"/>
        <field nameT="CAPITAL_CALENDAR_TYPE_NM" name="capital_calendar_type" type="0" position="158" end="169"/>
        <field nameT="YIELD" name="yield" type="0" position="170" end="178"/>
        <field nameT="ORGANISATION_UNIT_NM" name="organisation_unit_nm" type="0" position="179" end="190"/>
        <field nameT="DEALER_NM" name="dealer_nm" type="0" position="191" end="225"/>
        <field nameT="BANK_SEGMENT_NM" name="bank_segment_nm" type="0" position="226" end="245"/>
        <field nameT="PLACE_OF_CONTRACT_NM" name="place_of_contract_nm" type="0" position="246" end="265"/>
        <field nameT="EXT_PRODUCT_NM" name="ext_product_nm" type="0" position="266" end="273"/>
        <field nameT="COST_CENTER_NM" name="cost_center_nm" type="0" position="274" end="281"/>
      </model>
      <model id="LN02XXXX_DEAL_EVENTS">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN02XXXX_DEAL_EVENTS.ldr"/>
        <option id="recordSize" value="68"/>
        <sqlStr xml:space="preserve"></sqlStr>
        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>
        <field nameT="DEAL_EVENT_TYPE_NM" type="0" position="40" end="59"/>
        <field nameT="DEAL_EVENT_DATE" format="yyyyMMdd" type="1" position="60" end="67"/>
      </model>
      <model id="LN02XXXX_DIR_WRI_OFF_FRA_D">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN02XXXX_DIR_WRI_OFF_FRA_D.ldr"/>
        <option id="recordSize" value="48"/>
        <sqlStr xml:space="preserve"></sqlStr>
        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>
        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="40" end="47"/>
      </model>
      <model id="LN02XXXX_EXP_REC_FOR_SPE_I">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN02XXXX_EXP_REC_FOR_SPE_I.ldr"/>
        <option id="recordSize" value="71"/>
        <sqlStr xml:space="preserve"></sqlStr>
        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>
        <field nameT="VALUTA" format="yyyyMMdd" type="1" position="40" end="47"/>
        <field nameT="CAPITAL_CHG_DECREASE" type="0" position="48" end="70"/>
      </model>
      <model id="LN02XXXX_FEE_DIR_IN_PL">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN02XXXX_FEE_DIR_IN_PL.ldr"/>
        <option id="recordSize" value="93"/>
        <sqlStr xml:space="preserve"></sqlStr>
        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>
        <field nameT="CHARGE_TYPE_NM" type="0" position="40" end="51"/>
        <field nameT="SALES_TYPE_NM" type="0" position="52" end="61"/>
        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="62" end="69"/>
        <field nameT="CHARGE_AMOUNT" type="0" position="70" end="92"/>
      </model>
      <model id="LN02XXXX_FIX_INT_TRA">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN02XXXX_FIX_INT_TRA.ldr"/>
        <option id="recordSize" value="71"/>
        <sqlStr xml:space="preserve">Select distinct
a.contract_ref_no									"trs_nr_nm"
--, b.start_date									"capital_duration_frm"
--,amount_due
--,amount_settled									"capital_charge_decrease"
, (Select min(x.schedule_date) 
	from ldtb_contract_iccf_calc	x
	where x.contract_ref_no = b.contract_ref_no)	"interest_duration_to"
--, a.maturity_date		"capital_chg_duration_end"
, c.frequency										"interest_duration_nm"
, CASE 
	WHEN b.iccf_calc_method = 3 THEN 1
	WHEN b.iccf_calc_method = 5 THEN 4
	WHEN b.iccf_calc_method = 6 THEN 3
	WHEN b.iccf_calc_method = 9 THEN 10
END 												"interest_method"
, rate												"interest_rate"
from ldtb_contract_master A
INNER JOIN ldtb_contract_iccf_calc B ON a.contract_ref_no = b.contract_ref_no
INNER JOIN ldtb_contract_schedules C ON a.contract_ref_no = c.contract_ref_no
INNER JOIN cstb_amount_due D ON a.contract_ref_no = d.contract_ref_no
--AND a.component = 'PRINCIPAL' 
AND c.frequency != 'B'
--where  b.start_date &lt;= To_date('20131231','yyyymmdd')
WHERE a.maturity_date &gt;= To_date('$POSTINGDATE','yyyymmdd')
AND  a.product IN ('AHRL', 'AHRG')
AND a.contract_status = 'A'
AND a.version_no = (select max(version_no) from ldtb_contract_master y 
				where a.version_no = y.version_no
				AND y.contract_status = 'A'
				)
AND EXISTS (Select 1 from ldtb_contract_balance z 
			where z.contract_ref_no = a.contract_ref_no 
			AND principal_outstanding_bal &gt; 0)
--AND a.contract_ref_no = '002AHRL123260041'
and d.original_due_date = b.schedule_date
AND component IN ('GH_INTLN', 'GH_INTLS')
order by 2</sqlStr>
        <field nameT="TRS_NR_NM" name="trs_nr_nm" type="0" position="0" end="39"/>
        <field nameT="INTEREST_DURATION_TO" name="interest_duration_to" format="yyyyMMdd" type="1" position="40" end="47"/>
        <field nameT="INTEREST_DURATION_NM" name="interest_duration_nm" type="0" position="48" end="59"/>
        <field nameT="INTEREST_METHOD" name="interest_method" type="0" position="60" end="61"/>
        <field nameT="INTEREST_RATE" name="interest_rate" type="0" position="62" end="70"/>
      </model>
      <model id="LN02XXXX_IMPAIRMENT_END">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN02XXXX_IMPAIRMENT_END.ldr"/>
        <option id="recordSize" value="48"/>
        <sqlStr xml:space="preserve"></sqlStr>
        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>
        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="40" end="47"/>
      </model>
      <model id="LN02XXXX_IRR_REP_UNE">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN02XXXX_IRR_REP_UNE.ldr"/>
        <option id="recordSize" value="71"/>
        <sqlStr xml:space="preserve"></sqlStr>
        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>
        <field nameT="VALUTA" format="yyyyMMdd" type="1" position="40" end="47"/>
        <field nameT="CAPITAL_CHG_DECREASE" type="0" position="48" end="70"/>
      </model>
      <model id="LN02XXXX_ONE_TIM_AMO_FEE_E">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN02XXXX_ONE_TIM_AMO_FEE_E.ldr"/>
        <option id="recordSize" value="101"/>
        <sqlStr xml:space="preserve"></sqlStr>
        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>
        <field nameT="CHARGE_TYPE_NM" type="0" position="40" end="51"/>
        <field nameT="SALES_TYPE_NM" type="0" position="52" end="61"/>
        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="62" end="69"/>
        <field nameT="CHARGE_DATE_CHANGE" format="yyyyMMdd" type="1" position="70" end="77"/>
        <field nameT="CHARGE_AMOUNT" type="0" position="78" end="100"/>
      </model>
      <model id="LN02XXXX_OVE_NOT_AFF_ACC">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN02XXXX_OVE_NOT_AFF_ACC.ldr"/>
        <option id="recordSize" value="97"/>
        <sqlStr xml:space="preserve"></sqlStr>
        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>
        <field nameT="CHARGE_TYPE_NM" type="0" position="40" end="51"/>
        <field nameT="SALES_TYPE_NM" type="0" position="52" end="61"/>
        <field nameT="CHARGE_AMOUNT" type="0" position="62" end="84"/>
        <field nameT="PAY_AGREEMENT_NM" type="0" position="85" end="96"/>
      </model>
      <model id="LN02XXXX_PAYMENT_EVENTS">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN02XXXX_PAYMENT_EVENTS.ldr"/>
        <option id="recordSize" value="209"/>
        <sqlStr xml:space="preserve"></sqlStr>
        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>
        <field nameT="MONEY_TYPE_MAIN_NM" type="0" position="40" end="51"/>
        <field nameT="PAYMENT_IN_OUT" type="0" position="52" end="52"/>
        <field nameT="EXT_KEY_CURRENCY" type="0" position="53" end="82"/>
        <field nameT="EXT_KEY_CURRENCY_NM" type="0" position="83" end="102"/>
        <field nameT="VALUTA" format="yyyyMMdd" type="1" position="103" end="110"/>
        <field nameT="SALES_TYPE_NM" type="0" position="111" end="120"/>
        <field nameT="PAY_AGREEMENT_NM" type="0" position="121" end="132"/>
        <field nameT="VALUE" type="0" position="133" end="170"/>
        <field nameT="AMOUNT_BAL" type="0" position="171" end="208"/>
      </model>
      <model id="LN02XXXX_PENALTY_INTEREST">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN02XXXX_PENALTY_INTEREST.ldr"/>
        <option id="recordSize" value="71"/>
        <sqlStr xml:space="preserve"></sqlStr>
        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>
        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="40" end="47"/>
        <field nameT="CHARGE_AMOUNT" type="0" position="48" end="70"/>
      </model>
      <model id="LN02XXXX_PRE_DIS_SAL">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN02XXXX_PRE_DIS_SAL.ldr"/>
        <option id="recordSize" value="83"/>
        <sqlStr xml:space="preserve"></sqlStr>
        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>
        <field nameT="CHARGE_TYPE_NM" type="0" position="40" end="51"/>
        <field nameT="CHARGE_VALUTA" format="yyyyMMdd" type="1" position="52" end="59"/>
        <field nameT="CHARGE_AMOUNT" type="0" position="60" end="82"/>
      </model>
      <model id="LN02XXXX_REA_PAY_IN_IMP">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN02XXXX_REA_PAY_IN_IMP.ldr"/>
        <option id="recordSize" value="71"/>
        <sqlStr xml:space="preserve"></sqlStr>
        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>
        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="40" end="47"/>
        <field nameT="CHARGE_AMOUNT" type="0" position="48" end="70"/>
      </model>
      <model id="LN02XXXX_STA_OF_SPE_IMP">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN02XXXX_STA_OF_SPE_IMP.ldr"/>
        <option id="recordSize" value="48"/>
        <sqlStr xml:space="preserve"></sqlStr>
        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>
        <field nameT="VALUTA" format="yyyyMMdd" type="1" position="40" end="47"/>
      </model>
      <model id="LN02XXXX_WRI_OFF_AFT_IMP">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN02XXXX_WRI_OFF_AFT_IMP.ldr"/>
        <option id="recordSize" value="48"/>
        <sqlStr xml:space="preserve"></sqlStr>
        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>
        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="40" end="47"/>
      </model>
      <model id="LN02XXXX_YIE_ENH_FEE">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN02XXXX_YIE_ENH_FEE.ldr"/>
        <option id="recordSize" value="95"/>
        <sqlStr xml:space="preserve"></sqlStr>
        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>
        <field nameT="SALES_TYPE_NM" type="0" position="40" end="49"/>
        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="50" end="57"/>
        <field nameT="CHARGE_DURATION_TO" format="yyyyMMdd" type="1" position="58" end="65"/>
        <field nameT="CHARGE_DURATION_NM" type="0" position="66" end="77"/>
        <field nameT="CHARGE_DATE_CHANGE" format="yyyyMMdd" type="1" position="78" end="85"/>
        <field nameT="CHARGE_RATE" type="0" position="86" end="94"/>
      </model>
      <model id="LN03XXXX_ACC_CAT">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN03XXXX_ACC_CAT.ldr"/>
        <option id="recordSize" value="52"/>
        <sqlStr xml:space="preserve">Select 
a.contract_ref_no		"trs_nr_nm"
, 'LAR'					"accounting_category_nm"
from ldtb_contract_master a 
LEFT OUTER JOIN MITB_CLASS_MAPPING b ON a.contract_ref_no = b.unit_ref_no
WHERE a.product NOT IN ('AHRL', 'AHRG')
AND a.product IN (Select product_code from cstm_product 
				where product_group = 'LOANS'
				)
AND a.contract_status = 'A'
AND a.version_no = (select max(version_no) from ldtb_contract_master c 
				where a.version_no = c.version_no
				and c.contract_status = 'A')
AND EXISTS (Select 1 from ldtb_contract_balance d 
			where d.contract_ref_no = a.contract_ref_no 
			AND principal_outstanding_bal &gt; 0)
AND a.value_date &lt;= To_date('$POSTINGDATE','yyyymmdd')
AND a.maturity_date &gt;= To_date('$POSTINGDATE','yyyymmdd')
</sqlStr>        <field nameT="TRS_NR_NM" name="trs_nr_nm" type="0" position="0" end="39"/>        <field nameT="ACCOUNTING_CATEGORY_NM" name="accounting_category_nm" type="0" position="40" end="51"/>      </model>      <model id="LN03XXXX_ANNUITIES">        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN03XXXX_ANNUITIES.ldr"/>        <option id="recordSize" value="99"/>        <sqlStr xml:space="preserve">SELECT distinct
a.contract_ref_no				"trs_nr_nm"
--, b.component					
, a.frm_date					"capital_duration_frm"
, b.amount_due
, b.amount_settled				"capital_charge_decrease"
, a.to_date 					"capital_duration_to"
, d.maturity_date				"capital_chg_duration_end"
, c.frequency					"capital_duration_nm"
FROM
(
	Select 
	t1.contract_ref_no
	, t1.value_date frm_date
	, ( select min(t2.original_due_date)  from cstb_amount_due t2 
		where t2.contract_ref_no = t1.contract_ref_no
		AND original_due_date  &gt; t1.value_date
	   ) to_date
	from ( 
	Select 
		contract_ref_no
		, value_date 
	from ldtb_contract_master 
	--where contract_ref_no = '002AFLD121250152'--'211AHRL131070008'
	UNION 
	Select 
		contract_ref_no
		, original_due_date 
	from cstb_amount_due 
	where component = 'PRINCIPAL' 
	--AND contract_ref_no = '002AFLD121250152'--'211AHRL131070008'
	) t1 
) A
INNER JOIN cstb_amount_due B  ON A.contract_ref_no = B.contract_ref_no
INNER JOIN (SELECT a.contract_ref_no, a.frequency  from ldtb_contract_schedules a
		 WHERE a.version_no = (select max(b.version_no) from ldtb_contract_schedules b 
							where a.contract_ref_no = b.contract_ref_no)
		 --AND contract_ref_no = '002AFLD121250152'
		 AND component = 'AMORTISE' 
		 AND a.frequency != 'B'
		 ) C ON A.contract_ref_no = C.contract_ref_no
INNER JOIN ldtb_contract_master D ON A.contract_ref_no = D.contract_ref_no
WHERE B.component = 'PRINCIPAL' 
AND c.frequency != 'B'
AND A.to_date = B.due_date
AND D.value_date &lt;= To_date('$POSTINGDATE','yyyymmdd')
AND D.maturity_date &gt;= To_date('$POSTINGDATE','yyyymmdd')
AND  D.product NOT IN ('AHRL', 'AHRG')
AND D.product IN (Select product_code from cstm_product 
				where product_group = 'LOANS'
				)
AND substr(D.product,1,1) = 'A'
AND D.contract_status = 'A'
AND B.amount_settled != 0
AND D.version_no = (select max(version_no) from ldtb_contract_master y 
				where D.version_no = y.version_no
				and y.contract_status = 'A')
AND EXISTS (Select 1 from ldtb_contract_balance z 
			where z.contract_ref_no = D.contract_ref_no 
			AND principal_outstanding_bal &gt; 0)
ORDER BY a.frm_date
</sqlStr>        <field nameT="TRS_NR_NM" name="trs_nr_nm" type="0" position="0" end="39"/>        <field nameT="CAPITAL_CHG_DECREASE" name="capital_charge_decrease" type="0" position="40" end="62"/>        <field nameT="CAPITAL_CHG_DURATION_FRM" name="capital_chg_duration_end" format="yyyyMMdd" type="1" position="63" end="70"/>        <field nameT="CAPITAL_CHG_DURATION_TO" name="capital_chg_duration_end" format="yyyyMMdd" type="1" position="71" end="78"/>        <field nameT="CAPITAL_CHG_DURATION_END" name="capital_chg_duration_end" format="yyyyMMdd" type="1" position="79" end="86"/>        <field nameT="CAPITAL_CHG_DURATION_NM" name="capital_chg_duration_end" type="0" position="87" end="98"/>      </model>      <model id="LN03XXXX_ASS_TO_POR_FOR_CO">        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN03XXXX_ASS_TO_POR_FOR_CO.ldr"/>        <option id="recordSize" value="70"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="PORTFOLIO_NM" type="0" position="40" end="69"/>      </model>      <model id="LN03XXXX_ASS_TO_POR_PRE">        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN03XXXX_ASS_TO_POR_PRE.ldr"/>        <option id="recordSize" value="70"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="PORTFOLIO_NM" type="0" position="40" end="69"/>      </model>      <model id="LN03XXXX_DEAL_EVENTS1">        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN03XXXX_DEAL_EVENTS1.ldr"/>        <option id="recordSize" value="68"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="DEAL_EVENT_TYPE_NM" type="0" position="40" end="59"/>        <field nameT="DEAL_EVENT_DATE" format="yyyyMMdd" type="1" position="60" end="67"/>      </model>      <model id="LN03XXXX_DIR_WRI_OFF_FRA_D">        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN03XXXX_DIR_WRI_OFF_FRA_D.ldr"/>        <option id="recordSize" value="48"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="40" end="47"/>      </model>      <model id="LN03XXXX_EXP_REC_FOR_SPE_I">        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN03XXXX_EXP_REC_FOR_SPE_I.ldr"/>        <option id="recordSize" value="71"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="VALUTA" format="yyyyMMdd" type="1" position="40" end="47"/>        <field nameT="CAPITAL_CHG_DECREASE" type="0" position="48" end="70"/>      </model>      <model id="LN03XXXX_FEE_DIR_IN_PL">        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN03XXXX_FEE_DIR_IN_PL.ldr"/>        <option id="recordSize" value="93"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="CHARGE_TYPE_NM" type="0" position="40" end="51"/>        <field nameT="SALES_TYPE_NM" type="0" position="52" end="61"/>        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="62" end="69"/>        <field nameT="CHARGE_AMOUNT" type="0" position="70" end="92"/>      </model>      <model id="LN03XXXX_FLOATING_LOAN">        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN03XXXX_FLOATING_LOAN.ldr"/>        <option id="recordSize" value="272"/>        <sqlStr xml:space="preserve">Select 
a.contract_ref_no		"trs_nr_nm"
,a.contract_status		"activev"
, a.counterparty		"ext_ke_address"
, a.booking_date
, a.value_date			"trs_date"
, a.product			"motive_nm"
, a.currency			"ext_key_currency"
, a.amount 			"capital_nominal"
, a.value_date			"capital_duration_frm"
, a.maturity_date		"capital_duration_to"
, 'N'				"capital_calendar_type"
, NULL				"yield"
, a.branch			"organisation_unit_nm"
, b.comp_mis_2			"dealer_nm"
, NULL				"bank_segment_nm"
, NULL				"place_of_contract_nm"
, NULL				"ext_product_key"
, NULL 				"cost_center_nm"
from ldtb_contract_master a 
LEFT OUTER JOIN MITB_CLASS_MAPPING b ON a.contract_ref_no = b.unit_ref_no
WHERE a.product NOT IN ('AHRL', 'AHRG')
AND a.product IN (Select product_code from cstm_product 
				where product_group = 'LOANS'
				)
AND a.contract_status = 'A'
AND a.version_no = (select max(version_no) from ldtb_contract_master c 
				where a.version_no = c.version_no
				and c.contract_status = 'A')
AND EXISTS (Select 1 from ldtb_contract_balance d 
			where d.contract_ref_no = a.contract_ref_no 
			AND principal_outstanding_bal &gt; 0)
AND a.value_date &lt;= To_date('$POSTINGDATE','yyyymmdd')
AND a.maturity_date &gt;= To_date('$POSTINGDATE','yyyymmdd')
</sqlStr>        <field nameT="TRS_NR_NM" name="trs_nr_nm" type="0" position="0" end="39"/>        <field nameT="EXT_KEY_ADDRESS" name="ext_ke_address" type="0" position="40" end="69"/>        <field nameT="TRS_DATE" name="trs_date" format="yyyyMMdd" type="1" position="70" end="77"/>        <field nameT="MOTIVE_NM" name="motive_nm" type="0" position="78" end="87"/>        <field nameT="EXT_KEY_CURRENCY" name="ext_key_currency" type="0" position="88" end="117"/>        <field nameT="CAPITAL_NOMINAL" name="capital_nominal" type="0" position="118" end="140"/>        <field nameT="CAPITAL_DURATION_FRM" name="capital_duration_frm" format="yyyyMMdd" type="1" position="141" end="148"/>        <field nameT="CAPITAL_DURATION_TO" name="capital_duration_to" format="yyyyMMdd" type="1" position="149" end="156"/>        <field nameT="CAPITAL_CALENDAR_TYPE_NM" name="capital_calendar_type" type="0" position="157" end="168"/>        <field nameT="ORGANISATION_UNIT_NM" name="organisation_unit_nm" type="0" position="169" end="180"/>        <field nameT="DEALER_NM" name="dealer_nm" type="0" position="181" end="215"/>        <field nameT="BANK_SEGMENT_NM" name="bank_segment_nm" type="0" position="216" end="235"/>        <field nameT="PLACE_OF_CONTRACT_NM" name="place_of_contract_nm" type="0" position="236" end="255"/>        <field nameT="EXT_PRODUCT_NM" name="ext_product_key" type="0" position="256" end="263"/>        <field nameT="COST_CENTER_NM" name="cost_center_nm" type="0" position="264" end="271"/>      </model>      <model id="LN03XXXX_FLO_INT_TRA">        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN03XXXX_FLO_INT_TRA.ldr"/>        <option id="recordSize" value="128"/>        <sqlStr xml:space="preserve">Select distinct
a.contract_ref_no							"trs_nr_nm"
, NULL										"fixing_ref_business_days"
, b.frm_date								"interest_duration_frm"
, b.to_date									"interest_duration_to"
,NULL /*CASE 
	WHEN c.frequency	= 'Y' THEN '1Y'
	WHEN c.frequency	 = 'M' THEN 
		CASE WHEN  to_date(b.frm_date) = to_date(LAST_DAY(b.frm_date)) THEN '1MU'
		ELSE '1M'
		END 
	WHEN c.frequency	 = 'Q' THEN 
		CASE WHEN  to_date(b.frm_date) = to_date(LAST_DAY(b.frm_date)) THEN '3MU'
		ELSE '3M'
		END 
END*/ 										"interest_duration_nm"
			
, b.chg_date								"interest_date_change"
, CASE 
	WHEN b.iccf_calc_method = 3 THEN 1
	WHEN b.iccf_calc_method = 5 THEN 4
	WHEN b.iccf_calc_method = 6 THEN 3
	WHEN b.iccf_calc_method = 9 THEN 10
END 										"interest_method"
, b.rate									"interest_rate"
, NULL										"rate_source"
, NULL										"rate_source_duration_nm"
, NULL										"rate_source_spread_rate"
, NULL										"rate_source_int_rate_factor"
from ldtb_contract_master A
INNER JOIN ( Select 
 			contract_ref_no
 			, rate
 			, iccf_calc_method
 			, min(start_date) frm_date
 			, min(end_date) to_date
 			, max(end_date) chg_date 
 		from ldtb_contract_iccf_calc
 		--where contract_ref_no = '564ABLD131220007'
 		group by contract_ref_no, rate, iccf_calc_method
 		) B ON a.contract_ref_no = b.contract_ref_no
 		
INNER JOIN ldtb_contract_schedules C ON a.contract_ref_no = c.contract_ref_no
--INNER JOIN cstb_amount_due D ON a.contract_ref_no = d.contract_ref_no
--AND a.component = 'PRINCIPAL' 
--AND c.frequency != 'B'
--where  b.start_date &lt;= To_date('20131231','yyyymmdd')
WHERE a.maturity_date &gt;= To_date('$POSTINGDATE','yyyymmdd')
AND  a.product NOT IN ('AHRL', 'AHRG')
AND a.product IN (Select product_code from cstm_product 
				where product_group = 'LOANS'
				)
--AND substr(a.product,1,1) = 'A'
AND a.contract_status = 'A'
AND a.version_no = (select max(version_no) from ldtb_contract_master y 
					where a.version_no = y.version_no
					and y.contract_status = 'A'
					)
AND EXISTS (Select 1 from ldtb_contract_balance z 
			where z.contract_ref_no = a.contract_ref_no 
			AND principal_outstanding_bal &gt; 0)
--AND a.contract_ref_no = '564ABLD131220007' --'002AHRL123260041'
--and d.original_due_date = b.schedule_date
AND component IN ('GH_INTLN', 'GH_INTLS', 'AMORTISE')
order by 2


/*
Select distinct
a.contract_ref_no							"trs_nr_nm"
, NULL										"fixing_ref_business_days"
, b.start_date								"interest_duration_frm"
, b.end_date								"interest_duration_to"
, c.frequency								"interest_duration_nm"
, NULL										"interest_date_change"
, CASE 
	WHEN b.iccf_calc_method = 3 THEN 1
	WHEN b.iccf_calc_method = 5 THEN 4
	WHEN b.iccf_calc_method = 6 THEN 3
	WHEN b.iccf_calc_method = 9 THEN 10
END 										"interest_method"
, rate										"interest_rate"
, NULL										"rate_source"
, NULL										"rate_source_duration_nm"
, NULL										"rate_source_spread_rate"
, NULL										"rate_source_int_rate_factor"
from ldtb_contract_master A
INNER JOIN ldtb_contract_iccf_calc B ON a.contract_ref_no = b.contract_ref_no
INNER JOIN ldtb_contract_schedules C ON a.contract_ref_no = c.contract_ref_no
INNER JOIN cstb_amount_due D ON a.contract_ref_no = d.contract_ref_no
--AND a.component = 'PRINCIPAL' 
AND c.frequency != 'B'
--where  b.start_date &lt;= To_date('20131231','yyyymmdd')
WHERE a.maturity_date &gt;= To_date('$POSTINGDATE','yyyymmdd')
AND  a.product NOT IN ('AHRL', 'AHRG')
AND a.product IN (Select product_code from cstm_product 
				where product_group = 'LOANS'
				)
--AND substr(a.product,1,1) = 'A'
AND a.contract_status = 'A'
AND a.version_no = (select max(version_no) from ldtb_contract_master y 
					where a.version_no = y.version_no
					and y.contract_status = 'A'
					)
AND EXISTS (Select 1 from ldtb_contract_balance z 
			where z.contract_ref_no = a.contract_ref_no 
			AND principal_outstanding_bal &gt; 0)
--AND a.contract_ref_no = '002AFLD121250152' --'002AHRL123260041'
and d.original_due_date = b.schedule_date
AND component IN ('GH_INTLN', 'GH_INTLS')
order by 2
*/</sqlStr>
        <field nameT="TRS_NR_NM" name="trs_nr_nm" type="0" position="0" end="39"/>
        <field nameT="FIXING_REF_BUSINESS_DAYS" name="fixing_ref_business_days" type="0" position="40" end="42"/>
        <field nameT="INTEREST_DURATION_FRM" name="interest_duration_frm" format="yyyyMMdd" type="1" position="43" end="50"/>
        <field nameT="INTEREST_DURATION_TO" name="interest_duration_to" format="yyyyMMdd" type="1" position="51" end="58"/>
        <field nameT="INTEREST_DURATION_NM" name="interest_duration_nm" type="0" position="59" end="70"/>
        <field nameT="INTEREST_DATE_CHANGE" name="interest_date_change" format="yyyyMMdd" type="1" position="71" end="78"/>
        <field nameT="INTEREST_METHOD" name="interest_method" type="0" position="79" end="80"/>
        <field nameT="INTEREST_RATE" name="interest_rate" type="0" position="81" end="89"/>
        <field nameT="RATE_SOURCE_NM" name="rate_source" type="0" position="90" end="97"/>
        <field nameT="RATE_SOURCE_DURATION_NM" name="rate_source_duration_nm" type="0" position="98" end="109"/>
        <field nameT="RATE_SOURCE_SPREAD_RATE" name="rate_source_spread_rate" type="0" position="110" end="118"/>
        <field nameT="RATE_SOURCE_INT_RATE_FACTOR" name="rate_source_int_rate_factor" type="0" position="119" end="127"/>
      </model>
      <model id="LN03XXXX_IMPAIRMENT_END">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN03XXXX_IMPAIRMENT_END.ldr"/>
        <option id="recordSize" value="48"/>
        <sqlStr xml:space="preserve"></sqlStr>
        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>
        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="40" end="47"/>
      </model>
      <model id="LN03XXXX_IRR_OUT_CON">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN03XXXX_IRR_OUT_CON.ldr"/>
        <option id="recordSize" value="71"/>
        <sqlStr xml:space="preserve"></sqlStr>
        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>
        <field nameT="VALUTA" format="yyyyMMdd" type="1" position="40" end="47"/>
        <field nameT="CAPITAL_CHG_INCREASE" type="0" position="48" end="70"/>
      </model>
      <model id="LN03XXXX_IRR_REP_UNE">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN03XXXX_IRR_REP_UNE.ldr"/>
        <option id="recordSize" value="71"/>
        <sqlStr xml:space="preserve">Select 
a.contract_ref_no				"trs_nr_nm"
, b.paid_date					"valuta"
, prepmt_amt 					"capital_chg_decrease"
from ldtb_contract_master A
INNER JOIN  cstb_amount_paid b ON a.contract_ref_no = b.contract_ref_no
where a.value_date &lt;= To_date('$POSTINGDATE','yyyymmdd')
AND a.maturity_date &gt;= To_date('$POSTINGDATE','yyyymmdd')
AND  a.product NOT IN ('AHRL', 'AHRG')
AND a.product IN (Select product_code from cstm_product 
				where product_group = 'LOANS'
				)
AND a.contract_status = 'A'
AND a.contract_ref_no = '002ABLD121252969'
AND a.version_no = (select max(y.version_no) from ldtb_contract_master y 
				where a.contract_ref_no = y.contract_ref_no
				AND y.contract_status = 'A'
				)
AND prepmt_amt IS NOT NULL
AND component = 'PRINCIPAL'
</sqlStr>        <field nameT="TRS_NR_NM" name="trs_nr_nm" type="0" position="0" end="39"/>        <field nameT="VALUTA" name="valuta" format="yyyyMMdd" type="1" position="40" end="47"/>        <field nameT="CAPITAL_CHG_DECREASE" name="capital_chg_decrease" type="0" position="48" end="70"/>      </model>      <model id="LN03XXXX_ONE_TIM_AMO_FEE_E">        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN03XXXX_ONE_TIM_AMO_FEE_E.ldr"/>        <option id="recordSize" value="101"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="CHARGE_TYPE_NM" type="0" position="40" end="51"/>        <field nameT="SALES_TYPE_NM" type="0" position="52" end="61"/>        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="62" end="69"/>        <field nameT="CHARGE_DATE_CHANGE" format="yyyyMMdd" type="1" position="70" end="77"/>        <field nameT="CHARGE_AMOUNT" type="0" position="78" end="100"/>      </model>      <model id="LN03XXXX_OVE_NOT_AFF_ACC">        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN03XXXX_OVE_NOT_AFF_ACC.ldr"/>        <option id="recordSize" value="97"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="CHARGE_TYPE_NM" type="0" position="40" end="51"/>        <field nameT="SALES_TYPE_NM" type="0" position="52" end="61"/>        <field nameT="CHARGE_AMOUNT" type="0" position="62" end="84"/>        <field nameT="PAY_AGREEMENT_NM" type="0" position="85" end="96"/>      </model>      <model id="LN03XXXX_PAYMENT_EVENTS">        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN03XXXX_PAYMENT_EVENTS.ldr"/>        <option id="recordSize" value="209"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="MONEY_TYPE_MAIN_NM" type="0" position="40" end="51"/>        <field nameT="PAYMENT_IN_OUT" type="0" position="52" end="52"/>        <field nameT="EXT_KEY_CURRENCY" type="0" position="53" end="82"/>        <field nameT="EXT_KEY_CURRENCY_NM" type="0" position="83" end="102"/>        <field nameT="VALUTA" format="yyyyMMdd" type="1" position="103" end="110"/>        <field nameT="SALES_TYPE_NM" type="0" position="111" end="120"/>        <field nameT="PAY_AGREEMENT_NM" type="0" position="121" end="132"/>        <field nameT="VALUE" type="0" position="133" end="170"/>        <field nameT="AMOUNT_BAL" type="0" position="171" end="208"/>      </model>      <model id="LN03XXXX_PENALTY_INTEREST">        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN03XXXX_PENALTY_INTEREST.ldr"/>        <option id="recordSize" value="71"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="40" end="47"/>        <field nameT="CHARGE_AMOUNT" type="0" position="48" end="70"/>      </model>      <model id="LN03XXXX_REA_PAY_IN_IMP">        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN03XXXX_REA_PAY_IN_IMP.ldr"/>        <option id="recordSize" value="71"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="40" end="47"/>        <field nameT="CHARGE_AMOUNT" type="0" position="48" end="70"/>      </model>      <model id="LN03XXXX_REG_REP_CON">        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN03XXXX_REG_REP_CON.ldr"/>        <option id="recordSize" value="99"/>        <sqlStr xml:space="preserve">SELECT distinct
a.contract_ref_no				"trs_nr_nm"
--, b.component					
, a.frm_date					"capital_duration_frm"
, b.amount_due
, b.amount_settled				"capital_charge_decrease"
, a.to_date 					"capital_duration_to"
, d.maturity_date				"capital_chg_duration_end"
, c.frequency					"capital_duration_nm"
FROM
(
	Select 
	t1.contract_ref_no
	, t1.value_date frm_date
	, ( select min(t2.original_due_date)  from cstb_amount_due t2 
		where t2.contract_ref_no = t1.contract_ref_no
		AND original_due_date  &gt; t1.value_date
	   ) to_date
	from ( 
	Select 
		contract_ref_no
		, value_date 
	from ldtb_contract_master 
	--where contract_ref_no = '102NBLD121250016'--'211AHRL131070008'
	UNION 
	Select 
		contract_ref_no
		, original_due_date 
	from cstb_amount_due 
	where component = 'PRINCIPAL' 
	--AND contract_ref_no = '102NBLD121250016'--'211AHRL131070008'
	) t1 
) A
INNER JOIN cstb_amount_due B  ON A.contract_ref_no = B.contract_ref_no
INNER JOIN (SELECT a.contract_ref_no, a.frequency  from ldtb_contract_schedules a
		 WHERE a.version_no = (select max(b.version_no) from ldtb_contract_schedules b 
							where a.contract_ref_no = b.contract_ref_no)
		 --AND contract_ref_no = '102NBLD121250016'
		 AND component = 'AMORTISE' 
		 AND a.frequency != 'B'
		 ) C ON A.contract_ref_no = C.contract_ref_no
INNER JOIN ldtb_contract_master D ON A.contract_ref_no = D.contract_ref_no
WHERE B.component = 'PRINCIPAL' 
AND c.frequency != 'B'
AND A.to_date = B.due_date
AND D.value_date &lt;= To_date('$POSTINGDATE','yyyymmdd')
AND D.maturity_date &gt;= To_date('$POSTINGDATE','yyyymmdd')
AND  D.product NOT IN ('AHRL', 'AHRG')
AND D.product IN (Select product_code from cstm_product 
				where product_group = 'LOANS'
				)
AND substr(D.product,1,1) = 'N'
AND D.contract_status = 'A'
AND B.amount_settled != 0
AND D.version_no = (select max(version_no) from ldtb_contract_master y 
				where D.version_no = y.version_no
				and y.contract_status = 'A'
				)
AND EXISTS (Select 1 from ldtb_contract_balance z 
			where z.contract_ref_no = D.contract_ref_no 
			AND principal_outstanding_bal &gt; 0)
ORDER BY a.frm_date
</sqlStr>        <field nameT="TRS_NR_NM" name="trs_nr_nm" type="0" position="0" end="39"/>        <field nameT="CAPITAL_CHG_DECREASE" name="capital_charge_decrease" type="0" position="40" end="62"/>        <field nameT="CAPITAL_CHG_DURATION_FRM" name="capital_chg_duration_end" format="yyyyMMdd" type="1" position="63" end="70"/>        <field nameT="CAPITAL_CHG_DURATION_TO" name="capital_chg_duration_end" format="yyyyMMdd" type="1" position="71" end="78"/>        <field nameT="CAPITAL_CHG_DURATION_END" name="capital_chg_duration_end" format="yyyyMMdd" type="1" position="79" end="86"/>        <field nameT="CAPITAL_CHG_DURATION_NM" name="capital_chg_duration_end" type="0" position="87" end="98"/>      </model>      <model id="LN03XXXX_STA_OF_SPE_IMP">        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN03XXXX_STA_OF_SPE_IMP.ldr"/>        <option id="recordSize" value="48"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="VALUTA" format="yyyyMMdd" type="1" position="40" end="47"/>      </model>      <model id="LN03XXXX_WRI_OFF_AFT_IMP">        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN03XXXX_WRI_OFF_AFT_IMP.ldr"/>        <option id="recordSize" value="48"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="40" end="47"/>      </model>      <model id="LN03XXXX_YIE_ENH_FEE">        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.LN03XXXX_YIE_ENH_FEE.ldr"/>        <option id="recordSize" value="95"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="SALES_TYPE_NM" type="0" position="40" end="49"/>        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="50" end="57"/>        <field nameT="CHARGE_DURATION_TO" format="yyyyMMdd" type="1" position="58" end="65"/>        <field nameT="CHARGE_DURATION_NM" type="0" position="66" end="77"/>        <field nameT="CHARGE_DATE_CHANGE" format="yyyyMMdd" type="1" position="78" end="85"/>        <field nameT="CHARGE_RATE" type="0" position="86" end="94"/>      </model>    </group>    <group id="saving">      <option id="active" value="0"/>      <model id="S4569401_ACCOUNTING_CATEGORIES">        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.S4569401_ACCOUNTING_CATEGORIES.ldr"/>        <option id="recordSize" value="52"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="ACCOUNTING_CATEGORY_NM" type="0" position="40" end="51"/>      </model>      <model id="S4569401_CUR_INT_TRA_CAP">        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.S4569401_CUR_INT_TRA_CAP.ldr"/>        <option id="recordSize" value="79"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="INTEREST_DURATION_FRM" format="yyyyMMdd" type="1" position="40" end="47"/>        <field nameT="INTEREST_DURATION_TO" format="yyyyMMdd" type="1" position="48" end="55"/>        <field nameT="INTEREST_DURATION_NM" type="0" position="56" end="67"/>        <field nameT="INTEREST_METHOD" type="0" position="68" end="69"/>        <field nameT="INTEREST_RATE" type="0" position="70" end="78"/>      </model>      <model id="S4569401_IRR_CAP_CHA">        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.S4569401_IRR_CAP_CHA.ldr"/>        <option id="recordSize" value="94"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="VALUTA" format="yyyyMMdd" type="1" position="40" end="47"/>        <field nameT="CAPITAL_CHG_INCREASE" type="0" position="48" end="70"/>        <field nameT="CAPITAL_CHG_DECREASE" type="0" position="71" end="93"/>      </model>      <model id="S4569401_NOM_AMO_REC">        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.S4569401_NOM_AMO_REC.ldr"/>        <option id="recordSize" value="71"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="VALUTA" format="yyyyMMdd" type="1" position="40" end="47"/>        <field nameT="PERIOD_CAPITAL" type="0" position="48" end="70"/>      </model>      <model id="S4569401_ONE_TIM_FEE_DIR_IN_PL">        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.S4569401_ONE_TIM_FEE_DIR_IN_PL.ldr"/>        <option id="recordSize" value="93"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="CHARGE_TYPE_NM" type="0" position="40" end="51"/>        <field nameT="SALES_TYPE_NM" type="0" position="52" end="61"/>        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="62" end="69"/>        <field nameT="CHARGE_AMOUNT" type="0" position="70" end="92"/>      </model>      <model id="S4569401_PAS_INT_TRA_CAP">        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.S4569401_PAS_INT_TRA_CAP.ldr"/>        <option id="recordSize" value="95"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="INTEREST_DURATION_FRM" format="yyyyMMdd" type="1" position="40" end="47"/>        <field nameT="INTEREST_DURATION_TO" format="yyyyMMdd" type="1" position="48" end="55"/>        <field nameT="INTEREST_DURATION_NM" type="0" position="56" end="67"/>        <field nameT="INTEREST_DATE_CHANGE" format="yyyyMMdd" type="1" position="68" end="75"/>        <field nameT="INTEREST_DURATION_END_VALUTA" format="yyyyMMdd" type="1" position="76" end="83"/>        <field nameT="INTEREST_METHOD" type="0" position="84" end="85"/>        <field nameT="INTEREST_RATE" type="0" position="86" end="94"/>      </model>      <model id="S4569401_PREMIUM_OR_DISCOUNT">        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.S4569401_PREMIUM_OR_DISCOUNT.ldr"/>        <option id="recordSize" value="91"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="CHARGE_TYPE_NM" type="0" position="40" end="51"/>        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="52" end="59"/>        <field nameT="CHARGE_DATE_CHANGE" format="yyyyMMdd" type="1" position="60" end="67"/>        <field nameT="CHARGE_AMOUNT" type="0" position="68" end="90"/>      </model>      <model id="S4569401_SAVING_DEAL">        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.S4569401_SAVING_DEAL.ldr"/>        <option id="recordSize" value="240"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="ACTIVEV" type="0" position="40" end="40"/>        <field nameT="COMPANY" type="0" position="41" end="43"/>        <field nameT="EXT_KEY_ADDRESS" type="0" position="44" end="73"/>        <field nameT="MOTIVE_NM" type="0" position="74" end="83"/>        <field nameT="EXT_KEY_CURRENCY" type="0" position="84" end="113"/>        <field nameT="CAPITAL_NOMINAL" type="0" position="114" end="136"/>        <field nameT="CAPITAL_DURATION_FRM" format="yyyyMMdd" type="1" position="137" end="144"/>        <field nameT="CAPITAL_DURATION_TO" format="yyyyMMdd" type="1" position="145" end="152"/>        <field nameT="CAPITAL_CALENDAR_TYPE_NM" type="0" position="153" end="164"/>        <field nameT="ORGANISATION_UNIT_NM" type="0" position="165" end="176"/>        <field nameT="DEALER_NM" type="0" position="177" end="211"/>        <field nameT="BANK_SEGMENT_NM" type="0" position="212" end="231"/>        <field nameT="COST_CENTER_NM" type="0" position="232" end="239"/>      </model>    </group>    <script id="90_push">      <content xml:space="preserve">logger.info("append ASCII files from $destinationPath files to tables in FSETL");
com.manticore.etl.FlatFileLoader.push(ldrPath, destinationPath, Integer.valueOf(THREADS), true, logger);</content>
      <option id="active" value="0"/>
      <option id="language" value="groovy"/>
      <option id="phase" value="transfer"/>
    </script>
    <option id="dependancies" value="init"/>
    <script id="91_adjust_htm">
      <content xml:space="preserve">/*
 *
 *  Copyright (C) 2010 Prince Onyenike  &lt;onyenikeprince@yahoo.com&gt; 
 *
 * ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *
 *  This program is free software; you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation; either version 2 of the License, or (at
 *  your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful, but
 *  WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 *  General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License along
 *  with this program; if not, write to the Free Software Foundation, Inc.,
 *  59 Temple Place, Suite 330, Boston, MA 02111-1307 USA.
 *
 * ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 */

import com.manticore.etl.*;
import com.manticore.etl.database.*;
import java.sql.*;
import groovy.sql.Sql;

def String[] sqlStr=[
	"delete from M4567505_BUY_TRANSACTION where trs_nr_nm in (select trs_nr_nm from HTM_BUY_TRANSACTION)"
	, "delete from M4567505_PRE_OR_DIS_AT_BUY where trs_nr_nm in (select trs_nr_nm from HTM_PRE_OR_DIS_AT_BUY)"
	, "delete from M4567505_PAI_ACC_INT_AT_BUY where trs_nr_nm in (select trs_nr_nm from HTM_PAI_ACC_INT_AT_BUY)"

	, "insert into M4567505_BUY_TRANSACTION select * from HTM_BUY_TRANSACTION"
	, "insert into M4567505_PRE_OR_DIS_AT_BUY select * from HTM_PRE_OR_DIS_AT_BUY"
	, "insert into M4567505_PAI_ACC_INT_AT_BUY select * from HTM_PAI_ACC_INT_AT_BUY"
]

logger.info("adjust migrated htm bonds");

def Sql sql = new Sql(ETLConnectionMap.getConnection("FxF Union Bank FSETL"))
sqlStr.each() {
	sql.executeUpdate(it)
}
ETLConnectionMap.release("FxF Union Bank FSETL", sql.getConnection());
</content>      <option id="active" value="0"/>      <option id="language" value="groovy"/>      <option id="phase" value="after"/>    </script>    <script id="92_gombe_bond">      <content xml:space="preserve">/*
 *
 *  Copyright (C) 2010 Prince Onyenike  &lt;onyenikeprince@yahoo.com&gt; 
 *
 * ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *
 *  This program is free software; you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation; either version 2 of the License, or (at
 *  your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful, but
 *  WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 *  General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License along
 *  with this program; if not, write to the Free Software Foundation, Inc.,
 *  59 Temple Place, Suite 330, Boston, MA 02111-1307 USA.
 *
 * ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 */

import com.manticore.etl.*;
import com.manticore.etl.database.*;
import java.sql.*;
import groovy.sql.Sql;

def String[] sqlStr=[
	"""INSERT INTO BON_STA_DAT_THI_PAR_AMO_COS_FI
(
    EXT_KEY_SECURITY,
    ACTIVEV,
    COMPANY,
    SECURITY_NM_DC,
    EXT_KEY_ADDRESS_ISSUER,
    ISSUE_DATE,
    ISSUE_CAPITAL,
    PLACE_OF_ISSUE_NM,
    EXT_KEY_CURRENCY_ISSUE,
    SEC_FLAG_1_VALUE,
    SEC_FLAG_2_VALUE,
    MATURITY_RATE,
    CAPITAL_DURATION_FRM,
    CAPITAL_DURATION_TO,
    CAPITAL_CALENDAR_TYPE_NM
)
VALUES
(
    'GOMBE STATE BOND' /*not nullable*/,
    'A',
    176 /*not nullable*/,
    'GOMBE STATE BOND',
    'yyyyyyyyyyy1' /*not nullable*/,
    '22-May-13' /*not nullable*/,
     4000000000.00 ,
    null,
    'NGN' /*not nullable*/,
    null,
    null,
    0,
    '22-May-13' /*not nullable*/,
    '2-Oct-19' /*not nullable*/,
    'F'
)"""
, """INSERT INTO FIXED_INTEREST_TRANCHES
(
    EXT_KEY_SECURITY,
    INTEREST_DURATION_TO,
    INTEREST_DURATION_NM,
    INTEREST_METHOD,
    INTEREST_RATE,
    PAY_AGREEMENT_NM
)
VALUES
(
    'GOMBE STATE BOND' /*not nullable*/,
    '2-Oct-13',
    '6M',
    31 /*not nullable*/,
    15.50 /*not nullable*/,
    'ARREARS'
)"""
, """INSERT INTO BP010001_BOND_POSITION
(
    POS_BANK_TRS_NR_NM,
    ACTIVEV,
    COMPANY,
    EXT_KEY_SECURITY,
    EXT_KEY_CURRENCY,
    ACCOUNTING_CATEGORY_NM,
    MOTIVE_NM,
    ORGANISATION_UNIT_NM,
    DEALER_NM,
    BANK_SEGMENT_NM,
    PLACE_OF_CONTRACT_NM,
    COST_CENTER_NM
)
VALUES
(
    'GOMBE STATE BOND' /*not nullable*/,
    'A',
    176 /*not nullable*/,
    'GOMBE STATE BOND',
    'NGN',
    'HTM' /*not nullable*/,
    'COHM',
    null ,
    null ,
    null ,
    null ,
    null
)"""
, """INSERT INTO BP010001_BOND_TRADE_DEALS
(
    POS_BANK_TRS_NR_NM,
    TRS_NR_NM,
    ACTIVEV,
    DW_HEDGE_NAME,
    TRS_DATE,
    VALUTA,
    TRADE_SIDE_NM,
    SEC_QUANTITY,
    SEC_TRADE_RATE_CLEAN,
    EX_COUPON_FLAG,
    SEC_INTEREST_ACCRUED
)
VALUES
(
    'GOMBE STATE BOND' /*not nullable*/,
    'GOMBE STATE BOND 1' /*not nullable*/,
    'A',
    null,
    '22-May-13',
    '22-May-13' /*not nullable*/,
    'B' /*not nullable*/,
    4000000000.00 /*not nullable*/,
    106.13038634 /*not nullable*/,
    '0' /*not nullable*/,
    null
)"""
, """INSERT INTO BP010001_CAP_RED
(
    POS_BANK_TRS_NR_NM,TRS_NR_NM,ACTIVEV,TRS_DATE,VALUTA,TRADE_SIDE_NM,SEC_QUANTITY
)
VALUES
(
    'GOMBE STATE BOND' /*not nullable*/,
    'GOMBE STATE BOND R1' /*not nullable*/,
    'A',
    '2-Oct-13',
    '2-Oct-13' /*not nullable*/,
    'S' /*not nullable*/,
    189150073.63  /*not nullable*/
)"""
, """INSERT INTO BP010001_CAP_RED
(
    POS_BANK_TRS_NR_NM,TRS_NR_NM,ACTIVEV,TRS_DATE,VALUTA,TRADE_SIDE_NM,SEC_QUANTITY
)
VALUES
(
    'GOMBE STATE BOND' /*not nullable*/,
    'GOMBE STATE BOND R2' /*not nullable*/,
    'A',
    '2-Apr-14',
    '2-Apr-14' /*not nullable*/,
    'S' /*not nullable*/,
    203809204.34   /*not nullable*/
)"""
, """INSERT INTO BP010001_CAP_RED
(
    POS_BANK_TRS_NR_NM,TRS_NR_NM,ACTIVEV,TRS_DATE,VALUTA,TRADE_SIDE_NM,SEC_QUANTITY
)
VALUES
(
    'GOMBE STATE BOND' /*not nullable*/,
    'GOMBE STATE BOND R3' /*not nullable*/,
    'A',
    '2-Oct-14',
    '2-Oct-14' /*not nullable*/,
    'S' /*not nullable*/,
    219604417.67 /*not nullable*/
)"""
, """INSERT INTO BP010001_CAP_RED
(
    POS_BANK_TRS_NR_NM,TRS_NR_NM,ACTIVEV,TRS_DATE,VALUTA,TRADE_SIDE_NM,SEC_QUANTITY
)
VALUES
(
    'GOMBE STATE BOND' /*not nullable*/,
    'GOMBE STATE BOND R4' /*not nullable*/,
    'A',
    '2-Apr-15',
    '2-Apr-15' /*not nullable*/,
    'S' /*not nullable*/,
    236623760.04  /*not nullable*/
)"""
, """INSERT INTO BP010001_CAP_RED
(
    POS_BANK_TRS_NR_NM,TRS_NR_NM,ACTIVEV,TRS_DATE,VALUTA,TRADE_SIDE_NM,SEC_QUANTITY
)
VALUES
(
    'GOMBE STATE BOND' /*not nullable*/,
    'GOMBE STATE BOND R5' /*not nullable*/,
    'A',
    '2-Oct-15',
    '2-Oct-15' /*not nullable*/,
    'S' /*not nullable*/,
    254962101.45   /*not nullable*/
)"""
, """INSERT INTO BP010001_CAP_RED
(
    POS_BANK_TRS_NR_NM,TRS_NR_NM,ACTIVEV,TRS_DATE,VALUTA,TRADE_SIDE_NM,SEC_QUANTITY
)
VALUES
(
    'GOMBE STATE BOND' /*not nullable*/,
    'GOMBE STATE BOND R6' /*not nullable*/,
    'A',
    '2-Apr-16',
    '2-Apr-16' /*not nullable*/,
    'S' /*not nullable*/,
    274721664.31    /*not nullable*/
)"""
, """INSERT INTO BP010001_CAP_RED
(
    POS_BANK_TRS_NR_NM,TRS_NR_NM,ACTIVEV,TRS_DATE,VALUTA,TRADE_SIDE_NM,SEC_QUANTITY
)
VALUES
(
    'GOMBE STATE BOND' /*not nullable*/,
    'GOMBE STATE BOND R7' /*not nullable*/,
    'A',
    '2-Oct-16',
    '2-Oct-16' /*not nullable*/,
    'S' /*not nullable*/,
    296012593.29     /*not nullable*/
)"""
, """INSERT INTO BP010001_CAP_RED
(
    POS_BANK_TRS_NR_NM,TRS_NR_NM,ACTIVEV,TRS_DATE,VALUTA,TRADE_SIDE_NM,SEC_QUANTITY
)
VALUES
(
    'GOMBE STATE BOND' /*not nullable*/,
    'GOMBE STATE BOND R8' /*not nullable*/,
    'A',
    '2-Apr-17',
    '2-Apr-17' /*not nullable*/,
    'S' /*not nullable*/,
    318953569.27      /*not nullable*/
)"""
, """INSERT INTO BP010001_CAP_RED
(
    POS_BANK_TRS_NR_NM,TRS_NR_NM,ACTIVEV,TRS_DATE,VALUTA,TRADE_SIDE_NM,SEC_QUANTITY
)
VALUES
(
    'GOMBE STATE BOND' /*not nullable*/,
    'GOMBE STATE BOND R9' /*not nullable*/,
    'A',
    '2-Oct-17',
    '2-Oct-17' /*not nullable*/,
    'S' /*not nullable*/,
    343672470.89       /*not nullable*/
)"""
, """INSERT INTO BP010001_CAP_RED
(
    POS_BANK_TRS_NR_NM,TRS_NR_NM,ACTIVEV,TRS_DATE,VALUTA,TRADE_SIDE_NM,SEC_QUANTITY
)
VALUES
(
    'GOMBE STATE BOND' /*not nullable*/,
    'GOMBE STATE BOND R10' /*not nullable*/,
    'A',
    '2-Apr-18',
    '2-Apr-18' /*not nullable*/,
    'S' /*not nullable*/,
    370307087.38        /*not nullable*/
)"""
, """INSERT INTO BP010001_CAP_RED
(
    POS_BANK_TRS_NR_NM,TRS_NR_NM,ACTIVEV,TRS_DATE,VALUTA,TRADE_SIDE_NM,SEC_QUANTITY
)
VALUES
(
    'GOMBE STATE BOND' /*not nullable*/,
    'GOMBE STATE BOND R11' /*not nullable*/,
    'A',
    '2-Oct-18',
    '2-Oct-18' /*not nullable*/,
    'S' /*not nullable*/,
    399005886.66        /*not nullable*/
)"""
, """INSERT INTO BP010001_CAP_RED
(
    POS_BANK_TRS_NR_NM,TRS_NR_NM,ACTIVEV,TRS_DATE,VALUTA,TRADE_SIDE_NM,SEC_QUANTITY
)
VALUES
(
    'GOMBE STATE BOND' /*not nullable*/,
    'GOMBE STATE BOND R12' /*not nullable*/,
    'A',
    '2-Apr-19',
    '2-Apr-19' /*not nullable*/,
    'S' /*not nullable*/,
    429928842.87         /*not nullable*/
)"""
,"""INSERT INTO BP010001_CAP_RED
(
    POS_BANK_TRS_NR_NM,TRS_NR_NM,ACTIVEV,TRS_DATE,VALUTA,TRADE_SIDE_NM,SEC_QUANTITY
)
VALUES
(
    'GOMBE STATE BOND' /*not nullable*/,
    'GOMBE STATE BOND R13' /*not nullable*/,
    'A',
    '2-Oct-19',
    '2-Oct-19' /*not nullable*/,
    'S' /*not nullable*/,
    463248328.20          /*not nullable*/
)"""
]

logger.info("inserted Gombe bonds data");

def Sql sql = new Sql(ETLConnectionMap.getConnection("FxF Union Bank FSETL"))
sqlStr.each() {
	sql.executeUpdate(it)
}
ETLConnectionMap.release("FxF Union Bank FSETL", sql.getConnection());
</content>      <option id="active" value="0"/>      <option id="language" value="groovy"/>      <option id="phase" value="after"/>    </script>  </process>  <process id="ln_retail">    <option id="destinationPath" value="/usr/backup/manticore-ETLTools/data/ln_retail/"/>    <option id="ldrPath" value="file:/usr/backup/manticore-ETLTools/etl/ldr/"/>    <option id="compress" value="0"/>    <option id="concat" value="1"/>    <option id="connection" value="FlexCube Retail Live"/>    <group id="account">      <option id="active" value="0"/>      <model id="A4569501_ACC_BAL_NOM_AMO">        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.A4569501_ACC_BAL_NOM_AMO.ldr"/>        <option id="recordSize" value="64"/>        <sqlStr xml:space="preserve">SELECT 'ch_acct_'
       || COD_ACCT_NO  "current_account_number"
       , CASE
           WHEN bal_book &lt; 0 THEN 'D'
           ELSE 'C'
         END           "credit_debit"
       ,Abs(round(bal_book,2)) "capital"
FROM   fcrlive.CH_ACCT_MAST
WHERE  DAT_ACCT_OPEN &lt;= To_date('$POSTINGDATE', 'yyyymmdd')
       AND NOT ( COD_ACCT_STAT = 1
                  OR cod_acct_stat = 5 )
       AND flg_mnt_status = 'A'
       AND NOT ( COD_PROD = 169
                  OR COD_PROD = 175
                  OR COD_PROD = 176
                  OR COD_PROD = 177
                  OR COD_PROD = 179
                  OR COD_PROD = 182
                  OR COD_PROD = 150
                  OR COD_PROD = 183
                  OR COD_PROD = 157
                  OR COD_PROD = 171
                  OR COD_PROD = 172
                  OR COD_PROD = 181
                  OR COD_PROD = 111 )
UNION ALL
SELECT /* +parallel(a,6) parallel(b,6) */ a.cod_acct_no                       "current_account_number"
                                          , CASE
                                              WHEN Amt_Princ_Balance &lt; 0 THEN 'C'
                                              ELSE 'D'
                                            END                               "credit_debit"
                                          , Abs(Round (Amt_Princ_Balance, 2)) "outstanding_balance"
FROM   fcrlive.ln_acct_mast a
       inner join fcrlive.LN_ACCT_SCHEDULE_DETLS b
               ON a.cod_acct_no = b.cod_acct_no
                  AND date_instal = (SELECT Max(date_instal)
                                     FROM   fcrlive.LN_ACCT_SCHEDULE_DETLS
                                     WHERE  cod_acct_no = b.cod_acct_no)
WHERE  flg_mnt_status = 'A'
       AND cod_acct_stat NOT IN ( 1, 5 )
       AND a.dat_of_maturity &lt;= To_date('$POSTINGDATE', 'YYYYMMDD')
       AND Round(Amt_Princ_Balance, 2) != 0
       AND ( amt_princ_bal = 0
              OR amt_princ_bal IS NULL ) 
</sqlStr>        <field nameT="CURRENT_ACCOUNT_NUMBER" name="current_account_number" type="0" position="0" end="39"/>        <field nameT="CREDIT_DEBIT" name="credit_debit" type="0" position="40" end="40"/>        <field nameT="CAPITAL" name="capital" type="0" position="41" end="63"/>      </model>      <model id="A4569501_ACC_INC_INT">        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.A4569501_ACC_INC_INT.ldr"/>        <option id="recordSize" value="79"/>        <sqlStr xml:space="preserve">SELECT 'ch_acct_'
       || t2.cod_acct_no "current_account_number"
       , t2.dat_eff_from "charge_duration_frm"
       , t2.dat_eff_to   "charge_valuta"
       , t2.amt_interest "charge_amount"
FROM   fcrlive.CH_ACCT_MAST t1
       inner join ch_tmp_rch_interest t2
	       ON t1.cod_acct_no = t2.cod_acct_no
WHERE  t2.amt_interest &gt; 0
       AND t1.DAT_ACCT_OPEN &lt;= To_date('$POSTINGDATE', 'yyyymmdd')
       and t2.dat_eff_from &lt;= To_date('$POSTINGDATE', 'yyyymmdd')
       and t2.dat_eff_to &gt;= To_date('$INITDATE', 'yyyymmdd')
       AND NOT ( t1.COD_ACCT_STAT = 1
		  OR t1.cod_acct_stat = 5 )
	   and t1.flg_mnt_status = 'A'	 
	and not (COD_PROD=169 OR COD_PROD=175 OR COD_PROD=176 OR COD_PROD=177 OR COD_PROD=179 OR COD_PROD=182 OR COD_PROD=150 OR COD_PROD=183 OR COD_PROD=157 OR COD_PROD=171 OR COD_PROD=172 OR COD_PROD=181 OR COD_PROD=111)
</sqlStr>        <field nameT="CURRENT_ACCOUNT_NUMBER" name="current_account_number" type="0" position="0" end="39"/>        <field nameT="CHARGE_DURATION_FRM" name="charge_duration_frm" format="yyyyMMdd" type="1" position="40" end="47"/>        <field nameT="CHARGE_VALUTA" name="charge_valuta" format="yyyyMMdd" type="1" position="48" end="55"/>        <field nameT="CHARGE_AMOUNT" name="charge_amount" type="0" position="56" end="78"/>      </model>      <model id="A4569501_ACC_OUT_INT">        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.A4569501_ACC_OUT_INT.ldr"/>        <option id="recordSize" value="79"/>        <sqlStr xml:space="preserve">SELECT 'ch_acct_'
       || t2.cod_acct_no    	"current_account_number"
       , t2.dat_eff_from 		"charge_duration_frm"
       , t2.dat_eff_to   		"charge_valuta"
       , abs(t2.amt_interest) 	"charge_amount"
FROM   fcrlive.CH_ACCT_MAST t1
       inner join ch_tmp_rch_interest t2
	       ON t1.cod_acct_no = t2.cod_acct_no
WHERE  t2.amt_interest &lt; 0
       AND t1.DAT_ACCT_OPEN &lt;= To_date('$POSTINGDATE', 'yyyymmdd')
       and t2.dat_eff_from &lt;= To_date('$POSTINGDATE', 'yyyymmdd')
       and t2.dat_eff_to &gt;= To_date('$INITDATE', 'yyyymmdd')
       AND NOT ( t1.COD_ACCT_STAT = 1
		  OR t1.cod_acct_stat = 5 ) 
       and t1.flg_mnt_status = 'A'
	and not (COD_PROD=169 OR COD_PROD=175 OR COD_PROD=176 OR COD_PROD=177 OR COD_PROD=179 OR COD_PROD=182 OR COD_PROD=150 OR COD_PROD=183 OR COD_PROD=157 OR COD_PROD=171 OR COD_PROD=172 OR COD_PROD=181 OR COD_PROD=111)</sqlStr>
        <field nameT="CURRENT_ACCOUNT_NUMBER" name="current_account_number" type="0" position="0" end="39"/>
        <field nameT="CHARGE_DURATION_FRM" name="charge_duration_frm" format="yyyyMMdd" type="1" position="40" end="47"/>
        <field nameT="CHARGE_VALUTA" name="charge_valuta" format="yyyyMMdd" type="1" position="48" end="55"/>
        <field nameT="CHARGE_AMOUNT" name="charge_amount" type="0" position="56" end="78"/>
      </model>
      <model id="A4569501_ASS_TO_IMP_POR">
        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.A4569501_ASS_TO_IMP_POR.ldr"/>
        <option id="recordSize" value="70"/>
        <sqlStr xml:space="preserve"></sqlStr>
        <field nameT="CURRENT_ACCOUNT_NUMBER" type="0" position="0" end="39"/>
        <field nameT="PORTFOLIO_NM" type="0" position="40" end="69"/>
      </model>
      <model id="A4569501_CURRENT_ACCOUNT">
        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.A4569501_CURRENT_ACCOUNT.ldr"/>
        <option id="recordSize" value="205"/>
        <sqlStr xml:space="preserve">SELECT 'ch_acct_'
       || COD_ACCT_NO              "current_account_number"
       , 'A'                       "activev"
	   , 176                       "company"
       , 'FCR_'
         || COD_CUST               "ext_key_address"
       , COD_PROD                  "motive_nm"
       , Decode (COD_CCY, 100, 'NGN',
                          102, 'GBP',
                          114, 'EUR',
                          104, 'CHF',
                          101, 'USD',
                          112, 'CAD',
                          103, 'DEM',
                          105, 'FRF',
                          COD_CCY) "ext_key_currency"
       , DAT_ACCT_OPEN             "acct_start_date"
       , COD_CC_BRN                "organization_unit_nm"
       , COD_OFFICR_ID             "dealer_nm"
       , NULL                      "bank_segment_nm"
       , NULL                      "cost_center_nm"
       , NULL                      "capital_duration_to"       
FROM   fcrlive.CH_ACCT_MAST
WHERE  DAT_ACCT_OPEN &lt;= To_date('$POSTINGDATE', 'yyyymmdd')
       AND NOT ( COD_ACCT_STAT = 1
                  OR cod_acct_stat = 5 )
       AND flg_mnt_status = 'A'
       AND NOT ( COD_PROD = 169
                  OR COD_PROD = 175
                  OR COD_PROD = 176
                  OR COD_PROD = 177
                  OR COD_PROD = 179
                  OR COD_PROD = 182
                  OR COD_PROD = 150
                  OR COD_PROD = 183
                  OR COD_PROD = 157
                  OR COD_PROD = 171
                  OR COD_PROD = 172
                  OR COD_PROD = 181
                  OR COD_PROD = 111 )
UNION ALL
SELECT /* +parallel(a,6) parallel(b,6) */ a.cod_acct_no                  "current_account_number"
                                          , 'A'                          "activev"
                                          , 176                        "company"
                                          , 'FCR_'
                                            || COD_CUST_ID               "ext_key_address"
                                          , COD_PROD                     "motive_nm"
                                          , Decode (COD_CCY, 100, 'NGN',
                                                             102, 'GBP',
                                                             114, 'EUR',
                                                             104, 'CHF',
                                                             101, 'USD',
                                                             112, 'CAD',
                                                             103, 'DEM',
                                                             105, 'FRF',
                                                             COD_CCY)    "ext_key_currency"
                                          , date_instal                  "acct_start_date"
                                          , COD_CC_BRN                   "organization_unit_nm"
                                          , NULL                         "dealer_nm"
                                          , NULL                         "bank_segment_nm"
                                          , NULL                         "cost_center_nm"
                                          , NULL                         "capital_duration_to"
FROM   fcrlive.ln_acct_mast a
       inner join fcrlive.LN_ACCT_SCHEDULE_DETLS b
               ON a.cod_acct_no = b.cod_acct_no
                  AND date_instal = (SELECT Max(date_instal)
                                     FROM   fcrlive.LN_ACCT_SCHEDULE_DETLS
                                     WHERE  cod_acct_no = b.cod_acct_no)
WHERE  flg_mnt_status = 'A'
       AND cod_acct_stat NOT IN ( 1, 5 )
       AND a.dat_of_maturity &lt;= To_date('$POSTINGDATE', 'YYYYMMDD')
       AND Round(Amt_Princ_Balance, 2) != 0
       AND ( amt_princ_bal = 0
              OR amt_princ_bal IS NULL ) 
</sqlStr>        <field nameT="CURRENT_ACCOUNT_NUMBER" name="current_account_number" type="0" position="0" end="39"/>        <field nameT="ACTIVEV" name="activev" type="0" position="40" end="40"/>        <field nameT="COMPANY" name="company" type="0" position="41" end="43"/>        <field nameT="EXT_KEY_ADDRESS" name="ext_key_address" type="0" position="44" end="73"/>        <field nameT="MOTIVE_NM" name="motive_nm" type="0" position="74" end="83"/>        <field nameT="EXT_KEY_CURRENCY" name="ext_key_currency" type="0" position="84" end="113"/>        <field nameT="ACC_START_DATE" name="acct_start_date" format="yyyyMMdd" type="1" position="114" end="121"/>        <field nameT="ORGANISATION_UNIT_NM" name="organization_unit_nm" type="0" position="122" end="133"/>        <field nameT="DEALER_NM" name="dealer_nm" type="0" position="134" end="168"/>        <field nameT="BANK_SEGMENT_NM" name="bank_segment_nm" type="0" position="169" end="188"/>        <field nameT="COST_CENTER_NM" name="cost_center_nm" type="0" position="189" end="196"/>        <field nameT="CAPITAL_DURATION_TO" name="capital_duration_to" format="yyyyMMdd" type="1" position="197" end="204"/>      </model>      <model id="A4569501_FEES_STRAIGHT_LINE">        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.A4569501_FEES_STRAIGHT_LINE.ldr"/>        <option id="recordSize" value="131"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="CURRENT_ACCOUNT_NUMBER" type="0" position="0" end="39"/>        <field nameT="EXT_KEY_CURRENCY" type="0" position="40" end="69"/>        <field nameT="CHARGE_TYPE_NM" type="0" position="70" end="81"/>        <field nameT="SALES_TYPE_NM" type="0" position="82" end="91"/>        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="92" end="99"/>        <field nameT="CHARGE_DURATION_TO" format="yyyyMMdd" type="1" position="100" end="107"/>        <field nameT="CHARGE_AMOUNT" type="0" position="108" end="130"/>      </model>      <model id="A4569501_IMPAIRMENT_ADJUSTMENT">        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.A4569501_IMPAIRMENT_ADJUSTMENT.ldr"/>        <option id="recordSize" value="71"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="CURRENT_ACCOUNT_NUMBER" type="0" position="0" end="39"/>        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="40" end="47"/>        <field nameT="CHARGE_AMOUNT" type="0" position="48" end="70"/>      </model>      <model id="A4569501_ONE_TIM_FEE_DIR_IN_PL">        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.A4569501_ONE_TIM_FEE_DIR_IN_PL.ldr"/>        <option id="recordSize" value="93"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="CURRENT_ACCOUNT_NUMBER" type="0" position="0" end="39"/>        <field nameT="CHARGE_TYPE_NM" type="0" position="40" end="51"/>        <field nameT="SALES_TYPE_NM" type="0" position="52" end="61"/>        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="62" end="69"/>        <field nameT="CHARGE_AMOUNT" type="0" position="70" end="92"/>      </model>      <model id="A4569501_WRITE_OFF">        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.A4569501_WRITE_OFF.ldr"/>        <option id="recordSize" value="71"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="CURRENT_ACCOUNT_NUMBER" type="0" position="0" end="39"/>        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="40" end="47"/>        <field nameT="CHARGE_AMOUNT" type="0" position="48" end="70"/>      </model>      <model id="A4569502_ACC_BAL_NOM_AMO">        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.A4569502_ACC_BAL_NOM_AMO.ldr"/>        <option id="recordSize" value="63"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="CURRENT_ACCOUNT_NUMBER" type="0" position="0" end="39"/>        <field nameT="CAPITAL" type="0" position="40" end="62"/>      </model>      <model id="A4569502_ACC_OUT_INT">        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.A4569502_ACC_OUT_INT.ldr"/>        <option id="recordSize" value="79"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="CURRENT_ACCOUNT_NUMBER" type="0" position="0" end="39"/>        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="40" end="47"/>        <field nameT="CHARGE_VALUTA" format="yyyyMMdd" type="1" position="48" end="55"/>        <field nameT="CHARGE_AMOUNT" type="0" position="56" end="78"/>      </model>      <model id="A4569502_FEES_STRAIGHT_LINE">        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.A4569502_FEES_STRAIGHT_LINE.ldr"/>        <option id="recordSize" value="131"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="CURRENT_ACCOUNT_NUMBER" type="0" position="0" end="39"/>        <field nameT="EXT_KEY_CURRENCY" type="0" position="40" end="69"/>        <field nameT="CHARGE_TYPE_NM" type="0" position="70" end="81"/>        <field nameT="SALES_TYPE_NM" type="0" position="82" end="91"/>        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="92" end="99"/>        <field nameT="CHARGE_DURATION_TO" format="yyyyMMdd" type="1" position="100" end="107"/>        <field nameT="CHARGE_AMOUNT" type="0" position="108" end="130"/>      </model>      <model id="A4569502_ONE_TIM_FEE_DIR_IN_PL">        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.A4569502_ONE_TIM_FEE_DIR_IN_PL.ldr"/>        <option id="recordSize" value="93"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="CURRENT_ACCOUNT_NUMBER" type="0" position="0" end="39"/>        <field nameT="CHARGE_TYPE_NM" type="0" position="40" end="51"/>        <field nameT="SALES_TYPE_NM" type="0" position="52" end="61"/>        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="62" end="69"/>        <field nameT="CHARGE_AMOUNT" type="0" position="70" end="92"/>      </model>      <model id="A4569502_SAVINGS_ACCOUNT">        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.A4569502_SAVINGS_ACCOUNT.ldr"/>        <option id="recordSize" value="205"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="CURRENT_ACCOUNT_NUMBER" type="0" position="0" end="39"/>        <field nameT="ACTIVEV" type="0" position="40" end="40"/>        <field nameT="COMPANY" type="0" position="41" end="43"/>        <field nameT="EXT_KEY_ADDRESS" type="0" position="44" end="73"/>        <field nameT="MOTIVE_NM" type="0" position="74" end="83"/>        <field nameT="EXT_KEY_CURRENCY" type="0" position="84" end="113"/>        <field nameT="ACC_START_DATE" format="yyyyMMdd" type="1" position="114" end="121"/>        <field nameT="ORGANISATION_UNIT_NM" type="0" position="122" end="133"/>        <field nameT="DEALER_NM" type="0" position="134" end="168"/>        <field nameT="BANK_SEGMENT_NM" type="0" position="169" end="188"/>        <field nameT="COST_CENTER_NM" type="0" position="189" end="196"/>        <field nameT="CAPITAL_DURATION_TO" format="yyyyMMdd" type="1" position="197" end="204"/>      </model>      <model id="A4569503_FEES_STRAIGHT_LINE">        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.A4569503_FEES_STRAIGHT_LINE.ldr"/>        <option id="recordSize" value="131"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="CURRENT_ACCOUNT_NUMBER" type="0" position="0" end="39"/>        <field nameT="EXT_KEY_CURRENCY" type="0" position="40" end="69"/>        <field nameT="CHARGE_TYPE_NM" type="0" position="70" end="81"/>        <field nameT="SALES_TYPE_NM" type="0" position="82" end="91"/>        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="92" end="99"/>        <field nameT="CHARGE_DURATION_TO" format="yyyyMMdd" type="1" position="100" end="107"/>        <field nameT="CHARGE_AMOUNT" type="0" position="108" end="130"/>      </model>      <model id="A4569503_INC_PAY_IN_PL">        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.A4569503_INC_PAY_IN_PL.ldr"/>        <option id="recordSize" value="71"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="CURRENT_ACCOUNT_NUMBER" type="0" position="0" end="39"/>        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="40" end="47"/>        <field nameT="CHARGE_AMOUNT" type="0" position="48" end="70"/>      </model>      <model id="A4569503_NOM_AMO_OFF_BAL">        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.A4569503_NOM_AMO_OFF_BAL.ldr"/>        <option id="recordSize" value="64"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="CURRENT_ACCOUNT_NUMBER" type="0" position="0" end="39"/>        <field nameT="CREDIT_DEBIT" type="0" position="40" end="40"/>        <field nameT="CAPITAL" type="0" position="41" end="63"/>      </model>      <model id="A4569503_OFF_BALANCE_ITEM">        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.A4569503_OFF_BALANCE_ITEM.ldr"/>        <option id="recordSize" value="205"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="CURRENT_ACCOUNT_NUMBER" type="0" position="0" end="39"/>        <field nameT="ACTIVEV" type="0" position="40" end="40"/>        <field nameT="COMPANY" type="0" position="41" end="43"/>        <field nameT="EXT_KEY_ADDRESS" type="0" position="44" end="73"/>        <field nameT="MOTIVE_NM" type="0" position="74" end="83"/>        <field nameT="EXT_KEY_CURRENCY" type="0" position="84" end="113"/>        <field nameT="ACC_START_DATE" format="yyyyMMdd" type="1" position="114" end="121"/>        <field nameT="ORGANISATION_UNIT_NM" type="0" position="122" end="133"/>        <field nameT="DEALER_NM" type="0" position="134" end="168"/>        <field nameT="BANK_SEGMENT_NM" type="0" position="169" end="188"/>        <field nameT="COST_CENTER_NM" type="0" position="189" end="196"/>        <field nameT="CAPITAL_DURATION_TO" format="yyyyMMdd" type="1" position="197" end="204"/>      </model>      <model id="A4569503_ONE_TIM_FEE_DIR_IN_PL">        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.A4569503_ONE_TIM_FEE_DIR_IN_PL.ldr"/>        <option id="recordSize" value="93"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="CURRENT_ACCOUNT_NUMBER" type="0" position="0" end="39"/>        <field nameT="CHARGE_TYPE_NM" type="0" position="40" end="51"/>        <field nameT="SALES_TYPE_NM" type="0" position="52" end="61"/>        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="62" end="69"/>        <field nameT="CHARGE_AMOUNT" type="0" position="70" end="92"/>      </model>      <model id="A4569503_OUT_PAY_IN_PL">        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.A4569503_OUT_PAY_IN_PL.ldr"/>        <option id="recordSize" value="71"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="CURRENT_ACCOUNT_NUMBER" type="0" position="0" end="39"/>        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="40" end="47"/>        <field nameT="CHARGE_AMOUNT" type="0" position="48" end="70"/>      </model>    </group>    <group id="common">      <option id="active" value="0"/>      <model id="GENERAL_CUSTOMER_INFO_LN">        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.GENERAL_CUSTOMER_INFO_LN.ldr"/>        <option id="recordSize" value="946"/>        <sqlStr xml:space="preserve">SELECT 176                  "company"
       , 'FCR_' || COD_CUST_ID        "addr_shn"
       , Trim(FLG_CUST_TYP) "addr_type_nm"
       , FLG_STAFF
       , NAM_CUST_FULL      "name_1"
       , NAM_CUST_LAST
       , NAM_CUST_MID
       , NAM_CUST_FIRST
       , TXT_PROFESS_CAT
       , TXT_CUSTADR_ADD1   "name_2"
       , TXT_CUSTADR_ADD2   "name_3"
       , TXT_CUSTADR_ADD3   "name_4"
       , NAM_CUSTADR_CITY   "town"
       , NAM_CUSTADR_STATE  
       , null				"federal_state_nm"
       , NAM_CUSTADR_CNTRY  "country"
       , TXT_CUSTADR_ZIP
       , TXT_CUST_NATNLTY   "ext_key_ctry_addr"
       , COD_BUSINESS_REGNO
       , COD_BUSINESS_CAT   "ext_key_branch"
       , TXT_BUSINESS_TYP
       , COD_CUST_STATUS
       , COD_TDS_2
FROM   CI_CUSTMAST 
inner join (
	SELECT COD_CUST "COD_CUST_ID"
	       FROM   fcrlive.CH_ACCT_MAST
	       WHERE  DAT_ACCT_OPEN &lt;= To_date('$POSTINGDATE', 'yyyymmdd')
		      AND NOT ( COD_ACCT_STAT = 1
				 OR cod_acct_stat = 5 )
	union
	SELECT COD_CUST_ID "COD_CUST_ID"
		   FROM   fcrlive.ln_acct_mast
		   WHERE  dat_acct_open &lt;= To_date('$POSTINGDATE', 'yyyymmdd')
			  AND Least(dat_of_maturity, Nvl(dat_acct_close, dat_of_maturity)) &gt;=
			      To_date('$POSTINGDATE', 'yyyymmdd')
			  AND NOT ( COD_ACCT_STAT = 1
				     OR cod_acct_stat = 5 )
	union SELECT COD_CUST "COD_CUST_ID"
		   FROM   fcrlive.TD_DEP_MAST t1
		   WHERE  t1.DAT_DEP_DATE &lt;= To_date('$POSTINGDATE', 'YYYYMMDD')
			  AND t1.DAT_MATURITY &gt;= To_date('$POSTINGDATE', 'YYYYMMDD')
			  AND NOT ( COD_DEP_STAT = 1
				     OR cod_dep_stat = 5 )
	) t2 using (COD_CUST_ID) 
</sqlStr>        <field nameT="COMPANY" name="company" type="0" position="0" end="2"/>        <field nameT="ADDR_SHN" name="addr_shn" type="0" position="3" end="14"/>        <field nameT="NAME_1" name="name_1" type="0" position="15" end="214"/>        <field nameT="NAME_2" name="name_2" type="0" position="215" end="414"/>        <field nameT="NAME_3" name="name_3" type="0" position="415" end="614"/>        <field nameT="NAME_4" name="name_4" type="0" position="615" end="814"/>        <field nameT="TOWN" name="town" type="0" position="815" end="849"/>        <field nameT="EXT_KEY_CTRY_ADDR" name="ext_key_ctry_addr" type="0" position="850" end="879"/>        <field nameT="ADDR_TYPE_NM" name="addr_type_nm" type="0" position="880" end="887"/>        <field nameT="EXT_KEY_BBRANCH" name="ext_key_branch" type="0" position="888" end="917"/>        <field nameT="LEGAL_FORM_NM" type="0" position="918" end="925"/>        <field nameT="FEDERAL_STATE_NM" name="federal_state_nm" type="0" position="926" end="945"/>      </model>      <model id="IMPAIRMENT_PORTFOLIO">        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.IMPAIRMENT_PORTFOLIO.ldr"/>        <option id="recordSize" value="51"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="COMPANY" type="0" position="0" end="2"/>        <field nameT="CASH_FLOW_SCENARIO_NM" type="0" position="3" end="32"/>        <field nameT="RATE_01" type="0" position="33" end="41"/>        <field nameT="RATE_02" type="0" position="42" end="50"/>      </model>    </group>    <group id="loan">      <option id="active" value="0"/>      <model id="L4567502_ACCOUNTING_CATEGORIES">        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.L4567502_ACCOUNTING_CATEGORIES.ldr"/>        <option id="recordSize" value="52"/>        <sqlStr xml:space="preserve">SELECT COD_ACCT_NO                                                    "trs_nr_nm"
       , 'LAR' "accounting_category_nm"
FROM   fcrlive.ln_acct_mast
WHERE  dat_acct_open &lt;= To_date('$POSTINGDATE', 'yyyymmdd')
       AND Least(dat_of_maturity, Nvl(dat_acct_close, dat_of_maturity)) &gt;= To_date('$POSTINGDATE', 'yyyymmdd')
       AND NOT ( COD_ACCT_STAT = 1 OR cod_acct_stat = 5 )
       AND NOT ( cod_prod = 601
		  OR cod_prod = 602
		  OR cod_prod = 603
		  OR cod_prod = 604
		  OR cod_prod = 605
		  OR cod_prod = 606
		  OR cod_prod = 617
		  OR cod_prod = 618
		  OR cod_prod = 619
		  OR cod_prod = 620
		  OR cod_prod = 621
		  OR cod_prod = 622
		  OR cod_prod = 623
		  OR cod_prod = 624
		  OR cod_prod = 625
		  OR cod_prod = 626 )</sqlStr>
        <field nameT="TRS_NR_NM" name="trs_nr_nm" type="0" position="0" end="39"/>
        <field nameT="ACCOUNTING_CATEGORY_NM" name="accounting_category_nm" type="0" position="40" end="51"/>
      </model>
      <model id="L4567502_ASS_TO_POR_IMP">
        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.L4567502_ASS_TO_POR_IMP.ldr"/>
        <option id="recordSize" value="70"/>
        <sqlStr xml:space="preserve"></sqlStr>
        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>
        <field nameT="PORTFOLIO_NM" type="0" position="40" end="69"/>
      </model>
      <model id="L4567502_ASS_TO_POR_PRE">
        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.L4567502_ASS_TO_POR_PRE.ldr"/>
        <option id="recordSize" value="70"/>
        <sqlStr xml:space="preserve"></sqlStr>
        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>
        <field nameT="PORTFOLIO_NM" type="0" position="40" end="69"/>
      </model>
      <model id="L4567502_CUR_INT_TRA">
        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.L4567502_CUR_INT_TRA.ldr"/>
        <option id="recordSize" value="87"/>
        <sqlStr xml:space="preserve"></sqlStr>
        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>
        <field nameT="INTEREST_DURATION_FRM" format="yyyyMMdd" type="1" position="40" end="47"/>
        <field nameT="INTEREST_DURATION_TO" format="yyyyMMdd" type="1" position="48" end="55"/>
        <field nameT="INTEREST_DURATION_TO_NEXT" format="yyyyMMdd" type="1" position="56" end="63"/>
        <field nameT="INTEREST_DURATION_NM" type="0" position="64" end="75"/>
        <field nameT="INTEREST_METHOD" type="0" position="76" end="77"/>
        <field nameT="INTEREST_RATE" type="0" position="78" end="86"/>
      </model>
      <model id="L4567502_DIR_WRI_OFF_FRA_DET">
        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.L4567502_DIR_WRI_OFF_FRA_DET.ldr"/>
        <option id="recordSize" value="48"/>
        <sqlStr xml:space="preserve"></sqlStr>
        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>
        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="40" end="47"/>
      </model>
      <model id="L4567502_IMPAIRMENT_END">
        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.L4567502_IMPAIRMENT_END.ldr"/>
        <option id="recordSize" value="48"/>
        <sqlStr xml:space="preserve"></sqlStr>
        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>
        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="40" end="47"/>
      </model>
      <model id="L4567502_IRR_CAP_INC">
        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.L4567502_IRR_CAP_INC.ldr"/>
        <option id="recordSize" value="71"/>
        <sqlStr xml:space="preserve">SELECT b.cod_acct_no       "trs_nr_nm"
       , b.amt_dedn_acy	   "capital_chg_increase"
       , b.dat_post		   "valuta"	
FROM   fcrlive.ln_acct_mast a
       inner join fcrlive.LN_DISB_DEDN_DETL b
	       ON a.cod_acct_no = b.cod_acct_no and b.dat_post&gt;a.dat_first_disb
WHERE  dat_acct_open &lt;= To_date('$POSTINGDATE', 'yyyymmdd')
       AND Least(dat_of_maturity, Nvl(dat_acct_close, dat_of_maturity)) &gt;= To_date('$POSTINGDATE', 'yyyymmdd')
       AND NOT ( COD_ACCT_STAT = 1 OR cod_acct_stat = 5 )
       AND NOT ( cod_prod = 601
		  OR cod_prod = 602
		  OR cod_prod = 603
		  OR cod_prod = 604
		  OR cod_prod = 605
		  OR cod_prod = 606
		  OR cod_prod = 617
		  OR cod_prod = 618
		  OR cod_prod = 619
		  OR cod_prod = 620
		  OR cod_prod = 621
		  OR cod_prod = 622
		  OR cod_prod = 623
		  OR cod_prod = 624
		  OR cod_prod = 625
		  OR cod_prod = 626 )</sqlStr>
        <field nameT="TRS_NR_NM" name="trs_nr_nm" type="0" position="0" end="39"/>
        <field nameT="VALUTA" name="valuta" format="yyyyMMdd" type="1" position="40" end="47"/>
        <field nameT="CAPITAL_CHG_INCREASE" name="capital_chg_increase" type="0" position="48" end="70"/>
      </model>
      <model id="L4567502_IRR_REP_CON">
        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.L4567502_IRR_REP_CON.ldr"/>
        <option id="recordSize" value="71"/>
        <sqlStr xml:space="preserve">SELECT a.COD_ACCT_NO     "trs_nr_nm"
       , b.date_instal   "valuta"
       , b.amt_principal "capital_chg_decrease"
FROM   fcrlive.ln_acct_mast a
       inner join fcrlive.LN_ACCT_SCHEDULE_DETLS b
	       ON a.cod_acct_no = b.cod_acct_no
WHERE  dat_acct_open &lt;= To_date('$POSTINGDATE', 'yyyymmdd')
       AND Least(dat_of_maturity, Nvl(dat_acct_close, dat_of_maturity)) &gt;= To_date('$POSTINGDATE', 'yyyymmdd')
       AND NOT ( COD_ACCT_STAT = 1
		  OR cod_acct_stat = 5 )
       AND NOT ( cod_prod = 601
		  OR cod_prod = 602
		  OR cod_prod = 603
		  OR cod_prod = 604
		  OR cod_prod = 605
		  OR cod_prod = 606
		  OR cod_prod = 617
		  OR cod_prod = 618
		  OR cod_prod = 619
		  OR cod_prod = 620
		  OR cod_prod = 621
		  OR cod_prod = 622
		  OR cod_prod = 623
		  OR cod_prod = 624
		  OR cod_prod = 625
		  OR cod_prod = 626 )
       AND b.amt_principal != 0
UNION ALL
SELECT cod_acct_no
       , dat_value
       , AMT_TXN_TCY
FROM   fcrlive.ln_acct_ledg
       inner join fcrlive.ln_acct_mast USING (COD_ACCT_NO)
WHERE  ( cod_txn_mnemonic = 6532
	  OR cod_txn_mnemonic = 6609
	  OR cod_txn_mnemonic = 6632
	  OR cod_txn_mnemonic = 6719
	  OR cod_txn_mnemonic = 1066
	  OR cod_txn_mnemonic = 1082
	  OR cod_txn_mnemonic = 1404 )
       AND dat_acct_open &lt;= To_date('$POSTINGDATE', 'yyyymmdd')
       AND Least(dat_of_maturity, Nvl(dat_acct_close, dat_of_maturity)) &gt;= To_date('$POSTINGDATE', 'yyyymmdd')
       AND NOT ( COD_ACCT_STAT = 1
		  OR cod_acct_stat = 5 )
       AND NOT ( cod_prod = 601
		  OR cod_prod = 602
		  OR cod_prod = 603
		  OR cod_prod = 604
		  OR cod_prod = 605
		  OR cod_prod = 606
		  OR cod_prod = 617
		  OR cod_prod = 618
		  OR cod_prod = 619
		  OR cod_prod = 620
		  OR cod_prod = 621
		  OR cod_prod = 622
		  OR cod_prod = 623
		  OR cod_prod = 624
		  OR cod_prod = 625
		  OR cod_prod = 626 )
       AND AMT_TXN_TCY != 0
ORDER  BY 1 
</sqlStr>        <field nameT="TRS_NR_NM" name="trs_nr_nm" type="0" position="0" end="39"/>        <field nameT="VALUTA" name="valuta" format="yyyyMMdd" type="1" position="40" end="47"/>        <field nameT="CAPITAL_CHG_DECREASE" name="capital_chg_decrease" type="0" position="48" end="70"/>      </model>      <model id="L4567502_NOM_AMO_REC_OVE_AFF_A">        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.L4567502_NOM_AMO_REC_OVE_AFF_A.ldr"/>        <option id="recordSize" value="71"/>        <sqlStr xml:space="preserve">SELECT cod_acct_no      "trs_nr_nm"
       , date_instal    "valuta"
       , round(-amt_princ_bal,2) "period_capital"
FROM   fcrlive.ln_acct_mast a
       inner join fcrlive.LN_ACCT_SCHEDULE_DETLS b USING (COD_ACCT_NO)
WHERE  dat_acct_open &lt;= To_date('$POSTINGDATE', 'yyyymmdd')
       AND Least(dat_of_maturity, Nvl(dat_acct_close, dat_of_maturity)) &gt;= To_date('$POSTINGDATE', 'yyyymmdd')
       AND date_instal &lt;= To_date('$POSTINGDATE', 'yyyymmdd')
       AND NOT ( COD_ACCT_STAT = 1
		  OR cod_acct_stat = 5 )
	   and round(-amt_princ_bal,2)!=0
       AND NOT ( cod_prod = 601
		  OR cod_prod = 602
		  OR cod_prod = 603
		  OR cod_prod = 604
		  OR cod_prod = 605
		  OR cod_prod = 606
		  OR cod_prod = 617
		  OR cod_prod = 618
		  OR cod_prod = 619
		  OR cod_prod = 620
		  OR cod_prod = 621
		  OR cod_prod = 622
		  OR cod_prod = 623
		  OR cod_prod = 624
		  OR cod_prod = 625
		  OR cod_prod = 626 ) 
</sqlStr>        <field nameT="TRS_NR_NM" name="trs_nr_nm" type="0" position="0" end="39"/>        <field nameT="VALUTA" name="valuta" format="yyyyMMdd" type="1" position="40" end="47"/>        <field nameT="PERIOD_CAPITAL" name="period_capital" type="0" position="48" end="70"/>      </model>      <model id="L4567502_PAS_INT_TRA">        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.L4567502_PAS_INT_TRA.ldr"/>        <option id="recordSize" value="115"/>        <sqlStr xml:space="preserve">SELECT a.COD_ACCT_NO                                                                            "trs_nr_nm"
       , b.CHG_DATE                                                                             "interest_duration_frm"
       , (SELECT Min(DATE_INSTAL)
	  FROM   fcrlive.LN_ACCT_SCHEDULE_DETLS t2
	  WHERE  COD_ACCT_NO = a.COD_ACCT_NO
		 AND CTR_STAGE_NO = c.CTR_STAGE_NO
		 AND DATE_INSTAL &gt; b.CHG_DATE
		 AND DATE_INSTAL &lt;= (SELECT Min(CHG_DATE)
				     FROM   (SELECT COD_ACCT_NO
						    , DAT_STAGE_START chg_date
					     FROM   fcrlive.LN_ACCT_SCHEDULE
					     WHERE  NOT NAM_STAGE = 'PMI'
					     UNION
					     SELECT COD_ACCT_NO
						    , DAT_EFF_INT_INDX
					     FROM   fcrlive.LN_ACCT_RATES
					     UNION
					     SELECT a.COD_ACCT_NO
						    , b.dat_start
					     FROM   fcrlive.LN_ACCT_MAST a
						    left join fcrlive.LN_ACCT_SCHEDULE_DETLS b
							   ON a.COD_ACCT_NO = b.COD_ACCT_NO
					     WHERE  b.dat_start = (SELECT Min(dat_start)
								   FROM   fcrlive.LN_ACCT_SCHEDULE_DETLS
								   WHERE  cod_acct_no = a.cod_acct_no)
					     UNION
					     SELECT COD_ACCT_NO
						    , Least(DAT_OF_MATURITY, Nvl(DAT_ACCT_CLOSE, DAT_OF_MATURITY))
					     FROM   fcrlive.LN_ACCT_MAST) t1
				     WHERE  COD_ACCT_NO = a.COD_ACCT_NO
					    AND t1.CHG_DATE &gt; b.CHG_DATE))                      "interest_duration_to"
       , Nvl((SELECT RAT_INT_SLAB + RAT_ACCT_VAR
	      FROM   fcrlive.LN_ACCT_RATES t2
	      WHERE  COD_ACCT_NO = a.COD_ACCT_NO
		     AND c.COD_INT_RATE = CTR_INT_SRL
		     AND flg_mnt_status != 'U'
		     AND t2.DAT_EFF_INT_INDX = (SELECT Max(DAT_EFF_INT_INDX)
						FROM   fcrlive.LN_ACCT_RATES
						WHERE  COD_ACCT_NO = t2.COD_ACCT_NO
						       AND CTR_INT_SRL = t2.CTR_INT_SRL
						       AND flg_mnt_status != 'U'
						       AND DAT_EFF_INT_INDX &lt;= b.CHG_DATE)), 0) "interest_rate"
       , (SELECT Min(CHG_DATE)
	  FROM   (SELECT COD_ACCT_NO
			 , DAT_STAGE_START chg_date
		  FROM   fcrlive.LN_ACCT_SCHEDULE
		  WHERE  NOT NAM_STAGE = 'PMI'
		  UNION
		  SELECT COD_ACCT_NO
			 , DAT_EFF_INT_INDX
		  FROM   fcrlive.LN_ACCT_RATES
		  UNION
		  SELECT a.COD_ACCT_NO
			 , b.dat_start
		  FROM   fcrlive.LN_ACCT_MAST a
			 left join fcrlive.LN_ACCT_SCHEDULE_DETLS b
				ON a.COD_ACCT_NO = b.COD_ACCT_NO
		  WHERE  b.dat_start = (SELECT Min(dat_start)
					FROM   fcrlive.LN_ACCT_SCHEDULE_DETLS
					WHERE  cod_acct_no = a.cod_acct_no)
		  UNION
		  SELECT COD_ACCT_NO
			 , Least(DAT_OF_MATURITY, Nvl(DAT_ACCT_CLOSE, DAT_OF_MATURITY))
		  FROM   fcrlive.LN_ACCT_MAST) t1
	  WHERE  COD_ACCT_NO = a.COD_ACCT_NO
		 AND t1.CHG_DATE &gt; b.CHG_DATE)                                                  "interest_date_change"
       , (SELECT Min(DATE_INSTAL)
	  FROM   fcrlive.LN_ACCT_SCHEDULE_DETLS
	  WHERE  COD_ACCT_NO = a.COD_ACCT_NO
		 AND DATE_INSTAL &gt;= (SELECT Min(CHG_DATE)
				     FROM   (SELECT COD_ACCT_NO
						    , DAT_STAGE_START chg_date
					     FROM   fcrlive.LN_ACCT_SCHEDULE
					     WHERE  NOT NAM_STAGE = 'PMI'
					     UNION
					     SELECT COD_ACCT_NO
						    , DAT_EFF_INT_INDX
					     FROM   fcrlive.LN_ACCT_RATES
					     UNION
					     SELECT a.COD_ACCT_NO
						    , b.dat_start
					     FROM   fcrlive.LN_ACCT_MAST a
						    left join fcrlive.LN_ACCT_SCHEDULE_DETLS b
							   ON a.COD_ACCT_NO = b.COD_ACCT_NO
					     WHERE  b.dat_start = (SELECT Min(dat_start)
								   FROM   fcrlive.LN_ACCT_SCHEDULE_DETLS
								   WHERE  cod_acct_no = a.cod_acct_no)
					     UNION
					     SELECT COD_ACCT_NO
						    , Least(DAT_OF_MATURITY, Nvl(DAT_ACCT_CLOSE, DAT_OF_MATURITY))
					     FROM   fcrlive.LN_ACCT_MAST) t1
				     WHERE  COD_ACCT_NO = a.COD_ACCT_NO
					    AND t1.CHG_DATE &gt; b.CHG_DATE))
	 "interest_duration_end_valuta"
       , 31                                                                                     "interest_method"
       , CASE
	   WHEN c.COD_SCHED_TYPE IN ( 21, 22, 23, 24,
				      51, 52, 53, 54,
				      59, 63, 65, 614 ) THEN '1MU'
	   WHEN c.COD_SCHED_TYPE IN ( 60, 61, 66 ) THEN '3MU'
	   WHEN c.COD_SCHED_TYPE IN ( 62, 64 ) THEN '6MU'
	   WHEN c.COD_SCHED_TYPE IS NULL THEN NULL
	   ELSE c.COD_SCHED_TYPE
		|| '!'
	 END                                                                                    "interest_duration_nm"
       , CASE
	   WHEN c.COD_SCHED_TYPE IN ( 59, 60, 61, 62 ) THEN 'ARRCAPINT'
	   ELSE 'ARREARS'
	 END                                                                                    "pay_agreement_nm"
FROM   fcrlive.LN_ACCT_MAST a
       inner join (SELECT COD_ACCT_NO
			  , DAT_STAGE_START chg_date
		   FROM   fcrlive.LN_ACCT_SCHEDULE
		   WHERE  NOT NAM_STAGE = 'PMI'
		   UNION
		   SELECT COD_ACCT_NO
			  , DAT_EFF_INT_INDX
		   FROM   fcrlive.LN_ACCT_RATES
		   UNION
		   SELECT a.COD_ACCT_NO
			  , b.dat_start
		   FROM   fcrlive.LN_ACCT_MAST a
			  left join fcrlive.LN_ACCT_SCHEDULE_DETLS b
				 ON a.COD_ACCT_NO = b.COD_ACCT_NO
		   WHERE  b.dat_start = (SELECT Min(dat_start)
					 FROM   fcrlive.LN_ACCT_SCHEDULE_DETLS
					 WHERE  cod_acct_no = a.cod_acct_no)) b
	       ON a.COD_ACCT_NO = b.COD_ACCT_NO
		  AND Least(a.DAT_ACCT_OPEN, Nvl(a.DAT_FIRST_DISB, a.DAT_ACCT_OPEN)) &lt;= b.CHG_DATE
		  AND Least(DAT_OF_MATURITY, Nvl(DAT_ACCT_CLOSE, DAT_OF_MATURITY)) &gt;= b.CHG_DATE
       left join fcrlive.LN_ACCT_SCHEDULE c
	      ON a.COD_ACCT_NO = c.COD_ACCT_NO
		 AND c.DAT_STAGE_START &lt;= b.CHG_DATE
		 AND c.DAT_STAGE_END &gt; b.CHG_DATE
WHERE  dat_acct_open &lt;= To_date('$POSTINGDATE', 'yyyymmdd')
       AND Least(dat_of_maturity, Nvl(dat_acct_close, dat_of_maturity)) &gt;= To_date('$POSTINGDATE', 'yyyymmdd')
       AND NOT ( COD_ACCT_STAT = 1
		  OR cod_acct_stat = 5 )
       AND NOT c.NAM_STAGE = 'PMI'
       AND NOT ( c.dat_stage_start &gt;= Least(DAT_OF_MATURITY, Nvl(DAT_ACCT_CLOSE, DAT_OF_MATURITY)) )
       AND NOT ( cod_prod = 601
		  OR cod_prod = 602
		  OR cod_prod = 603
		  OR cod_prod = 604
		  OR cod_prod = 605
		  OR cod_prod = 606
		  OR cod_prod = 617
		  OR cod_prod = 618
		  OR cod_prod = 619
		  OR cod_prod = 620
		  OR cod_prod = 621
		  OR cod_prod = 622
		  OR cod_prod = 623
		  OR cod_prod = 624
		  OR cod_prod = 625
		  OR cod_prod = 626 ) 
</sqlStr>        <field nameT="TRS_NR_NM" name="trs_nr_nm" type="0" position="0" end="39"/>        <field nameT="INTEREST_DURATION_FRM" name="interest_duration_frm" format="yyyyMMdd" type="1" position="40" end="47"/>        <field nameT="INTEREST_DURATION_TO" name="interest_duration_to" format="yyyyMMdd" type="1" position="48" end="55"/>        <field nameT="INTEREST_DURATION_TO_NEXT" format="yyyyMMdd" type="1" position="56" end="63"/>        <field nameT="INTEREST_DURATION_NM" name="interest_duration_nm" type="0" position="64" end="75"/>        <field nameT="INTEREST_DATE_CHANGE" name="interest_date_change" format="yyyyMMdd" type="1" position="76" end="83"/>        <field nameT="INTEREST_DURATION_END_VALUTA" name="interest_duration_end_valuta" format="yyyyMMdd" type="1" position="84" end="91"/>        <field nameT="INTEREST_METHOD" name="interest_method" type="0" position="92" end="93"/>        <field nameT="INTEREST_RATE" name="interest_rate" type="0" position="94" end="102"/>        <field nameT="PAY_AGREEMENT_NM" name="pay_agreement_nm" type="0" position="103" end="114"/>      </model>      <model id="L4567502_REA_REC_IN_IMP">        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.L4567502_REA_REC_IN_IMP.ldr"/>        <option id="recordSize" value="71"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="40" end="47"/>        <field nameT="CHARGE_AMOUNT" type="0" position="48" end="70"/>      </model>      <model id="L4567502_REGULAR_FLOATING_LOAN">        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.L4567502_REGULAR_FLOATING_LOAN.ldr"/>        <option id="recordSize" value="286"/>        <sqlStr xml:space="preserve">SELECT a.COD_ACCT_NO                                                  "trs_nr_nm"
       , 'A'                                                          "activev"
       , COD_CC_BRN                                                   "organization_unit_nm"
       , NAM_CCY_SHORT                                                "ext_key_currency"
       , 'FCR_'
	 || COD_CUST_ID                                               "ext_key_address"
       , COD_PROD                                                     "motive_nm"
       , b.dat_start
       , DAT_ACCT_OPEN                                                "capital_duration_frm"
       , Least(DAT_OF_MATURITY, Nvl(DAT_ACCT_CLOSE, DAT_OF_MATURITY)) "capital_duration_to"
       , CASE
	   WHEN b.amt_princ_bal = 0 THEN Round(a.amt_disbursed, 2)
	   ELSE Round(b.amt_princ_bal, 2)
	 END                                                          "capital_nominal"
       , 'F'                                                          "capita_calendar_type_nm"
       , NULL                                                         "non_performing_asset_date"
       , ''                                                           "dealer_nm"
       , ''                                                           "bank_segment_nm"
       , ''                                                           "cost_center_nm"
       , 176                                                          "company"
FROM   fcrlive.ln_acct_mast a
       left join fcrlive.LN_ACCT_SCHEDULE_DETLS b
	      ON a.COD_ACCT_NO = b.COD_ACCT_NO
WHERE  dat_acct_open &lt;= To_date('$POSTINGDATE', 'yyyymmdd')
       AND Least(dat_of_maturity, Nvl(dat_acct_close, dat_of_maturity)) &gt;= To_date('$POSTINGDATE', 'yyyymmdd')
       AND NOT ( COD_ACCT_STAT = 1
		  OR cod_acct_stat = 5 )
       AND b.dat_start = (SELECT Min(dat_start)
			  FROM   fcrlive.LN_ACCT_SCHEDULE_DETLS
			  WHERE  cod_acct_no = a.cod_acct_no)
       AND NOT ( cod_prod = 601
		  OR cod_prod = 602
		  OR cod_prod = 603
		  OR cod_prod = 604
		  OR cod_prod = 605
		  OR cod_prod = 606
		  OR cod_prod = 617
		  OR cod_prod = 618
		  OR cod_prod = 619
		  OR cod_prod = 620
		  OR cod_prod = 621
		  OR cod_prod = 622
		  OR cod_prod = 623
		  OR cod_prod = 624
		  OR cod_prod = 625
		  OR cod_prod = 626 ) 
</sqlStr>        <field nameT="TRS_NR_NM" name="trs_nr_nm" type="0" position="0" end="39"/>        <field nameT="ACTIVEV" name="activev" type="0" position="40" end="40"/>        <field nameT="COMPANY" name="company" type="0" position="41" end="43"/>        <field nameT="EXT_KEY_ADDRESS" name="ext_key_address" type="0" position="44" end="73"/>        <field nameT="MOTIVE_NM" name="motive_nm" type="0" position="74" end="83"/>        <field nameT="EXT_KEY_CURRENCY" name="ext_key_currency" type="0" position="84" end="113"/>        <field nameT="CAPITAL_NOMINAL" name="capital_nominal" type="0" position="114" end="136"/>        <field nameT="CAPITAL_DURATION_FRM" name="capital_duration_frm" format="yyyyMMdd" type="1" position="137" end="144"/>        <field nameT="CAPITAL_DURATION_TO" name="capital_duration_to" format="yyyyMMdd" type="1" position="145" end="152"/>        <field nameT="CAPITAL_CALENDAR_TYPE_NM" name="capita_calendar_type_nm" type="0" position="153" end="164"/>        <field nameT="NON_PERFORMING_ASSET_DATE" name="non_performing_asset_date" format="yyyyMMdd" type="1" position="165" end="172"/>        <field nameT="INITIAL_RESIDUAL_SPREAD" type="0" position="173" end="190"/>        <field nameT="ORGANISATION_UNIT_NM" name="organization_unit_nm" type="0" position="191" end="202"/>        <field nameT="DEALER_NM" name="dealer_nm" type="0" position="203" end="237"/>        <field nameT="BANK_SEGMENT_NM" name="bank_segment_nm" type="0" position="238" end="257"/>        <field nameT="PLACE_OF_CONTRACT_NM" type="0" position="258" end="277"/>        <field nameT="COST_CENTER_NM" name="cost_center_nm" type="0" position="278" end="285"/>      </model>      <model id="L4567502_REGULAR_REPAYMENTS">        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.L4567502_REGULAR_REPAYMENTS.ldr"/>        <option id="recordSize" value="108"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="CAPITAL_CHG_DECREASE" type="0" position="40" end="62"/>        <field nameT="CAPITAL_CHG_DURATION_FRM" format="yyyyMMdd" type="1" position="63" end="70"/>        <field nameT="CAPITAL_CHG_DURATION_TO" format="yyyyMMdd" type="1" position="71" end="78"/>        <field nameT="CAPITAL_CHG_DURATION_TO_NEXT" format="yyyyMMdd" type="1" position="79" end="86"/>        <field nameT="CAPITAL_CHG_DURATION_END" format="yyyyMMdd" type="1" position="87" end="94"/>        <field nameT="CAPITAL_CHG_DURATION_NM" type="0" position="95" end="106"/>        <field nameT="ANNUITY_FLAG" type="0" position="107" end="107"/>      </model>      <model id="L4567502_REG_CHA_STR_LIN">        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.L4567502_REG_CHA_STR_LIN.ldr"/>        <option id="recordSize" value="121"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="CHARGE_TYPE_NM" type="0" position="40" end="51"/>        <field nameT="SALES_TYPE_NM" type="0" position="52" end="61"/>        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="62" end="69"/>        <field nameT="CHARGE_DURATION_TO" format="yyyyMMdd" type="1" position="70" end="77"/>        <field nameT="CHARGE_DURATION_NM" type="0" position="78" end="89"/>        <field nameT="CHARGE_DATE_CHANGE" format="yyyyMMdd" type="1" position="90" end="97"/>        <field nameT="CHARGE_AMOUNT" type="0" position="98" end="120"/>      </model>      <model id="L4567502_SPE_IMP_REC_EXP">        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.L4567502_SPE_IMP_REC_EXP.ldr"/>        <option id="recordSize" value="71"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="VALUTA" format="yyyyMMdd" type="1" position="40" end="47"/>        <field nameT="CAPITAL_CHG_DECREASE" type="0" position="48" end="70"/>      </model>      <model id="L4567502_STA_OF_SPE_IMP">        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.L4567502_STA_OF_SPE_IMP.ldr"/>        <option id="recordSize" value="48"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="VALUTA" format="yyyyMMdd" type="1" position="40" end="47"/>      </model>      <model id="L4567502_UPF_CHA_AMO">        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.L4567502_UPF_CHA_AMO.ldr"/>        <option id="recordSize" value="101"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="CHARGE_TYPE_NM" type="0" position="40" end="51"/>        <field nameT="SALES_TYPE_NM" type="0" position="52" end="61"/>        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="62" end="69"/>        <field nameT="CHARGE_DATE_CHANGE" format="yyyyMMdd" type="1" position="70" end="77"/>        <field nameT="CHARGE_AMOUNT" type="0" position="78" end="100"/>      </model>      <model id="L4567502_WRI_OFF_AFT_IMP">        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.L4567502_WRI_OFF_AFT_IMP.ldr"/>        <option id="recordSize" value="48"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="40" end="47"/>      </model>      <model id="L4567502_YIELD_ENHANCING_FEES">        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.L4567502_YIELD_ENHANCING_FEES.ldr"/>        <option id="recordSize" value="95"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="SALES_TYPE_NM" type="0" position="40" end="49"/>        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="50" end="57"/>        <field nameT="CHARGE_DURATION_TO" format="yyyyMMdd" type="1" position="58" end="65"/>        <field nameT="CHARGE_DURATION_NM" type="0" position="66" end="77"/>        <field nameT="CHARGE_DATE_CHANGE" format="yyyyMMdd" type="1" position="78" end="85"/>        <field nameT="CHARGE_RATE" type="0" position="86" end="94"/>      </model>      <model id="L4567503_ACCOUNTING_CATEGORIES">        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.L4567503_ACCOUNTING_CATEGORIES.ldr"/>        <option id="recordSize" value="52"/>        <sqlStr xml:space="preserve">SELECT COD_ACCT_NO                                                    "trs_nr_nm"
       , 'LAR' "accounting_category_nm"
FROM   fcrlive.ln_acct_mast
WHERE  dat_acct_open &lt;= To_date('$POSTINGDATE', 'yyyymmdd')
       AND Least(dat_of_maturity, Nvl(dat_acct_close, dat_of_maturity)) &gt;= To_date('$POSTINGDATE', 'yyyymmdd')
       AND NOT ( COD_ACCT_STAT = 1 OR cod_acct_stat = 5 )
       AND ( cod_prod = 601
		  OR cod_prod = 602
		  OR cod_prod = 603
		  OR cod_prod = 604
		  OR cod_prod = 605
		  OR cod_prod = 606
		  OR cod_prod = 617
		  OR cod_prod = 618
		  OR cod_prod = 619
		  OR cod_prod = 620
		  OR cod_prod = 621
		  OR cod_prod = 622
		  OR cod_prod = 623
		  OR cod_prod = 624
		  OR cod_prod = 625
		  OR cod_prod = 626 )</sqlStr>
        <field nameT="TRS_NR_NM" name="trs_nr_nm" type="0" position="0" end="39"/>
        <field nameT="ACCOUNTING_CATEGORY_NM" name="accounting_category_nm" type="0" position="40" end="51"/>
      </model>
      <model id="L4567503_ASS_TO_POR_IMP">
        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.L4567503_ASS_TO_POR_IMP.ldr"/>
        <option id="recordSize" value="70"/>
        <sqlStr xml:space="preserve"></sqlStr>
        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>
        <field nameT="PORTFOLIO_NM" type="0" position="40" end="69"/>
      </model>
      <model id="L4567503_ASS_TO_POR_PRE">
        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.L4567503_ASS_TO_POR_PRE.ldr"/>
        <option id="recordSize" value="70"/>
        <sqlStr xml:space="preserve"></sqlStr>
        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>
        <field nameT="PORTFOLIO_NM" type="0" position="40" end="69"/>
      </model>
      <model id="L4567503_CUR_INT_TRA">
        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.L4567503_CUR_INT_TRA.ldr"/>
        <option id="recordSize" value="87"/>
        <sqlStr xml:space="preserve"></sqlStr>
        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>
        <field nameT="INTEREST_DURATION_FRM" format="yyyyMMdd" type="1" position="40" end="47"/>
        <field nameT="INTEREST_DURATION_TO" format="yyyyMMdd" type="1" position="48" end="55"/>
        <field nameT="INTEREST_DURATION_TO_NEXT" format="yyyyMMdd" type="1" position="56" end="63"/>
        <field nameT="INTEREST_DURATION_NM" type="0" position="64" end="75"/>
        <field nameT="INTEREST_METHOD" type="0" position="76" end="77"/>
        <field nameT="INTEREST_RATE" type="0" position="78" end="86"/>
      </model>
      <model id="L4567503_DIR_WRI_OFF_FRA_DET">
        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.L4567503_DIR_WRI_OFF_FRA_DET.ldr"/>
        <option id="recordSize" value="48"/>
        <sqlStr xml:space="preserve"></sqlStr>
        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>
        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="40" end="47"/>
      </model>
      <model id="L4567503_IMPAIRMENT_END">
        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.L4567503_IMPAIRMENT_END.ldr"/>
        <option id="recordSize" value="48"/>
        <sqlStr xml:space="preserve"></sqlStr>
        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>
        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="40" end="47"/>
      </model>
      <model id="L4567503_IRR_CAP_INC">
        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.L4567503_IRR_CAP_INC.ldr"/>
        <option id="recordSize" value="71"/>
        <sqlStr xml:space="preserve">SELECT b.cod_acct_no       "trs_nr_nm"
       , b.amt_dedn_acy	   "capital_chg_increase"
       , b.dat_post		   "valuta"	
FROM   fcrlive.ln_acct_mast a
       inner join fcrlive.LN_DISB_DEDN_DETL b
	       ON a.cod_acct_no = b.cod_acct_no and b.dat_post&gt;a.dat_first_disb
WHERE  dat_acct_open &lt;= To_date('$POSTINGDATE', 'yyyymmdd')
       AND Least(dat_of_maturity, Nvl(dat_acct_close, dat_of_maturity)) &gt;= To_date('$POSTINGDATE', 'yyyymmdd')
       AND NOT ( COD_ACCT_STAT = 1 OR cod_acct_stat = 5 )
       AND ( cod_prod = 601
		  OR cod_prod = 602
		  OR cod_prod = 603
		  OR cod_prod = 604
		  OR cod_prod = 605
		  OR cod_prod = 606
		  OR cod_prod = 617
		  OR cod_prod = 618
		  OR cod_prod = 619
		  OR cod_prod = 620
		  OR cod_prod = 621
		  OR cod_prod = 622
		  OR cod_prod = 623
		  OR cod_prod = 624
		  OR cod_prod = 625
		  OR cod_prod = 626 )</sqlStr>
        <field nameT="TRS_NR_NM" name="trs_nr_nm" type="0" position="0" end="39"/>
        <field nameT="VALUTA" name="valuta" format="yyyyMMdd" type="1" position="40" end="47"/>
        <field nameT="CAPITAL_CHG_INCREASE" name="capital_chg_increase" type="0" position="48" end="70"/>
      </model>
      <model id="L4567503_IRR_REP_CON">
        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.L4567503_IRR_REP_CON.ldr"/>
        <option id="recordSize" value="71"/>
        <sqlStr xml:space="preserve">SELECT a.COD_ACCT_NO "trs_nr_nm"
	   , b.date_instal	"valuta"
       , b.amt_principal "capital_chg_decrease"     
FROM   fcrlive.ln_acct_mast a
	   inner join fcrlive. LN_ACCT_SCHEDULE_DETLS b on a.cod_acct_no=b.cod_acct_no
WHERE  dat_acct_open &lt;= To_date('$POSTINGDATE', 'yyyymmdd')
       AND Least(dat_of_maturity, Nvl(dat_acct_close, dat_of_maturity)) &gt;= To_date('$POSTINGDATE', 'yyyymmdd')
       AND NOT ( COD_ACCT_STAT = 1 OR cod_acct_stat = 5 )
       AND ( cod_prod = 601
		  OR cod_prod = 602
		  OR cod_prod = 603
		  OR cod_prod = 604
		  OR cod_prod = 605
		  OR cod_prod = 606
		  OR cod_prod = 617
		  OR cod_prod = 618
		  OR cod_prod = 619
		  OR cod_prod = 620
		  OR cod_prod = 621
		  OR cod_prod = 622
		  OR cod_prod = 623
		  OR cod_prod = 624
		  OR cod_prod = 625
		  OR cod_prod = 626 )
     and b.amt_principal!=0
UNION ALL
SELECT cod_acct_no
       , dat_value
       , AMT_TXN_TCY
FROM   fcrlive.ln_acct_ledg
       inner join fcrlive.ln_acct_mast USING (COD_ACCT_NO)
WHERE  ( cod_txn_mnemonic = 6532
	  OR cod_txn_mnemonic = 6609
	  OR cod_txn_mnemonic = 6632
	  OR cod_txn_mnemonic = 6719
	  OR cod_txn_mnemonic = 1066
	  OR cod_txn_mnemonic = 1082
	  OR cod_txn_mnemonic = 1404 )
       AND dat_acct_open &lt;= To_date('$POSTINGDATE', 'yyyymmdd')
       AND Least(dat_of_maturity, Nvl(dat_acct_close, dat_of_maturity)) &gt;= To_date('$POSTINGDATE', 'yyyymmdd')
       AND NOT ( COD_ACCT_STAT = 1
		  OR cod_acct_stat = 5 )
       AND ( cod_prod = 601
		  OR cod_prod = 602
		  OR cod_prod = 603
		  OR cod_prod = 604
		  OR cod_prod = 605
		  OR cod_prod = 606
		  OR cod_prod = 617
		  OR cod_prod = 618
		  OR cod_prod = 619
		  OR cod_prod = 620
		  OR cod_prod = 621
		  OR cod_prod = 622
		  OR cod_prod = 623
		  OR cod_prod = 624
		  OR cod_prod = 625
		  OR cod_prod = 626 )
       AND AMT_TXN_TCY != 0
ORDER  BY 1 </sqlStr>
        <field nameT="TRS_NR_NM" name="trs_nr_nm" type="0" position="0" end="39"/>
        <field nameT="VALUTA" name="valuta" format="yyyyMMdd" type="1" position="40" end="47"/>
        <field nameT="CAPITAL_CHG_DECREASE" name="capital_chg_decrease" type="0" position="48" end="70"/>
      </model>
      <model id="L4567503_NOM_AMO_REC_OVE_AFF_A">
        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.L4567503_NOM_AMO_REC_OVE_AFF_A.ldr"/>
        <option id="recordSize" value="71"/>
        <sqlStr xml:space="preserve">select 
cod_acct_no "trs_nr_nm"
, date_instal "valuta"
, ROUND(-amt_princ_bal,2) "period_capital" 
FROM   fcrlive.ln_acct_mast a
	  inner join fcrlive.LN_ACCT_SCHEDULE_DETLS b using (COD_ACCT_NO)
WHERE  dat_acct_open &lt;= To_date('$POSTINGDATE', 'yyyymmdd')
       AND Least(dat_of_maturity, Nvl(dat_acct_close, dat_of_maturity)) &gt;= To_date('$POSTINGDATE', 'yyyymmdd')
       and date_instal&lt;=To_date('$POSTINGDATE', 'yyyymmdd')
       AND NOT ( COD_ACCT_STAT = 1
		  OR cod_acct_stat = 5 )
	   and round(-amt_princ_bal,2)!=0
       AND ( cod_prod = 601
		  OR cod_prod = 602
		  OR cod_prod = 603
		  OR cod_prod = 604
		  OR cod_prod = 605
		  OR cod_prod = 606
		  OR cod_prod = 617
		  OR cod_prod = 618
		  OR cod_prod = 619
		  OR cod_prod = 620
		  OR cod_prod = 621
		  OR cod_prod = 622
		  OR cod_prod = 623
		  OR cod_prod = 624
		  OR cod_prod = 625
		  OR cod_prod = 626 )</sqlStr>
        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>
        <field nameT="VALUTA" format="yyyyMMdd" type="1" position="40" end="47"/>
        <field nameT="PERIOD_CAPITAL" type="0" position="48" end="70"/>
      </model>
      <model id="L4567503_PAST_INTEREST_TRANCHE">
        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.L4567503_PAST_INTEREST_TRANCHE.ldr"/>
        <option id="recordSize" value="115"/>
        <sqlStr xml:space="preserve">SELECT a.COD_ACCT_NO                                                                            "trs_nr_nm"
       , b.CHG_DATE                                                                             "interest_duration_frm"
       , (SELECT Min(DATE_INSTAL)
	  FROM   fcrlive.LN_ACCT_SCHEDULE_DETLS t2
	  WHERE  COD_ACCT_NO = a.COD_ACCT_NO
		 AND CTR_STAGE_NO = c.CTR_STAGE_NO
		 AND DATE_INSTAL &gt; b.CHG_DATE
		 AND DATE_INSTAL &lt;= (SELECT Min(CHG_DATE)
				     FROM   (SELECT COD_ACCT_NO
						    , DAT_STAGE_START chg_date
					     FROM   fcrlive.LN_ACCT_SCHEDULE
					     WHERE  NOT NAM_STAGE = 'PMI'
					     UNION
					     SELECT COD_ACCT_NO
						    , DAT_EFF_INT_INDX
					     FROM   fcrlive.LN_ACCT_RATES
					     UNION
					     SELECT a.COD_ACCT_NO
						    , b.dat_start
					     FROM   fcrlive.LN_ACCT_MAST a
						    left join fcrlive.LN_ACCT_SCHEDULE_DETLS b
							   ON a.COD_ACCT_NO = b.COD_ACCT_NO
					     WHERE  b.dat_start = (SELECT Min(dat_start)
								   FROM   fcrlive.LN_ACCT_SCHEDULE_DETLS
								   WHERE  cod_acct_no = a.cod_acct_no)
					     UNION
					     SELECT COD_ACCT_NO
						    , Least(DAT_OF_MATURITY, Nvl(DAT_ACCT_CLOSE, DAT_OF_MATURITY))
					     FROM   fcrlive.LN_ACCT_MAST) t1
				     WHERE  COD_ACCT_NO = a.COD_ACCT_NO
					    AND t1.CHG_DATE &gt; b.CHG_DATE))                      "interest_duration_to"
       , Nvl((SELECT RAT_INT_SLAB + RAT_ACCT_VAR
	      FROM   fcrlive.LN_ACCT_RATES t2
	      WHERE  COD_ACCT_NO = a.COD_ACCT_NO
		     AND c.COD_INT_RATE = CTR_INT_SRL
		     AND flg_mnt_status != 'U'
		     AND t2.DAT_EFF_INT_INDX = (SELECT Max(DAT_EFF_INT_INDX)
						FROM   fcrlive.LN_ACCT_RATES
						WHERE  COD_ACCT_NO = t2.COD_ACCT_NO
						       AND CTR_INT_SRL = t2.CTR_INT_SRL
						       AND flg_mnt_status != 'U'
						       AND DAT_EFF_INT_INDX &lt;= b.CHG_DATE)), 0) "interest_rate"
       , (SELECT Min(CHG_DATE)
	  FROM   (SELECT COD_ACCT_NO
			 , DAT_STAGE_START chg_date
		  FROM   fcrlive.LN_ACCT_SCHEDULE
		  WHERE  NOT NAM_STAGE = 'PMI'
		  UNION
		  SELECT COD_ACCT_NO
			 , DAT_EFF_INT_INDX
		  FROM   fcrlive.LN_ACCT_RATES
		  UNION
		  SELECT a.COD_ACCT_NO
			 , b.dat_start
		  FROM   fcrlive.LN_ACCT_MAST a
			 left join fcrlive.LN_ACCT_SCHEDULE_DETLS b
				ON a.COD_ACCT_NO = b.COD_ACCT_NO
		  WHERE  b.dat_start = (SELECT Min(dat_start)
					FROM   fcrlive.LN_ACCT_SCHEDULE_DETLS
					WHERE  cod_acct_no = a.cod_acct_no)
		  UNION
		  SELECT COD_ACCT_NO
			 , Least(DAT_OF_MATURITY, Nvl(DAT_ACCT_CLOSE, DAT_OF_MATURITY))
		  FROM   fcrlive.LN_ACCT_MAST) t1
	  WHERE  COD_ACCT_NO = a.COD_ACCT_NO
		 AND t1.CHG_DATE &gt; b.CHG_DATE)                                                  "interest_date_change"
       , (SELECT Min(DATE_INSTAL)
	  FROM   fcrlive.LN_ACCT_SCHEDULE_DETLS
	  WHERE  COD_ACCT_NO = a.COD_ACCT_NO
		 AND DATE_INSTAL &gt;= (SELECT Min(CHG_DATE)
				     FROM   (SELECT COD_ACCT_NO
						    , DAT_STAGE_START chg_date
					     FROM   fcrlive.LN_ACCT_SCHEDULE
					     WHERE  NOT NAM_STAGE = 'PMI'
					     UNION
					     SELECT COD_ACCT_NO
						    , DAT_EFF_INT_INDX
					     FROM   fcrlive.LN_ACCT_RATES
					     UNION
					     SELECT a.COD_ACCT_NO
						    , b.dat_start
					     FROM   fcrlive.LN_ACCT_MAST a
						    left join fcrlive.LN_ACCT_SCHEDULE_DETLS b
							   ON a.COD_ACCT_NO = b.COD_ACCT_NO
					     WHERE  b.dat_start = (SELECT Min(dat_start)
								   FROM   fcrlive.LN_ACCT_SCHEDULE_DETLS
								   WHERE  cod_acct_no = a.cod_acct_no)
					     UNION
					     SELECT COD_ACCT_NO
						    , Least(DAT_OF_MATURITY, Nvl(DAT_ACCT_CLOSE, DAT_OF_MATURITY))
					     FROM   fcrlive.LN_ACCT_MAST) t1
				     WHERE  COD_ACCT_NO = a.COD_ACCT_NO
					    AND t1.CHG_DATE &gt; b.CHG_DATE))
	 "interest_duration_end_valuta"
       , 31                                                                                     "interest_method"
       , CASE
	   WHEN c.COD_SCHED_TYPE IN ( 21, 22, 23, 24,
				      51, 52, 53, 54,
				      59, 63, 65, 614 ) THEN '1MU'
	   WHEN c.COD_SCHED_TYPE IN ( 60, 61, 66 ) THEN '3MU'
	   WHEN c.COD_SCHED_TYPE IN ( 62, 64 ) THEN '6MU'
	   WHEN c.COD_SCHED_TYPE IS NULL THEN NULL
	   ELSE c.COD_SCHED_TYPE
		|| '!'
	 END                                                                                    "interest_duration_nm"
       , CASE
	   WHEN c.COD_SCHED_TYPE IN ( 59, 60, 61, 62 ) THEN 'ARRCAPINT'
	   ELSE 'ARREARS'
	 END                                                                                    "pay_agreement_nm"
FROM   fcrlive.LN_ACCT_MAST a
       inner join (SELECT COD_ACCT_NO
			  , DAT_STAGE_START chg_date
		   FROM   fcrlive.LN_ACCT_SCHEDULE
		   WHERE  NOT NAM_STAGE = 'PMI'
		   UNION
		   SELECT COD_ACCT_NO
			  , DAT_EFF_INT_INDX
		   FROM   fcrlive.LN_ACCT_RATES
		   UNION
		   SELECT a.COD_ACCT_NO
			  , b.dat_start
		   FROM   fcrlive.LN_ACCT_MAST a
			  left join fcrlive.LN_ACCT_SCHEDULE_DETLS b
				 ON a.COD_ACCT_NO = b.COD_ACCT_NO
		   WHERE  b.dat_start = (SELECT Min(dat_start)
					 FROM   fcrlive.LN_ACCT_SCHEDULE_DETLS
					 WHERE  cod_acct_no = a.cod_acct_no)) b
	       ON a.COD_ACCT_NO = b.COD_ACCT_NO
		  AND Least(a.DAT_ACCT_OPEN, Nvl(a.DAT_FIRST_DISB, a.DAT_ACCT_OPEN)) &lt;= b.CHG_DATE
		  AND Least(DAT_OF_MATURITY, Nvl(DAT_ACCT_CLOSE, DAT_OF_MATURITY)) &gt;= b.CHG_DATE
       left join fcrlive.LN_ACCT_SCHEDULE c
	      ON a.COD_ACCT_NO = c.COD_ACCT_NO
		 AND c.DAT_STAGE_START &lt;= b.CHG_DATE
		 AND c.DAT_STAGE_END &gt; b.CHG_DATE
WHERE  dat_acct_open &lt;= To_date('$POSTINGDATE', 'yyyymmdd')
       AND Least(dat_of_maturity, Nvl(dat_acct_close, dat_of_maturity)) &gt;= To_date('$POSTINGDATE', 'yyyymmdd')
       AND NOT ( COD_ACCT_STAT = 1
		  OR cod_acct_stat = 5 )
       AND NOT c.NAM_STAGE = 'PMI'
       AND NOT ( c.dat_stage_start &gt;= Least(DAT_OF_MATURITY, Nvl(DAT_ACCT_CLOSE, DAT_OF_MATURITY)) )
       AND ( cod_prod = 601
		  OR cod_prod = 602
		  OR cod_prod = 603
		  OR cod_prod = 604
		  OR cod_prod = 605
		  OR cod_prod = 606
		  OR cod_prod = 617
		  OR cod_prod = 618
		  OR cod_prod = 619
		  OR cod_prod = 620
		  OR cod_prod = 621
		  OR cod_prod = 622
		  OR cod_prod = 623
		  OR cod_prod = 624
		  OR cod_prod = 625
		  OR cod_prod = 626 ) </sqlStr>
        <field nameT="TRS_NR_NM" name="trs_nr_nm" type="0" position="0" end="39"/>
        <field nameT="INTEREST_DURATION_FRM" name="interest_duration_frm" format="yyyyMMdd" type="1" position="40" end="47"/>
        <field nameT="INTEREST_DURATION_TO" name="interest_duration_to" format="yyyyMMdd" type="1" position="48" end="55"/>
        <field nameT="INTEREST_DURATION_TO_NEXT" format="yyyyMMdd" type="1" position="56" end="63"/>
        <field nameT="INTEREST_DURATION_NM" name="interest_duration_nm" type="0" position="64" end="75"/>
        <field nameT="INTEREST_DATE_CHANGE" name="interest_date_change" format="yyyyMMdd" type="1" position="76" end="83"/>
        <field nameT="INTEREST_DURATION_END_VALUTA" name="interest_duration_end_valuta" format="yyyyMMdd" type="1" position="84" end="91"/>
        <field nameT="INTEREST_METHOD" name="interest_method" type="0" position="92" end="93"/>
        <field nameT="INTEREST_RATE" name="interest_rate" type="0" position="94" end="102"/>
        <field nameT="PAY_AGREEMENT_NM" name="pay_agreement_nm" type="0" position="103" end="114"/>
      </model>
      <model id="L4567503_REA_REC_IN_IMP">
        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.L4567503_REA_REC_IN_IMP.ldr"/>
        <option id="recordSize" value="71"/>
        <sqlStr xml:space="preserve"></sqlStr>
        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>
        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="40" end="47"/>
        <field nameT="CHARGE_AMOUNT" type="0" position="48" end="70"/>
      </model>
      <model id="L4567503_REGULAR_REPAYMENTS">
        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.L4567503_REGULAR_REPAYMENTS.ldr"/>
        <option id="recordSize" value="108"/>
        <sqlStr xml:space="preserve"></sqlStr>
        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>
        <field nameT="CAPITAL_CHG_DECREASE" type="0" position="40" end="62"/>
        <field nameT="CAPITAL_CHG_DURATION_FRM" format="yyyyMMdd" type="1" position="63" end="70"/>
        <field nameT="CAPITAL_CHG_DURATION_TO" format="yyyyMMdd" type="1" position="71" end="78"/>
        <field nameT="CAPITAL_CHG_DURATION_TO_NEXT" format="yyyyMMdd" type="1" position="79" end="86"/>
        <field nameT="CAPITAL_CHG_DURATION_END" format="yyyyMMdd" type="1" position="87" end="94"/>
        <field nameT="CAPITAL_CHG_DURATION_NM" type="0" position="95" end="106"/>
        <field nameT="ANNUITY_FLAG" type="0" position="107" end="107"/>
      </model>
      <model id="L4567503_REGULAR_STAFF_LOAN">
        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.L4567503_REGULAR_STAFF_LOAN.ldr"/>
        <option id="recordSize" value="295"/>
        <sqlStr xml:space="preserve">SELECT a.COD_ACCT_NO                                                  "trs_nr_nm"
       , 'A'                                                          "activev"
       , COD_CC_BRN                                                   "organization_unit_nm"
       , NAM_CCY_SHORT                                                "ext_key_currency"
       , 'FCR_'
	 || COD_CUST_ID                                               "ext_key_address"
       , COD_PROD                                                     "motive_nm"
       , b.dat_start
       , DAT_ACCT_OPEN                                                "capital_duration_frm"
       , Least(DAT_OF_MATURITY, Nvl(DAT_ACCT_CLOSE, DAT_OF_MATURITY)) "capital_duration_to"
       , CASE
	   WHEN b.amt_princ_bal = 0 THEN Round(a.amt_disbursed, 2)
	   ELSE Round(b.amt_princ_bal, 2)
	 END                                                          "capital_nominal"
       , 'F'                                                          "capita_calendar_type_nm"
       , NULL                                                         "non_performing_asset_date"
       , ''                                                           "dealer_nm"
       , ''                                                           "bank_segment_nm"
       , ''                                                           "cost_center_nm"
       , 176                                                          "company"
       , 23                                                           "yield"
FROM   fcrlive.ln_acct_mast a
       left join fcrlive.LN_ACCT_SCHEDULE_DETLS b
	      ON a.COD_ACCT_NO = b.COD_ACCT_NO
WHERE  dat_acct_open &lt;= To_date('$POSTINGDATE', 'yyyymmdd')
       AND Least(dat_of_maturity, Nvl(dat_acct_close, dat_of_maturity)) &gt;= To_date('$POSTINGDATE', 'yyyymmdd')
       AND NOT ( COD_ACCT_STAT = 1
		  OR cod_acct_stat = 5 )
       AND b.dat_start = (SELECT Min(dat_start)
			  FROM   fcrlive.LN_ACCT_SCHEDULE_DETLS
			  WHERE  cod_acct_no = a.cod_acct_no)
       AND ( cod_prod = 601
	      OR cod_prod = 602
	      OR cod_prod = 603
	      OR cod_prod = 604
	      OR cod_prod = 605
	      OR cod_prod = 606
	      OR cod_prod = 617
	      OR cod_prod = 618
	      OR cod_prod = 619
	      OR cod_prod = 620
	      OR cod_prod = 621
	      OR cod_prod = 622
	      OR cod_prod = 623
	      OR cod_prod = 624
	      OR cod_prod = 625
	      OR cod_prod = 626 ) 
</sqlStr>        <field nameT="TRS_NR_NM" name="trs_nr_nm" type="0" position="0" end="39"/>        <field nameT="ACTIVEV" name="activev" type="0" position="40" end="40"/>        <field nameT="COMPANY" name="company" type="0" position="41" end="43"/>        <field nameT="EXT_KEY_ADDRESS" name="ext_key_address" type="0" position="44" end="73"/>        <field nameT="MOTIVE_NM" name="motive_nm" type="0" position="74" end="83"/>        <field nameT="EXT_KEY_CURRENCY" name="ext_key_currency" type="0" position="84" end="113"/>        <field nameT="CAPITAL_NOMINAL" name="capital_nominal" type="0" position="114" end="136"/>        <field nameT="CAPITAL_DURATION_FRM" name="capital_duration_frm" format="yyyyMMdd" type="1" position="137" end="144"/>        <field nameT="CAPITAL_DURATION_TO" name="capital_duration_to" format="yyyyMMdd" type="1" position="145" end="152"/>        <field nameT="CAPITAL_CALENDAR_TYPE_NM" name="capita_calendar_type_nm" type="0" position="153" end="164"/>        <field nameT="NON_PERFORMING_ASSET_DATE" name="non_performing_asset_date" format="yyyyMMdd" type="1" position="165" end="172"/>        <field nameT="YIELD" name="yield" type="0" position="173" end="181"/>        <field nameT="INITIAL_RESIDUAL_SPREAD" type="0" position="182" end="199"/>        <field nameT="ORGANISATION_UNIT_NM" name="organization_unit_nm" type="0" position="200" end="211"/>        <field nameT="DEALER_NM" name="dealer_nm" type="0" position="212" end="246"/>        <field nameT="BANK_SEGMENT_NM" name="bank_segment_nm" type="0" position="247" end="266"/>        <field nameT="PLACE_OF_CONTRACT_NM" type="0" position="267" end="286"/>        <field nameT="COST_CENTER_NM" name="cost_center_nm" type="0" position="287" end="294"/>      </model>      <model id="L4567503_REG_CHA_STR_LIN">        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.L4567503_REG_CHA_STR_LIN.ldr"/>        <option id="recordSize" value="121"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="CHARGE_TYPE_NM" type="0" position="40" end="51"/>        <field nameT="SALES_TYPE_NM" type="0" position="52" end="61"/>        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="62" end="69"/>        <field nameT="CHARGE_DURATION_TO" format="yyyyMMdd" type="1" position="70" end="77"/>        <field nameT="CHARGE_DURATION_NM" type="0" position="78" end="89"/>        <field nameT="CHARGE_DATE_CHANGE" format="yyyyMMdd" type="1" position="90" end="97"/>        <field nameT="CHARGE_AMOUNT" type="0" position="98" end="120"/>      </model>      <model id="L4567503_SPE_IMP_REC_EXP">        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.L4567503_SPE_IMP_REC_EXP.ldr"/>        <option id="recordSize" value="71"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="VALUTA" format="yyyyMMdd" type="1" position="40" end="47"/>        <field nameT="CAPITAL_CHG_DECREASE" type="0" position="48" end="70"/>      </model>      <model id="L4567503_STA_OF_SPE_IMP">        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.L4567503_STA_OF_SPE_IMP.ldr"/>        <option id="recordSize" value="48"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="VALUTA" format="yyyyMMdd" type="1" position="40" end="47"/>      </model>      <model id="L4567503_UPF_CHA_AMO">        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.L4567503_UPF_CHA_AMO.ldr"/>        <option id="recordSize" value="101"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="CHARGE_TYPE_NM" type="0" position="40" end="51"/>        <field nameT="SALES_TYPE_NM" type="0" position="52" end="61"/>        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="62" end="69"/>        <field nameT="CHARGE_DATE_CHANGE" format="yyyyMMdd" type="1" position="70" end="77"/>        <field nameT="CHARGE_AMOUNT" type="0" position="78" end="100"/>      </model>      <model id="L4567503_WRI_OFF_AFT_IMP">        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.L4567503_WRI_OFF_AFT_IMP.ldr"/>        <option id="recordSize" value="48"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="40" end="47"/>      </model>      <model id="L4567503_YIELD_ENHANCING_FEES">        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.L4567503_YIELD_ENHANCING_FEES.ldr"/>        <option id="recordSize" value="95"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>        <field nameT="SALES_TYPE_NM" type="0" position="40" end="49"/>        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="50" end="57"/>        <field nameT="CHARGE_DURATION_TO" format="yyyyMMdd" type="1" position="58" end="65"/>        <field nameT="CHARGE_DURATION_NM" type="0" position="66" end="77"/>        <field nameT="CHARGE_DATE_CHANGE" format="yyyyMMdd" type="1" position="78" end="85"/>        <field nameT="CHARGE_RATE" type="0" position="86" end="94"/>      </model>    </group>    <group id="saving">      <option id="active" value="0"/>      <model id="S4569401_ACCOUNTING_CATEGORIES">        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.S4569401_ACCOUNTING_CATEGORIES.ldr"/>        <option id="recordSize" value="52"/>        <sqlStr xml:space="preserve">SELECT Trim(t1.COD_ACCT_NO)
	 || '_'
	 || Trim(t1.COD_DEP_NO)         "trs_nr_nm"
       , 'OL' "accounting_category_nm"
FROM   fcrlive.TD_DEP_MAST t1
       inner join fcrlive.TD_DEPOSIT_DETAILS t2
	       ON t1.COD_ACCT_NO = t2.COD_ACCT_NO
		  AND t1.COD_DEP_NO = t2.cod_dep_no
		  AND t2.bal_principal &gt; 0
where
	t1.DAT_DEP_DATE &lt;= to_date('$POSTINGDATE','YYYYMMDD')
	and t1.DAT_MATURITY&gt;= to_date('$POSTINGDATE','YYYYMMDD')
	AND NOT ( COD_DEP_STAT = 1
				     OR cod_dep_stat = 5 )</sqlStr>
        <field nameT="TRS_NR_NM" name="trs_nr_nm" type="0" position="0" end="39"/>
        <field nameT="ACCOUNTING_CATEGORY_NM" name="accounting_category_nm" type="0" position="40" end="51"/>
      </model>
      <model id="S4569401_CUR_INT_TRA_CAP">
        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.S4569401_CUR_INT_TRA_CAP.ldr"/>
        <option id="recordSize" value="79"/>
        <sqlStr xml:space="preserve">SELECT Trim(t1.COD_ACCT_NO)
       || '_'
       || Trim(t1.COD_DEP_NO) "trs_nr_nm"
       , t1.DAT_DEP_DATE      "interest_duration_frm"
       , t1.DAT_MATURITY      "interest_duration_to"
       , 10                   "interest_method"
       , t2.rat_dep_int+t2.rat_dep_int_var+t2.rat_prod_var 
		  "interest_rate"
FROM   fcrlive.TD_DEP_MAST t1
       inner join fcrlive.TD_DEPOSIT_DETAILS t2
	       ON t1.COD_ACCT_NO = t2.COD_ACCT_NO
		  AND t1.COD_DEP_NO = t2.cod_dep_no
		  AND t2.bal_principal &gt; 0
WHERE  t1.DAT_DEP_DATE &lt;= To_date('$POSTINGDATE', 'YYYYMMDD')
       AND t1.DAT_MATURITY &gt;= To_date('$POSTINGDATE', 'YYYYMMDD') 
       AND NOT ( COD_DEP_STAT = 1
				     OR cod_dep_stat = 5 )</sqlStr>
        <field nameT="TRS_NR_NM" name="trs_nr_nm" type="0" position="0" end="39"/>
        <field nameT="INTEREST_DURATION_FRM" name="interest_duration_frm" format="yyyyMMdd" type="1" position="40" end="47"/>
        <field nameT="INTEREST_DURATION_TO" name="interest_duration_to" format="yyyyMMdd" type="1" position="48" end="55"/>
        <field nameT="INTEREST_DURATION_NM" name="interest_duration_frm" type="0" position="56" end="67"/>
        <field nameT="INTEREST_METHOD" name="interest_method" type="0" position="68" end="69"/>
        <field nameT="INTEREST_RATE" name="interest_rate" type="0" position="70" end="78"/>
      </model>
      <model id="S4569401_IRR_CAP_CHA">
        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.S4569401_IRR_CAP_CHA.ldr"/>
        <option id="recordSize" value="94"/>
        <sqlStr xml:space="preserve"></sqlStr>
        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>
        <field nameT="VALUTA" format="yyyyMMdd" type="1" position="40" end="47"/>
        <field nameT="CAPITAL_CHG_INCREASE" type="0" position="48" end="70"/>
        <field nameT="CAPITAL_CHG_DECREASE" type="0" position="71" end="93"/>
      </model>
      <model id="S4569401_NOM_AMO_REC">
        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.S4569401_NOM_AMO_REC.ldr"/>
        <option id="recordSize" value="71"/>
        <sqlStr xml:space="preserve"></sqlStr>
        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>
        <field nameT="VALUTA" format="yyyyMMdd" type="1" position="40" end="47"/>
        <field nameT="PERIOD_CAPITAL" type="0" position="48" end="70"/>
      </model>
      <model id="S4569401_ONE_TIM_FEE_DIR_IN_PL">
        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.S4569401_ONE_TIM_FEE_DIR_IN_PL.ldr"/>
        <option id="recordSize" value="93"/>
        <sqlStr xml:space="preserve"></sqlStr>
        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>
        <field nameT="CHARGE_TYPE_NM" type="0" position="40" end="51"/>
        <field nameT="SALES_TYPE_NM" type="0" position="52" end="61"/>
        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="62" end="69"/>
        <field nameT="CHARGE_AMOUNT" type="0" position="70" end="92"/>
      </model>
      <model id="S4569401_PAS_INT_TRA_CAP">
        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.S4569401_PAS_INT_TRA_CAP.ldr"/>
        <option id="recordSize" value="95"/>
        <sqlStr xml:space="preserve"></sqlStr>
        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>
        <field nameT="INTEREST_DURATION_FRM" format="yyyyMMdd" type="1" position="40" end="47"/>
        <field nameT="INTEREST_DURATION_TO" format="yyyyMMdd" type="1" position="48" end="55"/>
        <field nameT="INTEREST_DURATION_NM" type="0" position="56" end="67"/>
        <field nameT="INTEREST_DATE_CHANGE" format="yyyyMMdd" type="1" position="68" end="75"/>
        <field nameT="INTEREST_DURATION_END_VALUTA" format="yyyyMMdd" type="1" position="76" end="83"/>
        <field nameT="INTEREST_METHOD" type="0" position="84" end="85"/>
        <field nameT="INTEREST_RATE" type="0" position="86" end="94"/>
      </model>
      <model id="S4569401_PREMIUM_OR_DISCOUNT">
        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.S4569401_PREMIUM_OR_DISCOUNT.ldr"/>
        <option id="recordSize" value="91"/>
        <sqlStr xml:space="preserve"></sqlStr>
        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>
        <field nameT="CHARGE_TYPE_NM" type="0" position="40" end="51"/>
        <field nameT="CHARGE_DURATION_FRM" format="yyyyMMdd" type="1" position="52" end="59"/>
        <field nameT="CHARGE_DATE_CHANGE" format="yyyyMMdd" type="1" position="60" end="67"/>
        <field nameT="CHARGE_AMOUNT" type="0" position="68" end="90"/>
      </model>
      <model id="S4569401_SAVING_DEAL">
        <option id="program" value="file:/usr/backup/manticore-ETLTools/etl/ldr/FSETL.S4569401_SAVING_DEAL.ldr"/>
        <option id="recordSize" value="240"/>
        <sqlStr xml:space="preserve">SELECT t1.COD_CC_BRN                    "organisation_unit_nm"
       , t1.COD_PROD                    "motive_nm"
       , Trim(t1.COD_ACCT_NO)
	 || '_'
	 || Trim(t1.COD_DEP_NO)         "trs_nr_nm"
       , Decode(t1.COD_CCY, 100, 'NGN',
			    t1.COD_CCY) "ext_key_currency"
       , 'A'                            "activev"
       , 'FCR_'
	 || t1.COD_CUST                 "ext_key_address"
       , t1.DAT_DEP_DATE                "capital_duration_frm"
       , t1.DAT_VALUE_DATE
       , t1.COD_DEP_STAT
       , t1.CTR_DEP_TERM
       , t1.DAT_MATURITY                "capital_duration_to"
       , t1.FRQ_INT_PAY
       , t1.FRQ_INT_COMPOUND
       , t1.COD_INT_START_DATE
       , t2.BAL_PRINCIPAL               "capital_nominal"
       , t2.RAT_DEP_INT
       , t2.RAT_DEP_INT_VAR
       , NULL                           "dealer_nm"
       , NULL                           "bank_segment_nm"
       , NULL                           "cost_center_nm"
       , 'F'                            "capital_calendar_type_nm"
       , 176                            "company"
FROM   fcrlive.TD_DEP_MAST t1
       inner join fcrlive.TD_DEPOSIT_DETAILS t2
	       ON t1.COD_ACCT_NO = t2.COD_ACCT_NO
		  AND t1.COD_DEP_NO = t2.cod_dep_no
		  AND t2.bal_principal &gt; 0
WHERE  t1.DAT_DEP_DATE &lt;= To_date('$POSTINGDATE', 'YYYYMMDD')
       AND t1.DAT_MATURITY &gt;= To_date('$POSTINGDATE', 'YYYYMMDD')
       AND NOT ( COD_DEP_STAT = 1
		  OR cod_dep_stat = 5 ) 
</sqlStr>        <field nameT="TRS_NR_NM" name="trs_nr_nm" type="0" position="0" end="39"/>        <field nameT="ACTIVEV" name="activev" type="0" position="40" end="40"/>        <field nameT="COMPANY" name="company" type="0" position="41" end="43"/>        <field nameT="EXT_KEY_ADDRESS" name="ext_key_address" type="0" position="44" end="73"/>        <field nameT="MOTIVE_NM" name="motive_nm" type="0" position="74" end="83"/>        <field nameT="EXT_KEY_CURRENCY" name="ext_key_currency" type="0" position="84" end="113"/>        <field nameT="CAPITAL_NOMINAL" name="capital_nominal" type="0" position="114" end="136"/>        <field nameT="CAPITAL_DURATION_FRM" name="capital_duration_frm" format="yyyyMMdd" type="1" position="137" end="144"/>        <field nameT="CAPITAL_DURATION_TO" name="capital_duration_to" format="yyyyMMdd" type="1" position="145" end="152"/>        <field nameT="CAPITAL_CALENDAR_TYPE_NM" name="capital_calendar_type_nm" type="0" position="153" end="164"/>        <field nameT="ORGANISATION_UNIT_NM" name="organisation_unit_nm" type="0" position="165" end="176"/>        <field nameT="DEALER_NM" name="dealer_nm" type="0" position="177" end="211"/>        <field nameT="BANK_SEGMENT_NM" name="bank_segment_nm" type="0" position="212" end="231"/>        <field nameT="COST_CENTER_NM" name="cost_center_nm" type="0" position="232" end="239"/>      </model>    </group>    <script id="90_push">      <content xml:space="preserve">logger.info("append ASCII files from $destinationPath files to tables in FSETL");
com.manticore.etl.FlatFileLoader.push(ldrPath, destinationPath, Integer.valueOf(THREADS), true, logger);</content>
      <option id="active" value="1"/>
      <option id="language" value="groovy"/>
      <option id="phase" value="transfer"/>
    </script>
    <option id="dependancies" value="init"/>
  </process>
  <process id="flexcube_securities">
    <option id="destinationPath" value="/usr/backup/manticore-ETLTools/data/flexcube_securities/"/>
    <option id="ldrPath" value="/usr/backup/manticore-ETLTools/etl/ldr/"/>
    <option id="compress" value="0"/>
    <option id="concat" value="1"/>
    <option id="connection" value="FlexCube Corporate Live"/>
    <option id="targetConnection" value="FxF FSETL"/>
    <script id="90_push">
      <content xml:space="preserve">
logger.info("append ASCII files from $destinationPath files to tables in FSETL using $ldrPath");
com.manticore.etl.FlatFileLoader.push("firsdb", ldrPath, destinationPath, Integer.valueOf(THREADS), true, logger);
			</content>
      <option id="active" value="1"/>
      <option id="language" value="groovy"/>
      <option id="phase" value="transfer"/>
    </script>
    <group id="bonds_and_TBills">
      <option id="active" value="1"/>
      <model id="BO01XXXX_BOND_POSITION">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.BO01XXXX_BOND_POSITION.ldr"/>
        <option id="recordSize" value="217"/>
        <sqlStr xml:space="preserve">select  distinct b.fbo_id_num || 
CASE
	WHEN c.name = 'BNDCBN' THEN '_HTM'
	WHEN c.name = 'BNDTBK' THEN '_HFT'
	WHEN c.name = 'BNDAFS' THEN '_AFS'
END               					"pos_bank_trs_nm"
, To_Char(b.fbo_id_num)				"ext_key_security"
, b.issue_ccy						"ext_key_currency"
,CASE
	WHEN c.name = 'BNDCBN' THEN 'HTM'
	WHEN c.name = 'BNDTBK' THEN 'HFT'
	WHEN c.name = 'BNDAFS' THEN 'AFS'
END 								"accounting_category_Nm"
, NULL								"motive_nm"
, NULL								"organistaion_unit_nm"
, NULL								"dealer_nm"
, NULL								"bank_segment_nm"
, NULL								"place_of_contract_nm"
, NULL								"cost_center_nm"
from obnlive.tt_sec_bs a, obnlive.sd_sec_defn b, 
obnlive.sd_subtype c,  obnlive.SD_CPTY d, obnlive.sd_sec_defn_cf_sides e
WHERE a.sec_defn_fbo_id_num = b.fbo_id_num
AND a.subtype_fbo_id_num = c.fbo_id_num
AND b.issuer_fbo_id_num = d.fbo_id_num
AND b.fbo_id_num = e.fbo_id_num
AND type = 'BOND' AND c.name IN ('BNDCBN', 'BNDTBK', 'BNDAFS')
AND d.cpty_status = 'OK'
AND d.fbo_id_num &lt;&gt; 0
AND d.cpty_type IS NOT NULL
AND e.cash_flow_side_type = 'FIXED'
AND b.maturity_date &gt;= To_date('$POSTINGDATE', 'yyyymmdd')

UNION

SELECT 	'TBILL_' || a.sec_defn_fbo_id_num || 
		CASE
			WHEN d.name = 'TBLCBN' THEN '_HTM'
			WHEN d.name = 'TBLTBK' THEN '_HFT'
			WHEN d.name = 'TBLAFS' THEN '_AFS'
		END               						"pos_bank_trs_nm"
		,'TBILL_' || a.sec_defn_fbo_id_num            "ext_Key_Security"
       	, a.settlement_ccy                            "ext_Key_Currency_Issue" 
       	,CASE
			WHEN d.name = 'TBLCBN' THEN 'HTM'
			WHEN d.name = 'TBLTBK' THEN 'HFT'
			WHEN d.name = 'TBLAFS' THEN 'AFS'
		END 									"accounting_category_Nm"
		, NULL								"motive_nm"
		, NULL								"organistaion_unit_nm"
		, NULL								"dealer_nm"
		, NULL								"bank_segment_nm"
		, NULL								"place_of_contract_nm"
		, NULL								"cost_center_nm"
FROM   (SELECT Row_number () 
                 OVER ( 
                   partition BY sec_defn_fbo_id_num, buy_or_sell 
                   ORDER BY sec_defn_fbo_id_num, settlement_date ASC ) AS RN, 
               sec_defn_fbo_id_num,
               subtype_fbo_id_num, 
               buy_or_sell, 
               settlement_date, 
               settlement_ccy, 
               Sum(qty_traded)                                         AS 
               QTY_TRADED 
        FROM   obnlive.tt_sec_bs b 
        WHERE  b.deal_state NOT IN ( 'DLTD', 'RVSD' ) 
        GROUP  BY sec_defn_fbo_id_num, 
        		   subtype_fbo_id_num,
                  settlement_date, 
                  buy_or_sell, 
                  settlement_ccy 
        ORDER  BY rn) a, 
       obnlive.sd_sec_defn b, obnlive.SD_CPTY c, obnlive.sd_subtype d
WHERE  b.type = 'TBILL' AND d.name IN ('TBLCBN', 'TBLTBK', 'TBLAFS') 
       AND a.sec_defn_fbo_id_num = b.fbo_id_num 
       AND b.issuer_fbo_id_num = c.fbo_id_num 
       AND a.subtype_fbo_id_num = d.fbo_id_num
       AND a.rn = 1 
       AND a.buy_or_sell = 'B' 
 	   AND c.cpty_status = 'OK'
	   AND c.fbo_id_num &lt;&gt; 0
	   AND c.cpty_type IS NOT NULL
       AND a.settlement_date &lt;= To_date('$POSTINGDATE', 'yyyymmdd')
       AND (b.maturity_date &gt;= To_date('$POSTINGDATE', 'yyyymmdd') OR b.maturity_date IS NULL) </sqlStr>
        <field nameT="POS_BANK_TRS_NR_NM" name="pos_bank_trs_nm" type="0" position="0" end="39"/>
        <field nameT="EXT_KEY_SECURITY" name="ext_key_security" type="0" position="40" end="69"/>
        <field nameT="EXT_KEY_CURRENCY" name="ext_key_currency" type="0" position="70" end="99"/>
        <field nameT="ACCOUNTING_CATEGORY_NM" name="accounting_category_Nm" type="0" position="100" end="111"/>
        <field nameT="MOTIVE_NM" name="motive_nm" type="0" position="112" end="121"/>
        <field nameT="ORGANISATION_UNIT_NM" name="organistaion_unit_nm" type="0" position="122" end="133"/>
        <field nameT="DEALER_NM" name="dealer_nm" type="0" position="134" end="168"/>
        <field nameT="BANK_SEGMENT_NM" name="bank_segment_nm" type="0" position="169" end="188"/>
        <field nameT="PLACE_OF_CONTRACT_NM" name="place_of_contract_nm" type="0" position="189" end="208"/>
        <field nameT="COST_CENTER_NM" name="cost_center_nm" type="0" position="209" end="216"/>
      </model>
      <model id="BO01XXXX_BOND_STATIC_DATA">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.BO01XXXX_BOND_STATIC_DATA.ldr"/>
        <option id="recordSize" value="228"/>
        <sqlStr xml:space="preserve">Select 
	'BOND_' || a.fbo_id_num				"ext_Key_Security"
	, a.description						"security_Nm_Dc"
	, to_char(a.issuer_fbo_id_num)		"ext_key_address_issuer"
	, a.issue_date						"issue_Date"
	, NULL 								"place_of_issue_nm"
	, a.issue_ccy						"ext_Key_Currency_Issue"
	, NULL								"sec_flag_1_value"
	, NULL								"sec_flag_2_value"
	, NULL								"maturity_rate"
	, a.trantime						"capital_Duration_Frm"
	, a.maturity_date					"capital_Duration_To"
	,'F'								"capitalCalendarTypeNm"
	, substr(b.cash_flow_side_type,1,3)	"sec_Bond_Type_Nm"
from obnlive.sd_sec_defn a
INNER JOIN obnlive.sd_sec_defn_cf_sides b ON a.fbo_id_num = b.fbo_id_num
INNER JOIN obnlive.SD_CPTY c on a.issuer_fbo_id_num = c.fbo_id_num
WHERE b.cash_flow_side_type = 'FIXED'
AND type = 'BOND'
AND c.cpty_status = 'OK'
AND c.fbo_id_num &lt;&gt; 0
AND c.cpty_type IS NOT NULL
AND a.maturity_date &gt;= To_date('$POSTINGDATE', 'yyyymmdd')
AND a.trantime &lt;= To_date('$POSTINGDATE', 'yyyymmdd')
--order by 1,4,5

UNION 

SELECT 'TBILL_' || a.sec_defn_fbo_id_num            "ext_Key_Security"
	  	, NULL								   		"security_Nm_Dc"
       	, to_char(b.issuer_fbo_id_num)              "ext_key_address_issuer"
		, b.issue_date								"issue_Date"
       	, NULL 								   		"place_of_issue_nm"
       	, a.settlement_ccy                            "ext_Key_Currency_Issue" 
       	, NULL								  		 "sec_flag_1_value"
	  	, NULL								  		 "sec_flag_2_value"
	  	, NULL								   		"maturity_rate"
       	--, a.qty_traded                                 "CapitalNominal" 
       	, a.settlement_date                            "capital_Duration_Frm" 
		/*Assuption: Minimum settlement date from all transactions a TBill gives the issue_date*/
       	, b.maturity_date                              "capital_Duration_To"
       	, 'F'								   		"capitalCalendarTypeNm"
	  	, 'ZERO'							   			"sec_Bond_Type_Nm"
FROM   (SELECT Row_number () 
                 OVER ( 
                   partition BY sec_defn_fbo_id_num, buy_or_sell 
                   ORDER BY sec_defn_fbo_id_num, settlement_date ASC ) AS RN, 
               sec_defn_fbo_id_num, 
               buy_or_sell, 
               settlement_date, 
               settlement_ccy, 
               Sum(qty_traded)                                         AS 
               QTY_TRADED 
        FROM   obnlive.tt_sec_bs b 
        WHERE  b.deal_state NOT IN ( 'DLTD', 'RVSD' ) 
        GROUP  BY sec_defn_fbo_id_num, 
                  settlement_date, 
                  buy_or_sell, 
                  settlement_ccy 
        ORDER  BY rn) a, 
       obnlive.sd_sec_defn b, obnlive.SD_CPTY c 
WHERE  b.type = 'TBILL' --b.sec_class_fbo_id_num IN ( 19, 26 ) 
       AND a.sec_defn_fbo_id_num = b.fbo_id_num 
       AND b.issuer_fbo_id_num = c.fbo_id_num 
       AND a.rn = 1 
       AND a.buy_or_sell = 'B' 
 	   AND c.cpty_status = 'OK'
	   AND c.fbo_id_num &lt;&gt; 0
	   AND c.cpty_type IS NOT NULL
       AND a.settlement_date &lt;= To_date('$POSTINGDATE', 'yyyymmdd')
       AND (b.maturity_date &gt;= To_date('$POSTINGDATE', 'yyyymmdd') OR b.maturity_date IS NULL) </sqlStr>
        <field nameT="EXT_KEY_SECURITY" name="ext_Key_Security" type="0" position="0" end="24"/>
        <field nameT="SECURITY_NM_DC" name="security_Nm_Dc" type="0" position="25" end="84"/>
        <field nameT="EXT_KEY_ADDRESS_ISSUER" name="ext_key_address_issuer" type="0" position="85" end="114"/>
        <field nameT="ISSUE_DATE" name="issue_Date" format="yyyyMMdd" type="1" position="115" end="122"/>
        <field nameT="PLACE_OF_ISSUE_NM" name="place_of_issue_nm" type="0" position="123" end="142"/>
        <field nameT="EXT_KEY_CURRENCY_ISSUE" name="ext_Key_Currency_Issue" type="0" position="143" end="172"/>
        <field nameT="SEC_FLAG_1_VALUE" name="sec_flag_1_value" type="0" position="173" end="173"/>
        <field nameT="SEC_FLAG_2_VALUE" name="sec_flag_2_value" type="0" position="174" end="174"/>
        <field nameT="MATURITY_RATE" name="maturity_rate" type="0" position="175" end="189"/>
        <field nameT="CAPITAL_DURATION_FRM" name="capital_Duration_Frm" format="yyyyMMdd" type="1" position="190" end="197"/>
        <field nameT="CAPITAL_DURATION_TO" name="capital_Duration_To" format="yyyyMMdd" type="1" position="198" end="205"/>
        <field nameT="CAPITAL_CALENDAR_TYPE_NM" name="capitalCalendarTypeNm" type="0" position="206" end="217"/>
        <field nameT="SEC_BOND_TYPE_NM" name="sec_Bond_Type_Nm" type="0" position="218" end="227"/>
      </model>
      <model id="BO01XXXX_BOND_TRADE_DEALS">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.BO01XXXX_BOND_TRADE_DEALS.ldr"/>
        <option id="recordSize" value="231"/>
        <sqlStr xml:space="preserve">select  distinct b.fbo_id_num || 
CASE
	WHEN c.name = 'BNDCBN' THEN '_HTM'
	WHEN c.name = 'BNDTBK' THEN '_HFT'
	WHEN c.name = 'BNDAFS' THEN '_AFS'
END               						"pos_bank_trs_nm"
, a.deal_num							"trs_nr_nm"
, NULL									"dw_hedge_name"
,a.deal_date							"trs_date"
, a.settlement_date						"valuta"
,a.buy_or_sell							"trade_side_nm"
,abs(a.qty_traded)						"sec_quantity"
,a.price								"sec_trade_rate_clean"
, NULL									"ex_coupon_flag"
,abs(a.accrued_value)					"sec_interest_accrued"
from obnlive.tt_sec_bs a, obnlive.sd_sec_defn b, 
obnlive.sd_subtype c,  obnlive.SD_CPTY d, obnlive.sd_sec_defn_cf_sides e
WHERE a.sec_defn_fbo_id_num = b.fbo_id_num
AND a.subtype_fbo_id_num = c.fbo_id_num
AND b.issuer_fbo_id_num = d.fbo_id_num
AND b.fbo_id_num = e.fbo_id_num
AND type = 'BOND' AND c.name IN ('BNDCBN', 'BNDTBK', 'BNDAFS')
AND d.cpty_status = 'OK'
AND d.fbo_id_num &lt;&gt; 0
AND d.cpty_type IS NOT NULL
AND e.cash_flow_side_type = 'FIXED'
AND b.maturity_date &gt;= To_date('$POSTINGDATE', 'yyyymmdd')

UNION

select  distinct b.fbo_id_num || 
CASE
	WHEN c.name = 'TBLCBN' THEN '_HTM'
	WHEN c.name = 'TBLTBK' THEN '_HFT'
	WHEN c.name = 'TBLAFS' THEN '_AFS'
END               												"pos_bank_trs_nm"
, a.deal_num													"trs_nr_nm"
, NULL															"dw_hedge_name"
,a.deal_date													"trs_date"
, a.settlement_date												"valuta"
,a.buy_or_sell													"trade_side_nm"
,abs(a.qty_traded)												"sec_quantity"
, 100-((b.maturity_date-a.settlement_date)/365)*(a.price)		"sec_trade_rate_clean"
, NULL															"ex_coupon_flag"
,abs(a.accrued_value)											"sec_interest_accrued"
from obnlive.tt_sec_bs a, obnlive.sd_sec_defn b, 
obnlive.sd_subtype c,  obnlive.SD_CPTY d
WHERE a.sec_defn_fbo_id_num = b.fbo_id_num
AND a.subtype_fbo_id_num = c.fbo_id_num
AND b.issuer_fbo_id_num = d.fbo_id_num
--AND b.fbo_id_num = e.fbo_id_num
AND type = 'TBILL' AND c.name IN ('TBLCBN', 'TBLTBK', 'TBLAFS')
AND d.cpty_status = 'OK'
AND d.fbo_id_num &lt;&gt; 0
AND d.cpty_type IS NOT NULL
--AND e.cash_flow_side_type = 'FIXED'
--AND a.settlement_date &lt;= To_date('$POSTINGDATE', 'yyyymmdd')
AND (b.maturity_date &gt;= To_date('$POSTINGDATE', 'yyyymmdd') OR b.maturity_date IS NULL)</sqlStr>
        <field nameT="POS_BANK_TRS_NR_NM" name="pos_bank_trs_nm" type="0" position="0" end="39"/>
        <field nameT="TRS_NR_NM" name="trs_nr_nm" type="0" position="40" end="79"/>
        <field nameT="DW_HEDGE_NAME" name="dw_hedge_name" type="0" position="80" end="129"/>
        <field nameT="TRS_DATE" name="trs_date" format="yyyyMMdd" type="1" position="130" end="137"/>
        <field nameT="VALUTA" name="valuta" format="yyyyMMdd" type="1" position="138" end="145"/>
        <field nameT="TRADE_SIDE_NM" name="trade_side_nm" type="0" position="146" end="155"/>
        <field nameT="SEC_QUANTITY" name="sec_quantity" type="0" position="156" end="185"/>
        <field nameT="SEC_TRADE_RATE_CLEAN" name="sec_trade_rate_clean" type="0" position="186" end="206"/>
        <field nameT="EX_COUPON_FLAG" name="ex_coupon_flag" type="0" position="207" end="207"/>
        <field nameT="SEC_INTEREST_ACCRUED" name="sec_interest_accrued" type="0" position="208" end="230"/>
      </model>
      <model id="BO01XXXX_CAP_RED">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.BO01XXXX_CAP_RED.ldr"/>
        <option id="recordSize" value="204"/>
        <sqlStr xml:space="preserve"></sqlStr>
        <field nameT="POS_BANK_TRS_NR_NM" type="0" position="0" end="39"/>
        <field nameT="TRS_NR_NM" type="0" position="40" end="79"/>
        <field nameT="TRS_DATE" format="yyyyMMdd" type="1" position="80" end="87"/>
        <field nameT="VALUTA" format="yyyyMMdd" type="1" position="88" end="95"/>
        <field nameT="TRADE_SIDE_NM" type="0" position="96" end="105"/>
        <field nameT="SEC_QUANTITY" type="0" position="106" end="135"/>
        <field nameT="SEC_TRADE_RATE_DIRTY" type="0" position="136" end="156"/>
        <field nameT="SEC_AMOUNT" type="0" position="157" end="179"/>
        <field nameT="EX_COUPON_FLAG" type="0" position="180" end="180"/>
        <field nameT="SEC_INTEREST_ACCRUED" type="0" position="181" end="203"/>
      </model>
      <model id="BO01XXXX_FIX_INT_TRA">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.BO01XXXX_FIX_INT_TRA.ldr"/>
        <option id="recordSize" value="73"/>
        <sqlStr xml:space="preserve">Select 
	a.fbo_id_num													"ext_Key_Security"
	, a.trantime													"interest_Duration_Frm"
	,CASE 
		WHEN CREATION_FREQUENCY = 'A' THEN ADD_MONTHS(a.trantime,12)
		WHEN CREATION_FREQUENCY = 'B' THEN ADD_MONTHS(a.trantime,24)
		WHEN CREATION_FREQUENCY = 'S' THEN ADD_MONTHS(a.trantime,6)
	END																"interest_Duration_To"
	, a.maturity_date 									
	, CASE 
		WHEN CREATION_FREQUENCY = 'A' THEN '1Y'
		WHEN CREATION_FREQUENCY = 'B' THEN '2Y'
		WHEN CREATION_FREQUENCY = 'S' THEN '6M'
	END 															"Interest_Payment_Frequency"
	, YIELD_BASIS													"interest_method"
	, b.fix_rate * 100												"interest_rate"
	, 'ARREARS'														"pay_Agreement_Nm"
from obnlive.sd_sec_defn a 
INNER JOIN obnlive.sd_sec_defn_cf_sides b ON a.fbo_id_num = b.fbo_id_num
WHERE b.cash_flow_side_type = 'FIXED'
AND a.maturity_date &gt;= To_date('$POSTINGDATE', 'yyyymmdd')
AND a.trantime &lt;= To_date('$POSTINGDATE', 'yyyymmdd')
</sqlStr>        <field nameT="EXT_KEY_SECURITY" name="ext_Key_Security" type="0" position="0" end="29"/>        <field nameT="INTEREST_DURATION_TO" name="interest_Duration_To" format="yyyyMMdd" type="1" position="30" end="37"/>        <field nameT="INTEREST_DURATION_NM" name="interest_Duration_Frm" type="0" position="38" end="49"/>        <field nameT="INTEREST_METHOD" name="interest_method" type="0" position="50" end="51"/>        <field nameT="INTEREST_RATE" name="interest_rate" type="0" position="52" end="60"/>        <field nameT="PAY_AGREEMENT_NM" name="pay_Agreement_Nm" type="0" position="61" end="72"/>      </model>      <model id="BO01XXXX_IRR_PRI_REP">        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.BO01XXXX_IRR_PRI_REP.ldr"/>        <option id="recordSize" value="82"/>        <sqlStr xml:space="preserve"></sqlStr>        <field nameT="EXT_KEY_SECURITY" type="0" position="0" end="29"/>        <field nameT="VALUTA" format="yyyyMMdd" type="1" position="30" end="37"/>        <field nameT="CAPITAL_CHG_DECREASE" type="0" position="38" end="60"/>        <field nameT="CAPITAL_CHG_PAY_VALUTA" format="yyyyMMdd" type="1" position="61" end="68"/>        <field nameT="CAPITAL_CHG_DEC_NOM_PERCENT" type="0" position="69" end="81"/>      </model>      <model id="BO01XXXX_ISSUE_RATING">        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.BO01XXXX_ISSUE_RATING.ldr"/>        <option id="recordSize" value="40"/>        <sqlStr xml:space="preserve">/*
TO BE DELIVERED VIA EXCEL
*/</sqlStr>
        <field nameT="EXT_KEY_SECURITY" type="0" position="0" end="29"/>
        <field nameT="RATING_GRADE_NM" type="0" position="30" end="39"/>
      </model>
      <model id="BO01XXXX_MARKET_RATE">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.BO01XXXX_MARKET_RATE.ldr"/>
        <option id="recordSize" value="45"/>
        <sqlStr xml:space="preserve">/*

TO BE DELIVERED VIA EXCEL

*/</sqlStr>
        <field nameT="EXT_KEY_SECURITY" type="0" position="0" end="29"/>
        <field nameT="SEC_RATE" type="0" position="30" end="44"/>
      </model>
      <model id="BO01XXXX_REG_PRI_REP">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.BO01XXXX_REG_PRI_REP.ldr"/>
        <option id="recordSize" value="102"/>
        <sqlStr xml:space="preserve"></sqlStr>
        <field nameT="EXT_KEY_SECURITY" type="0" position="0" end="29"/>
        <field nameT="CAPITAL_CHG_INCREASE" type="0" position="30" end="52"/>
        <field nameT="CAPITAL_CHG_DURATION_FRM" format="yyyyMMdd" type="1" position="53" end="60"/>
        <field nameT="CAPITAL_CHG_DURATION_TO" format="yyyyMMdd" type="1" position="61" end="68"/>
        <field nameT="CAPITAL_CHG_DURATION_END" format="yyyyMMdd" type="1" position="69" end="76"/>
        <field nameT="CAPITAL_CHG_DURATION_NM" type="0" position="77" end="88"/>
        <field nameT="CAPITAL_CHG_DEC_NOM_PERCENT" type="0" position="89" end="101"/>
      </model>
      <model id="BO01XXXX_STE_UP_STE_DOW_IN">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.BO01XXXX_STE_UP_STE_DOW_IN.ldr"/>
        <option id="recordSize" value="89"/>
        <sqlStr xml:space="preserve"></sqlStr>
        <field nameT="EXT_KEY_SECURITY" type="0" position="0" end="29"/>
        <field nameT="INTEREST_DURATION_FRM" format="yyyyMMdd" type="1" position="30" end="37"/>
        <field nameT="INTEREST_DURATION_TO" format="yyyyMMdd" type="1" position="38" end="45"/>
        <field nameT="INTEREST_DURATION_NM" type="0" position="46" end="57"/>
        <field nameT="INTEREST_DATE_CHANGE" format="yyyyMMdd" type="1" position="58" end="65"/>
        <field nameT="INTEREST_METHOD" type="0" position="66" end="67"/>
        <field nameT="INTEREST_RATE" type="0" position="68" end="76"/>
        <field nameT="PAY_AGREEMENT_NM" type="0" position="77" end="88"/>
      </model>
      <model id="CREDITSPREADS_CRE_SPR">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.CREDITSPREADS_CRE_SPR.ldr"/>
        <option id="recordSize" value="27"/>
        <sqlStr xml:space="preserve"></sqlStr>
        <field nameT="RATING_GRADE_NM" type="0" position="0" end="9"/>
        <field nameT="VALID" format="yyyyMMdd" type="1" position="10" end="17"/>
        <field nameT="CREDIT_SPREAD_RATE" type="0" position="18" end="26"/>
      </model>
      <model id="FX01XXXX_FOR_EXC_SPO">
        <option id="program" value="file:/D:/app/fsoper/fxfprod/manticore-ETLTools/etl/ldr/FSETL.FX01XXXX_FOR_EXC_SPO.ldr"/>
        <option id="recordSize" value="328"/>
        <sqlStr xml:space="preserve"></sqlStr>
        <field nameT="TRS_NR_NM" type="0" position="0" end="39"/>
        <field nameT="ACTIVEV" type="0" position="40" end="40"/>
        <field nameT="EXT_KEY_ADDRESS" type="0" position="41" end="70"/>
        <field nameT="TRS_DATE" format="yyyyMMdd" type="1" position="71" end="78"/>
        <field nameT="MOTIVE_NM" type="0" position="79" end="88"/>
        <field nameT="EXT_KEY_CURRENCY_BUY_SPOT" type="0" position="89" end="118"/>
        <field nameT="EXT_KEY_CURRENCY_SELL_SPOT" type="0" position="119" end="148"/>
        <field nameT="CAPITAL_BUY_SPOT" type="0" position="149" end="171"/>
        <field nameT="CAPITAL_SELL_SPOT" type="0" position="172" end="194"/>
        <field nameT="CAPITAL_DURATION_SPOT" format="yyyyMMdd" type="1" position="195" end="202"/>
        <field nameT="FX_RATE_BAL_TRADE_DATE_BUY" type="0" position="203" end="217"/>
        <field nameT="FX_RATE_BAL_TRADE_DATE_SELL" type="0" position="218" end="232"/>
        <field nameT="ORGANISATION_UNIT_NM" type="0" position="233" end="244"/>
        <field nameT="DEALER_NM" type="0" position="245" end="279"/>
        <field nameT="BANK_SEGMENT_NM" type="0" position="280" end="299"/>
        <field nameT="PLACE_OF_CONTRACT_NM" type="0" position="300" end="319"/>
        <field nameT="COST_CENTER_NM" type="0" position="320" end="327"/>
      </model>
    </group>
    <option id="dependancies" value="init"/>
  </process>
</root>
